
#Область СобытияЭлементовФормы

&НаКлиенте
Процедура ТаблицаДокументовДобавить(Кнопка)
	
	Если Не Шаблон.Пустая() Тогда		
		ПараметрыПодбора = Новый Структура;
		ПараметрыПодбора.Вставить("МножественныйВыбор", Истина);
		ПараметрыПодбора.Вставить("ЗакрыватьПривыборе", Ложь);
		ВидДокумента = ВидДокумента(Шаблон);	
		ОткрытьФорму("Документ." + ВидДокумента + ".ФормаВыбора", ПараметрыПодбора, ЭтаФорма,,,,, РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	Иначе
		Сообщить("Не выбран шаблон");
		Возврат;
	КонецЕсли;  
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ВидДокумента(Шаблон);
	
	ВидДокумента = Шаблон.ВидДокумента;
	
	Возврат ВидДокумента;   
	
КонецФункции

&НаКлиенте
Процедура ТаблицаДокументовОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	МассивДокументовПодбора = ВыбранноеЗначение.ТекущийЭлемент.ВыделенныеСтроки;
	
	Для каждого СтрокаДокумента Из МассивДокументовПодбора Цикл
		
		Если ЕстьДокументвТЧ(СтрокаДокумента) Тогда
			Сообщить("Документ: " + СтрокаДокумента + " уже был добавлен в список. ");
		Иначе	
			СтрокаТЧ = ТаблицаДокументов.Добавить();
			СтрокаТЧ.Документ = СтрокаДокумента;
			СтрокаТЧ.Шаблон = Шаблон;
			СтрокаТЧ.ТСД = ТСД;
			СтрокаТЧ.Комментарий = Комментарий;
			Сообщить("Документ: " + СтрокаДокумента + " добавлен в список. ");
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Функция ЕстьДокументвТЧ(Документ)
	
	Возврат ТаблицаДокументов.НайтиСтроки(Новый Структура("Документ", Документ )).Количество() > 0; 
	
КонецФункции

&НаКлиенте
Процедура Выгрузить(Кнопка)
	
	КолДокументов = ТаблицаДокументов.Количество() - 1;
	
	Для Сч = 0 По КолДокументов Цикл
		ТекСтрока = ТаблицаДокументов.Получить(Сч);
		ИсходныйДокумент = ТекСтрока.Документ;
		Шаблон = ТекСтрока.Шаблон;
		ТСД = ТекСтрока.ТСД;
		Комментарий = ТекСтрока.Комментарий;
		СоздатьДок(ИсходныйДокумент, Шаблон, ТСД, Комментарий);
	КонецЦикла;
	
	ТаблицаДокументов.Очистить();
	ФормаВыбора = ПолучитьФорму("Обработка.ДатаМобайл_АРМДиспетчера.Форма.Форма1"); 
	ФормаВыбора.Закрыть()
	
КонецПроцедуры

&НаСервереБезКонтекста
Процедура СоздатьДок (ИсходныйДокумент, Шаблон, ТСД, Комментарий)
	
	НовыйДок = Справочники.ДатаМобайл_ДокументыТСД.СоздатьЭлемент();
	НовыйДок.ИсходныйДокумент = ИсходныйДокумент;
	НовыйДок.Шаблон = Шаблон;
	НовыйДок.ТСД = ТСД;
	НовыйДок.Комментарий = Комментарий;	
	НовыйДок.Записать();
	
КонецПроцедуры	

#КонецОбласти





