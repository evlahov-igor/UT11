#Область ПрограммныйИнтерфейс

#Область ЭтапыРасчета

// Этап "ЗаполнениеПартийВРегистреСебестоимостьТоваров"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры выполнения расчета
//			Подробнее см. пояснения в коде РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыРасчетаПартий()
//
Процедура ЗаполнениеПартийВРегистреСебестоимостьТоваров(ПараметрыРасчета) Экспорт
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреСебестоимостьТоваров(ПараметрыРасчета, Истина);
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ЗаполнениеПартийВРегистреСебестоимостьТоваров");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
		ТаблицаДляРаспределенияПартийТоваров(ПараметрыРасчета),
		ОписаниеЦепочекПартийТоваров(ПараметрыРасчета),
		ОписаниеДвиженийПартийТоваров(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийТоваров(ПараметрыРасчета));
	
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляПартийТоваров(ПараметрыРасчета);
	
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	
	// 4. Заполнение партий в цепочках
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии.
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
	
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру СебестоимостьТоваров.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреСебестоимостьТоваров(ПараметрыРасчета, Ложь);
	
КонецПроцедуры

// Этап "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры выполнения расчета
//			Подробнее см. пояснения в коде РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыРасчетаПартий()
//
Процедура ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж(ПараметрыРасчета) Экспорт
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж(ПараметрыРасчета, Истина);
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
		ТаблицаДляРаспределенияПартийВыручки(ПараметрыРасчета),
		ОписаниеЦепочекПартийВыручки(ПараметрыРасчета),
		ОписаниеДвиженийПартийВыручки(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийВыручки(ПараметрыРасчета));
	
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляПартийВыручки(ПараметрыРасчета);
	
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	
	// 4. Заполнение партий в цепочках
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии.
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
	
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру ВыручкаИСебестоимостьПродаж.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж(ПараметрыРасчета, Ложь);
	
КонецПроцедуры

// Этап "ПодготовкаДанныхДляПредварительногоРасчетаСебестоимости"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаДанныхДляПредварительногоРасчетаСебестоимости(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПодготовкаДанныхДляПредварительногоРасчетаСебестоимости");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	
	// 2. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаПодготовкиДанныхДляПредварительногоРасчетаСебестоимости(ПараметрыРасчета));
	
	// 3. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру СебестоимостьТоваров.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ПроцедурыЭтапа_ЗаполнениеПартийВРегистреСебестоимостьТоваров

// Инициализация данных

Функция ПоляПотребленийПартииТоваров(ПараметрыРасчета)
	
	Возврат "АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета";
	
КонецФункции

Функция ОписаниеЦепочекПартийТоваров(ПараметрыРасчета) Экспорт
	
	// Важно: особенности использования типов записи в движениях, формируемых именно этим этапом.
	// Если на данном этапе сформирована запись с типом записи, используемым в макете регистра себестоимости,
	// (см. РасчетСебестоимостиПовтИсп.ЭтоТолькоРасчетныйТипЗаписи())
	// то считается, что это "первичная" запись, в которой просто дозаполнены поля партионной идентификации.
	//	- признак "РасчетПартий" для такой записи устанавливается в значение Ложь.
	// Если сформирована запись с любым другим типом записи, то считается что это "расчетная" запись.
	//	- признак "РасчетПартий" для такой записи устанавливается в значение Истина.
	// Также можно "принудительно" установить РасчетПартий в значение Истина - с помощью поля запроса ЭтоТочноРасчетноеДвижение.
	
	ОписаниеЦепочек = Новый Соответствие;
	ПоляПотреблений	= ПоляПотребленийПартииТоваров(ПараметрыРасчета);
	
	// Потребление <- (Остаток, Партия, Перемещение, ПеремещениеОбособленно, ПеремещениеАвто, ОстатокСгруппированный, СторноВозврата, СторноПотребления, 
	// ВозвратПрошлыхПериодов, ПеремещениеУпр, ИсправлениеПрошлогоПериода).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Остаток,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Партия,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.СторноВозврата,		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.СторноПотребления,	ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПеремещениеУпр,      ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ИсправлениеПрошлогоПериода, ПоляПотреблений);
		
	// ПотреблениеАвто <- (Остаток, Партия, Перемещение, ПеремещениеОбособленно, ОстатокСгруппированный, СторноВозврата, СторноПотребления, ИсправлениеПрошлогоПериода).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Остаток,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Партия,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.СторноВозврата,		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.СторноПотребления,	ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ИсправлениеПрошлогоПериода, ПоляПотреблений);
		
	// ОстатокСгруппированный <- (Сторно, ВозвратБезДокументаИсточника)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,	ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.Сторно,					ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника, ПоляПотреблений);
		
	// СписаниеНаДругиеПартии <- (Остаток, Партия, Перемещение, ПеремещениеОбособленно, ОстатокСгруппированный, СторноВозврата, СторноПотребления, ВозвратПрошлыхПериодов, ПеремещениеУпр, ИсправлениеПрошлогоПериода, СторноСписанияНаДругиеПартии)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.Остаток,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.Партия,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.СторноВозврата,		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.СторноПотребления,	ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.ПеремещениеУпр,      ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.ИсправлениеПрошлогоПериода, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.СторноСписанияНаДругиеПартии, ПоляПотреблений);
		
	// СторноСписанияНаДругиеПартии <- (СписаниеНаДругиеПартии)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноСписанияНаДругиеПартии, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноСписанияНаДругиеПартии,
		Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии, ПоляПотреблений + ", Регистратор");
		
	// КорректировкаПриобретения <- (Остаток, Партия, ВозвратПрошлыхПериодов, ИсправлениеПрошлогоПериода)	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.Остаток, 				 ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.Партия, 				 	 ПоляПотреблений);	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, 	 ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.ИсправлениеПрошлогоПериода, 	 ПоляПотреблений);
		
	// ДопРасходыБезПартии <- (Прошлое, Импорт, СторноДопРасходов)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии,	ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии,
		Перечисления.ТипыЗаписейПартий.Прошлое, 			ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии,
		Перечисления.ТипыЗаписейПартий.Импорт, 				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии,
		Перечисления.ТипыЗаписейПартий.СторноДопРасходов, 	ПоляПотреблений);
	
	// ДопРасходыСПартией <- (Прошлое, Импорт, СторноДопРасходов, Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,	ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.Прошлое, 			ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.Импорт, 		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.СторноДопРасходов, 	ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.Потребление, 		ПоляПотреблений + ", Регистратор");
	
	// КорректировкаПриобретенияПрошлогоПериода <- (Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода,
		Перечисления.ТипыЗаписейПартий.Прошлое, ПоляПотреблений + ", Регистратор");
		
	// КорректировкаСтоимости <- (Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости,
		Перечисления.ТипыЗаписейПартий.Прошлое, ПоляПотреблений + ", Регистратор");
	
	// Сторно <- (Потребление, ПотреблениеАвто, ИсправлениеТекущегоПериода)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Сторно, 				"ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.Потребление, 		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.ИсправлениеТекущегоПериода, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// СторноПотребления <- (Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноПотребления, 	"ДокументИсточник, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноПотребления,
		Перечисления.ТипыЗаписейПартий.Потребление, 		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// СторноВозврата <- (Сторно, СторноВозвратНаДругойСклад)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноВозврата,	"ДокументИсточник, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозврата,
		Перечисления.ТипыЗаписейПартий.Сторно, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозврата,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// СторноВозвратНаДругойСклад <- (Потребление, ПотреблениеАвто)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,	"ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.Потребление, 				"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 			"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// ВозвратБезДокументаИсточника <- (Потребление, Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника,
		Перечисления.ТипыЗаписейПартий.Потребление, 				 ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника,
		Перечисления.ТипыЗаписейПартий.Прошлое, 					 ПоляПотреблений);
		
	// ВозвратНаДругойСклад <- (СторноВозвратНаДругойСклад, СторноВозврата)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.СторноВозврата,	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	
	// Перемещение <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, ВозвратНаДругойСклад).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Перемещение, 			"Регистратор, РазделУчета, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.Потребление, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад, 	"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
		
	// ПеремещениеОбособленно <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, ВозвратНаДругойСклад).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, 	"Регистратор, РазделУчета, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.Потребление, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад, 	"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
		
	// ПеремещениеАвто <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, Распределение).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто, 		"Регистратор, РазделУчета, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.Потребление, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.Распределение, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
		
	// ПеремещениеУпр <- (Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеУпр, 	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеУпр,
		Перечисления.ТипыЗаписейПартий.Потребление, 	"Регистратор, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	
	// Распределение <- (Перемещение, ПеремещениеОбособленно, Остаток, Партия, ПеремещениеОбособленно, ВозвратПрошлыхПериодов)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Распределение, 		"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Остаток,				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Партия,				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, "АналитикаУчетаНоменклатуры, Организация");
		
	// СписанияНаВыпуск <- (Перемещение, ПеремещениеОбособленно, ПеремещениеАвто, Партия, Остаток, ОстатокНЗП, СторноСписанияНаВыпуск).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, 	"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто, 	"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Партия,				"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ОстатокНЗП,			"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Остаток,				"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск, "АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
		
	// Выпуск <- (СписанияНаВыпуск)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Выпуск, 				"Регистратор, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Выпуск,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, 	"Регистратор, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
		
	// ПотреблениеПроизводство <- (Партия, Перемещение, ПеремещениеОбособленно, Остаток)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Партия, 				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Остаток,				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация");
		
	// СписаниеНаРасходы <- (Партия, Остаток)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,
		Перечисления.ТипыЗаписейПартий.Партия, 				"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,
		Перечисления.ТипыЗаписейПартий.Остаток,				"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
		
	// ВозвратПрошлыхПериодов <- (Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, "ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов,
		Перечисления.ТипыЗаписейПартий.Прошлое, 				"ДокументИсточник, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
		
	// СторноВозвратаПрошлыхПериодов <- (ВозвратПрошлыхПериодов)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноВозвратаПрошлыхПериодов, "ДокументИсточник, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратаПрошлыхПериодов,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	
	// ИсправлениеТекущегоПериода <- (Перемещение, ПеремещениеОбособленно)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ИсправлениеТекущегоПериода, "ДокументИсточник, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ИсправлениеТекущегоПериода,
		Перечисления.ТипыЗаписейПартий.Перемещение, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ИсправлениеТекущегоПериода,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	
	// Дополнение <- (<без источников - для формирования записей по данным запроса>)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Дополнение);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДополнениеПрошлыйПериод);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДополнениеРасчетПартий);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпускСторноПрошлогоПериода);
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийТоваров(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийТоваров(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
	ОписаниеДвижений.Вставить("Контекст", "ЗаполнениеПартийВРегистреСебестоимостьТоваров");
	ОписаниеДвижений.Вставить("ИмяРегистра", Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииТоваров(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Знаменатель, Количество, Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
		|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
		|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
		|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
		|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
		|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл,
		|ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл");
	ОписаниеДвижений.Вставить("БазисПрихода", "Количество");
	ОписаниеДвижений.Вставить("БазисРасхода", "Количество");
	ОписаниеДвижений.Вставить("КлючРасхода", "ДокументИсточник");
	ОписаниеДвижений.Вставить("ПолеПорядка", "ПериодПоступления");
	ОписаниеДвижений.Вставить("ПоляСортировки", "ВидДеятельностиНДС, АналитикаФинансовогоУчета, Партия,
		|ПриоритетныйИсточник, ПриоритетнаяХозяйственнаяОперация");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);
	
	ОписаниеДвижений.Вставить("ЕстьСторно", Истина);
	ОписаниеДвижений.Вставить("ЕстьИсправления", Истина);
	
	ОписаниеДвижений.Вставить("ВременныеТаблицыДляСледующихЭтапов", "РассчитанныеДокументы, ЕстьДекларации, ЕстьУведомленияОВвозе");
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийТоваров(ПараметрыРасчета)
	
	НезаписываемыеТипыЗаписей = Новый Соответствие;
	Для Каждого ТекЭлемент Из ПараметрыРасчета.НепересчитываемыеТипыЗаписей Цикл
		НезаписываемыеТипыЗаписей.Вставить(ТекЭлемент, Истина);
	КонецЦикла;
	
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Импорт, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, Истина);
	
	НезаписываемыеРазделы = Новый Соответствие;
	НезаписываемыеРазделы.Вставить(Перечисления.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка(), Истина);
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Истина, НезаписываемыеТипыЗаписей, НезаписываемыеРазделы);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийТоваров(ПараметрыРасчета)
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,
		ТекстОписаниеДанныхДляПартийТоваров());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийТоваров(ПараметрыРасчета)
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"АналитикаУчетаНоменклатуры", // разделитель
		"Знаменатель, Количество,
			|Стоимость, СтоимостьБезНДС, СтоимостьЗабалансовая, ДопРасходы, ДопРасходыБезНДС, Трудозатраты,
			|ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
			|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
			|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
			|СтоимостьРегл, СтоимостьЗабалансоваяРегл, ПостояннаяРазница, ВременнаяРазница,
			|ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл", // ресурсы
		"Номенклатура УБЫВ, Приоритет ВОЗР, Период, Организация, ВидЗапасов,
			|Партия, АналитикаУчетаПартий, Регистратор, КорПартия, ВидДвижения УБЫВ"); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийТоваров(ПараметрыРасчета),
		ПараметрыНумерации);
	
	СкорректироватьАналитикиУчетаПартийДляПартийТоваров(ПараметрыРасчета);
	
КонецПроцедуры

Процедура СкорректироватьАналитикиУчетаПартийДляПартийТоваров(ПараметрыРасчета)
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВЫБОР
	|		КОГДА Т.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|			ТОГДА Т.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ Т.КорАналитикаУчетаНоменклатуры
	|	КОНЕЦ,
	|	Т.КорАналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.СкорректироватьАналитикиУчетаПартийПриРасчете(ПараметрыРасчета, ТекстЗапроса);
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийТоваров(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийТоваров() // вт Декларации, ДекларацииПоПоступлениям
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстПрошлыеРеализации() // вт ПрошлыеРеализации
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстЕстьДекларации() // вт ОстаткиИмпорт, ЕстьДекларации
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстДокументыПоступления() // вт ДокументыПоступления
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстНеотфактурованныеПоставки() // вт НеотфактурованныеПоставки
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстВозвратыБезДокументаИсточника() // вт ВозвратыБезДокументаИсточника
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстИсправленныеДокументы() // вт ИсправленныеДокументы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстРассчитанныеДокументы() // вт РассчитанныеДокументы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстРеестрДокументовОстаткиПартий() // вт РеестрДокументовОстаткиПартий
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстПриобретенияТоваровПоЗаказам() // вт ПриобретенияТоваровПоЗаказам
		//++ Локализация
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ЕстьУведомленияОВвозеПрослеживаемыхТоваров() // вт ЕстьУведомленияОВвозе
		//-- Локализация
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстВтТоварыКПередаче()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхДляПартийТоваров() // вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиНЗП()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиПартийТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстКонечныеОстаткиПартийТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеПриходыПартийТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстОстатокСгруппированный()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеОборотыПартийТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеРеализацииТолькоРегл()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиЗакупокПоИмпорту()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиДляКорректировкиПриобретения()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеЗакупкиПоИмпорту()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыБезПартииКРаспределению() // использует Декларации
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыСПартиейКРаспределению() // использует Декларации
		//++ Локализация
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыСПартиейЗаявленияОВвозе()
		//-- Локализация
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыСПартиейКорректировкаПриобретения()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстКорректировкиПриобретения()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцев() // использует ПрошлыеРеализации
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстОтчетыКомиссионеровПрошлыхМесяцев() // использует ВозвратыБезДокументаИсточника  
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСторноДвиженияИсправленныхДокументовТекущегоПериода() // использует ИсправленныеДокументы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСторноДвиженияИсправленныхДокументовПрошлогоПериода() // использует ИсправленныеДокументы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДвиженияСПодобраннымиПартиями()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстКорректировкаСтоимостиТМЦОприходованныхПриВыбытииОС()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТоварыКПередачеРасход()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТоварыКПередачеПриход()
		+ РасчетСебестоимостиЛокализация.ТекстЗапросаДляПартийТоваров()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляПартийТоваров() Экспорт
	
	ТекстЗапроса = 
		"ВЫБРАТЬ ПЕРВЫЕ 0 // 76 ПОЛЕЙ
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 					КАК ЗапросИсточник,
		|	Т.ТипЗаписи										КАК ТипЗаписи,
		|	ЛОЖЬ											КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											КАК ЭтоСторно,
		|	0 												КАК Приоритет,
		|	0 												КАК Знаменатель,
		|	ЛОЖЬ 											КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)  КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		КАК НалогообложениеПартии,
		|	Т.Период										КАК Период,
		|	Т.Период										КАК ПериодПоступления,
		|	Т.Регистратор									КАК Регистратор,
		|	Т.ВидДвижения 									КАК ВидДвижения,
		|
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	Т.Партия,
		|	Т.Партия КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС,
		|
		|	Т.Количество,
		|	Т.Стоимость,
		|	Т.СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансовая,
		|	Т.СтоимостьУпр,
		|	Т.ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпр,
		|	Т.ДопРасходы,
		|	Т.ДопРасходыБезНДС,
		|	Т.Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазница,
		|	Т.ВременнаяРазница,
		|	Т.ДопРасходыРегл,
		|	Т.ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРегл,
		|	Т.РезервПодОбесценениеРегл,
		|	Т.РезервПодОбесценениеУпр,
		|
		|	Т.ХозяйственнаяОперация,
		|	Т.ХозяйственнаяОперация КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	Т.КорПартия,
		|	Т.КорАналитикаУчетаПартий,
		|	Т.КорАналитикаФинансовогоУчета,
		|	Т.КорВидДеятельностиНДС,
		|	Т.ВидДеятельностиНДСДокумента,
		|	Т.ВидДеятельностиНДСОтгрузки,
		|	Т.АналитикаФинансовогоУчетаДокумента,
		|	Т.ОперацияУчетаСебестоимости,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	Т.ДокументИсточник,
		|	Т.ДокументИсточник КАК ПриоритетныйИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.НастройкаСчетовУчета,
		|	Т.Сторно,
		|	Т.ВыполненРасчетПартий,
		|	Т.РежимЗакрытияМесяца
		|ПОМЕСТИТЬ Данные
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Т
		|";

	ТекстЗапроса = РасчетСебестоимостиПрикладныеАлгоритмы.ПодготовитьЗапросОписанияДанных(ТекстЗапроса);
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийТоваров() // Декларации, ДекларацииПоПоступлениям
	Возврат "
		|ВЫБРАТЬ
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ) КАК АналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(СтрокиРазделов.СтавкаНДС, Строки.СтавкаНДС) КАК СтавкаНДС,
		|	Строки.ВидЗапасов КАК ВидЗапасов,
		|	МАКСИМУМ(Строки.ДокументПоступления) КАК ДокументПоступления,
		|	СУММА(Строки.Количество) КАК Количество
		|ПОМЕСТИТЬ Декларации
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Разделы КАК СтрокиРазделов
		|		ПО СтрокиРазделов.Ссылка = ДД.Ссылка
		|		И СтрокиРазделов.НомерРаздела = Строки.НомерРаздела
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Строки.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
		|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
		|		И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
		|		И Аналитика.Серия = АналитикаБезНазначения.Серия
		|		И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
		|		И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
		|		И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|СГРУППИРОВАТЬ ПО
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ),
		|	ЕСТЬNULL(СтрокиРазделов.СтавкаНДС, Строки.СтавкаНДС),
		|	Строки.ВидЗапасов
		|;
		|ВЫБРАТЬ
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ) КАК АналитикаУчетаНоменклатуры,
		|	Строки.ДокументПоступления,
		|	ЕСТЬNULL(СтрокиРазделов.СтавкаНДС, Строки.СтавкаНДС) КАК СтавкаНДС,
		|	Строки.ВидЗапасов КАК ВидЗапасов,
		|	СУММА(Строки.Количество) КАК Количество
		|ПОМЕСТИТЬ ДекларацииПоПоступлениям
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Разделы КАК СтрокиРазделов
		|		ПО СтрокиРазделов.Ссылка = ДД.Ссылка
		|		И СтрокиРазделов.НомерРаздела = Строки.НомерРаздела
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Строки.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
		|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
		|		И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
		|		И Аналитика.Серия = АналитикаБезНазначения.Серия
		|		И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
		|		И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
		|		И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|	И Строки.ДокументПоступления <> ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ),
		|	Строки.ДокументПоступления,
		|	ЕСТЬNULL(СтрокиРазделов.СтавкаНДС, Строки.СтавкаНДС),
		|	Строки.ВидЗапасов
		|";
КонецФункции

Функция ТекстПрошлыеРеализации() // вт ПрошлыеРеализации
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.ДокументИсточник КАК ДокументРеализации,
		|	ДД.ДокументИсточник КАК ДокументИсточник,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК ВидЗапасов
		|ПОМЕСТИТЬ ПрошлыеРеализации
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Количество > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КорректировкаРеализации.Ссылка КАК ДокументРеализации,
		|	КорректировкаРеализации.ДокументОснование КАК ДокументИсточник,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК ВидЗапасов
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации КАК КорректировкаРеализации
		|		ПО КорректировкаРеализации.ДокументОснование = ДД.ДокументИсточник
		|			И НЕ КорректировкаРеализации.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Количество > 0
		|";
КонецФункции

Функция ТекстЕстьДекларации() // вт ОстаткиИмпорт, ЕстьДекларации
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Остатки.Партия КАК Партия,
		|	НАЧАЛОПЕРИОДА(Импорт.Дата, МЕСЯЦ) КАК Дата
		|ПОМЕСТИТЬ ОстаткиИмпорт
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&МассивОрганизаций)
		|	) КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Остатки.Партия
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Партия КАК Партия,
		|	МАКСИМУМ(ДД.Дата) КАК Дата
		|ПОМЕСТИТЬ ЕстьДекларации
		|ИЗ
		|	(ВЫБРАТЬ
		|		Партии.ДокументИсточник КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Партии
		|			ПО Партии.Регистратор = Декларации.Ссылка
		|	ГДЕ
		|		Декларации.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И Декларации.Проведен
		|		И Партии.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	СГРУППИРОВАТЬ ПО
		|		Партии.ДокументИсточник
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Остатки.Партия КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		ОстаткиИмпорт КАК Остатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Партии
		|			ПО Партии.Партия = Остатки.Партия
		|			И Партии.Период МЕЖДУ Остатки.Дата И &НачалоПериода
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|			ПО Партии.Регистратор = Декларации.Ссылка
		|	ГДЕ
		|		Партии.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	СГРУППИРОВАТЬ ПО
		|		Остатки.Партия
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Партии.ДокументПоступления КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Партии
		|			ПО Партии.Ссылка = Декларации.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|			ПО Партии.Ссылка = СебестоимостьТоваров.Регистратор
		|			И Партии.ДокументПоступления = СебестоимостьТоваров.Партия
		|			И СебестоимостьТоваров.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	ГДЕ
		|		Декларации.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|		И НЕ Партии.ДокументПоступления = ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)
		|		И Декларации.Проведен
		|	СГРУППИРОВАТЬ ПО
		|		Партии.ДокументПоступления
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Остатки.Партия КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		ОстаткиИмпорт КАК Остатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Партии
		|			ПО Партии.ДокументПоступления = Остатки.Партия
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|			ПО Партии.Ссылка = Декларации.Ссылка
		|			И Декларации.Дата МЕЖДУ Остатки.Дата И &НачалоПериода
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|			ПО Партии.Ссылка = СебестоимостьТоваров.Регистратор
		|			И Партии.ДокументПоступления = СебестоимостьТоваров.Партия
		|			И СебестоимостьТоваров.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	ГДЕ
		|		СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|		И НЕ Партии.ДокументПоступления = ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)
		|		И Декларации.Проведен
		|	СГРУППИРОВАТЬ ПО
		|		Остатки.Партия
		|	) КАК ДД
		|СГРУППИРОВАТЬ ПО
		|	ДД.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|";
КонецФункции

//++ Устарело_Производство21

//-- Устарело_Производство21

Функция ТекстДокументыПоступления() // вт ДокументыПоступления
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.ДокументИсточник КАК Ссылка,
		|	ВЫБОР КОГДА ДД.ХозяйственнаяОперация В
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки))
		|		ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ФактуровкаПоставки
		|ПОМЕСТИТЬ ДокументыПоступления
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи В (
		|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости))
		|	И ДД.ДокументИсточник <> НЕОПРЕДЕЛЕНО
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.ДокументИсточник КАК Поступление,
		|	ДД.Регистратор КАК Приобретение
		|ПОМЕСТИТЬ ПоступленияИПриобретенияНефактурованнойПоставкиПрошлогоПериода
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПоступления КАК Поступления
		|		ПО ДД.Регистратор = Поступления.Ссылка
		|		И Поступления.ФактуровкаПоставки
		|ГДЕ
		|	ДД.ДокументИсточник <> НЕОПРЕДЕЛЕНО
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.Поступление
		|ПОМЕСТИТЬ ДокументыПоступленияНефактурованнойПоставкиПрошлогоПериода
		|ИЗ
		|	ПоступленияИПриобретенияНефактурованнойПоставкиПрошлогоПериода КАК ДД
		|";
КонецФункции
	
Функция ТекстНеотфактурованныеПоставки() // вт НеотфактурованныеПоставки
	Возврат "
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Партия,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.РазделУчета КАК РазделУчета,
		|	МАКСИМУМ(ДД.КорАналитикаУчетаНоменклатуры) КАК КорАналитикаУчетаНоменклатуры,
		|	МАКСИМУМ(ДД.КорВидЗапасов) КАК КорВидЗапасов,
		|	МАКСИМУМ(ДД.КорРазделУчета) КАК КорРазделУчета,
		|	МАКСИМУМ(ПриходНаСклад.Партия) КАК КорПартия,
		|	МАКСИМУМ(ПриходНаСклад.АналитикаУчетаПартий) КАК КорАналитикаУчетаПартий
		|	
		|ПОМЕСТИТЬ НеотфактурованныеПоставки
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&МассивОрганизаций)
		|		И РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	) КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК ДД
		|		ПО ДД.Регистратор = Остатки.Партия
		|		И ДД.Период < &НачалоПериода
		|		И ДД.АналитикаУчетаНоменклатуры = Остатки.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Остатки.ВидЗапасов
		|		И ДД.РазделУчета = Остатки.РазделУчета
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК ПриходНаСклад
		|		ПО ПриходНаСклад.Регистратор = Остатки.Партия
		|		И ПриходНаСклад.Период < &НачалоПериода
		|		И ПриходНаСклад.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
		|		И ПриходНаСклад.ВидЗапасов = ДД.КорВидЗапасов
		|		И ПриходНаСклад.РазделУчета = ДД.КорРазделУчета
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Партия,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.РазделУчета КАК РазделУчета,
		|	МАКСИМУМ(ДД.КорАналитикаУчетаНоменклатуры) КАК КорАналитикаУчетаНоменклатуры,
		|	МАКСИМУМ(ДД.КорВидЗапасов) КАК КорВидЗапасов,
		|	МАКСИМУМ(ДД.КорРазделУчета) КАК КорРазделУчета,
		|	МАКСИМУМ(ПриходНаСклад.Партия) КАК КорПартия,
		|	МАКСИМУМ(ПриходНаСклад.АналитикаУчетаПартий) КАК КорАналитикаУчетаПартий
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПоступленияНефактурованнойПоставкиПрошлогоПериода КАК Неотфактуровка
		|		ПО Неотфактуровка.Поступление = Остатки.Регистратор
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК ДД
		|		ПО ДД.Регистратор = Остатки.Партия
		|		И ДД.Период < &КонецПериода
		|		И ДД.АналитикаУчетаНоменклатуры = Остатки.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Остатки.ВидЗапасов
		|		И ДД.РазделУчета = Остатки.РазделУчета
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК ПриходНаСклад
		|		ПО ПриходНаСклад.Регистратор = Остатки.Партия
		|		И ПриходНаСклад.Период < &КонецПериода
		|		И ПриходНаСклад.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
		|		И ПриходНаСклад.ВидЗапасов = ДД.КорВидЗапасов
		|		И ПриходНаСклад.РазделУчета = ДД.КорРазделУчета
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия,
		|	АналитикаУчетаНоменклатуры,
		|	ВидЗапасов,
		|	РазделУчета
		|";

КонецФункции

Функция ТекстВозвратыБезДокументаИсточника() // вт ВозвратыБезДокументаИсточника
	Возврат "
		|ВЫБРАТЬ
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.РазделУчета КАК РазделУчета
		|	
		|ПОМЕСТИТЬ ВозвратыБезДокументаИсточника
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратБезДокументаИсточника)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета
		|ИНДЕКСИРОВАТЬ ПО
		|	Организация,
		|	АналитикаУчетаНоменклатуры,
		|	ВидЗапасов,
		|	РазделУчета
		|";

КонецФункции

Функция ТекстИсправленныеДокументы() Экспорт // вт ИсправленныеДокументы
	Возврат "	
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Реестр.СторнируемыйДокумент КАК ДокументИсточник,
		|	РеестрИсточник.ДатаДокументаИБ КАК ДатаДокументаИсточника,
		|	ДД.Период,
		|	ДД.Регистратор
		|ПОМЕСТИТЬ ИсправленныеДокументы
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
		|		РегистрСведений.РеестрДокументов КАК Реестр
		|	ПО
		|		Реестр.Ссылка = ДД.Регистратор
		|		И Реестр.СторноИсправление
		|		И НЕ Реестр.ДополнительнаяЗапись
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК РеестрИсточник
		|	ПО РеестрИсточник.Ссылка = Реестр.СторнируемыйДокумент
		|		И НЕ РеестрИсточник.ДополнительнаяЗапись
		|ГДЕ
		|	ДД.Сторно
		|	И ДД.ДокументИсточник <> ДД.Регистратор
		|";
КонецФункции

Функция ТекстРассчитанныеДокументы() // вт РассчитанныеДокументы
	Возврат "	
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.Период КАК Период,
		|	ДД.Регистратор КАК Регистратор
		|ПОМЕСТИТЬ РассчитанныеДокументы
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	НЕ &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|	И ДД.ВыполненРасчетПартий
		|	И НЕ ДД.Сторно
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Период,
		|	Регистратор
		|";
КонецФункции

Функция ТекстРеестрДокументовОстаткиПартий() // вт РеестрДокументовОстаткиПартий
	Возврат "	
		|ВЫБРАТЬ
		|	Реестр.Ссылка КАК Ссылка,
		|	МАКСИМУМ(Реестр.ДатаДокументаИБ) КАК ДатаДокументаИБ,
		|	МАКСИМУМ(Реестр.ХозяйственнаяОперация) КАК ХозяйственнаяОперация,
		|	МАКСИМУМ(Т.РазделУчета) КАК РазделУчета
		|ПОМЕСТИТЬ РеестрДокументовОстаткиПартий
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|	ПО Реестр.Ссылка = Т.Партия
		|		И Реестр.Организация = Т.Организация
		|		И НЕ Реестр.ДополнительнаяЗапись
		|		И Т.Партия <> НЕОПРЕДЕЛЕНО
		|ГДЕ
		|	&ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|СГРУППИРОВАТЬ ПО
		|	Реестр.Ссылка
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Реестр.Ссылка КАК Ссылка,
		|	МАКСИМУМ(Реестр.ДатаДокументаИБ) КАК ДатаДокументаИБ,
		|	МАКСИМУМ(Реестр.ХозяйственнаяОперация) КАК ХозяйственнаяОперация,
		|	МАКСИМУМ(Т.РазделУчета) КАК РазделУчета
		|ИЗ
		|	ВТКэшРасчетныеОстаткиСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|	ПО Реестр.Ссылка = Т.Партия
		|		И Реестр.Организация = Т.Организация
		|		И НЕ Реестр.ДополнительнаяЗапись
		|		И Т.Партия <> НЕОПРЕДЕЛЕНО
		|ГДЕ
		|	НЕ &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|СГРУППИРОВАТЬ ПО
		|	Реестр.Ссылка
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка
		|";
КонецФункции

Функция ТекстПриобретенияТоваровПоЗаказам() // вт ПриобретенияТоваровПоЗаказам
	Возврат "
		|ВЫБРАТЬ
		|	Остатки.Партия КАК Партия,
		|	Остатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Остатки.ВидЗапасов КАК ВидЗапасов,
		|	Остатки.РазделУчета КАК РазделУчета,
		|	МАКСИМУМ(Закупки.Заказ) КАК ЗаказПоставщику
		|	
		|ПОМЕСТИТЬ ПриобретенияТоваровПоЗаказам
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&МассивОрганизаций)
		|		И РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|	) КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.Закупки КАК Закупки
		|		ПО Закупки.Регистратор = Остатки.Партия
		|		И Закупки.Период < &НачалоПериода
		|		И Закупки.АналитикаУчетаНоменклатуры = Остатки.АналитикаУчетаНоменклатуры
		|		И Закупки.ВидЗапасов = Остатки.ВидЗапасов
		|СГРУППИРОВАТЬ ПО
		|	Остатки.Партия,
		|	Остатки.АналитикаУчетаНоменклатуры,
		|	Остатки.ВидЗапасов,
		|	Остатки.РазделУчета
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия,
		|	АналитикаУчетаНоменклатуры,
		|	ВидЗапасов,
		|	РазделУчета
		|";
КонецФункции

//++ Локализация

Функция ЕстьУведомленияОВвозеПрослеживаемыхТоваров() // вт ЕстьУведомленияОВвозе
	Возврат "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Остатки.Партия КАК Партия,
	|	Остатки.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	|	НАЧАЛОПЕРИОДА(ЗакупкаВСтранахЕАЭС.Дата, МЕСЯЦ) КАК Дата
	|
	|ПОМЕСТИТЬ ОстаткиЗакупкаВСтранахЕАЭС
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
	|		Организация В (&МассивОрганизаций)
	|		И ЕСТЬNULL(АналитикаУчетаНоменклатуры.Номенклатура.ПрослеживаемыйТовар, ЛОЖЬ)
	|	) КАК Остатки
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ЗакупкаВСтранахЕАЭС
	|		ПО ЗакупкаВСтранахЕАЭС.Ссылка = Остатки.Партия
	|		И ЗакупкаВСтранахЕАЭС.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
	|ИНДЕКСИРОВАТЬ ПО
	|	Партия
	|;
	|////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Уведомление.ПервичныйДокумент КАК Партия,
	|	Уведомление.Дата КАК Дата,
	|	УведомлениеТовары.Номенклатура КАК Номенклатура
	|
	|ПОМЕСТИТЬ ЕстьУведомленияОВвозе
	|ИЗ
	|	Документ.УведомлениеОВвозеПрослеживаемыхТоваров КАК Уведомление
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.УведомлениеОВвозеПрослеживаемыхТоваров.Товары КАК УведомлениеТовары
	|		ПО УведомлениеТовары.Ссылка = Уведомление.Ссылка
	|ГДЕ
	|	Уведомление.Дата МЕЖДУ &НачалоПериода И &КонецПериода 
	|	И Уведомление.Организация В (&МассивОрганизаций)
	|	И Уведомление.Проведен
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Остатки.Партия КАК Партия,
	|	Уведомление.Дата КАК Дата, 
	|	Остатки.Номенклатура КАК Номенклатура
	|ИЗ
	|	ОстаткиЗакупкаВСтранахЕАЭС КАК Остатки
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.УведомлениеОВвозеПрослеживаемыхТоваров КАК Уведомление
	|		ПО Уведомление.Дата МЕЖДУ Остатки.Дата И &КонецПредыдущегоПериода
	|		И Уведомление.ПервичныйДокумент = Остатки.Партия
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Партия,
	|	Номенклатура
	|";		 
КонецФункции

//-- Локализация

// ... выборки данных

Функция ТекстНачальныеОстаткиПартийТоваров() // использует ЕстьДекларации, НеотфактурованныеПоставки, ЕстьУведомленияОВвозе
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиПартийТоваров"" 			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.КоличествоОстаток < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)							 КАК ЭтоСторно,
		|	0 												 КАК Приоритет,
		|	0 												 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	Т.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	(ВЫБОР
		|		КОГДА НЕ ЕстьДекларации.Дата ЕСТЬ NULL ТОГДА ЕстьДекларации.Дата
		//++ Локализация
		|		КОГДА НЕ ЕстьУведомленияОВвозе.Дата ЕСТЬ NULL ТОГДА ЕстьУведомленияОВвозе.Дата
		//-- Локализация
		|		КОГДА НЕ ПервичныйДокумент.Дата ЕСТЬ NULL ТОГДА ПервичныйДокумент.Дата
		// Для остатков с партиями период определяется датой партии.
		|		КОГДА НЕ Реестр.ДатаДокументаИБ ЕСТЬ NULL ТОГДА Реестр.ДатаДокументаИБ
		// При учете по ФИФО остатки без партий должны списываться в первую очередь.
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		// При учете по средней остатки без партий должны списываться после остатков с партиями.
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)        КАК Период,
		// Поле ПериодПоступления заполняется аналогично полю Период.
		|	(ВЫБОР
		|		КОГДА НЕ ЕстьДекларации.Дата ЕСТЬ NULL ТОГДА ЕстьДекларации.Дата
		//++ Локализация
		|		КОГДА НЕ ЕстьУведомленияОВвозе.Дата ЕСТЬ NULL ТОГДА ЕстьУведомленияОВвозе.Дата
		//-- Локализация
		|		КОГДА НЕ ПервичныйДокумент.Дата ЕСТЬ NULL ТОГДА ПервичныйДокумент.Дата
		|		КОГДА НЕ Реестр.ДатаДокументаИБ ЕСТЬ NULL ТОГДА Реестр.ДатаДокументаИБ
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)        КАК ПериодПоступления,
		|	Т.Партия										 КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					 КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры 					 КАК АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета				 					 КАК РазделУчета,
		|	Т.ВидЗапасов				 					 КАК ВидЗапасов,
		|	Т.Организация				 					 КАК Организация,
		|	Т.Партия					 					 КАК Партия,
		|	НЕОПРЕДЕЛЕНО									 КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий		 					 КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета  					 КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС		 					 КАК ВидДеятельностиНДС,
		|
		|	Т.КоличествоОстаток 							 КАК Количество,
		|	Т.СтоимостьОстаток 								 КАК Стоимость,
		|	Т.СтоимостьБезНДСОстаток 						 КАК СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансоваяОстаток 					 КАК СтоимостьЗабалансовая,
		|	Т.СтоимостьУпрОстаток 							 КАК СтоимостьУпр,
		|	Т.ДопРасходыУпрОстаток 							 КАК ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДСОстаток 				 КАК ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДСОстаток 			 КАК ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпрОстаток 						 КАК ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпрОстаток 				 КАК ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпрОстаток 				 КАК ПостатейныеПеременныеУпр,
		|	Т.ДопРасходыОстаток 						 	 КАК ДопРасходы,
		|	Т.ДопРасходыБезНДСОстаток 				 		 КАК ДопРасходыБезНДС,
		|	Т.ТрудозатратыОстаток 							 КАК Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДСОстаток 				 КАК ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДСОстаток 			 КАК ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРеглОстаток 							 КАК СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРеглОстаток 				 КАК СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазницаОстаток 						 КАК ПостояннаяРазница,
		|	Т.ВременнаяРазницаОстаток 						 КАК ВременнаяРазница,
		|	Т.ДопРасходыРеглОстаток 						 КАК ДопРасходыРегл,
		|	Т.ТрудозатратыРеглОстаток 						 КАК ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРеглОстаток 				 КАК ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРеглОстаток 			     КАК ПостатейныеПеременныеРегл,
		|	Т.РезервПодОбесценениеРеглОстаток 			     КАК РезервПодОбесценениеРегл,
		|	Т.РезервПодОбесценениеУпрОстаток 			     КАК РезервПодОбесценениеУпр,
		|
		|	ЕСТЬNULL(Реестр.ХозяйственнаяОперация,
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)) КАК ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры,
		|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка))	КАК КорАналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорРазделУчета,
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)) КАК КорРазделУчета,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорВидЗапасов,
		|		ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))						КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорПартия,
		|		НЕОПРЕДЕЛЕНО)														КАК КорПартия,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаПартий,
		|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))		КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|		 И ТИПЗНАЧЕНИЯ(ПоступлениеТоваров.Распоряжение) = ТИП(Документ.ЗаказПоставщику)
		|			ТОГДА ПоступлениеТоваров.Распоряжение
		|		ИНАЧЕ ЕСТЬNULL(ПриобретенияТоваровПоЗаказам.ЗаказПоставщику, НЕОПРЕДЕЛЕНО) КОНЕЦ) КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ЛОЖЬ																	КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК Т
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Т.Партия
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДекларации КАК ЕстьДекларации
		|		ПО ЕстьДекларации.Партия = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПервичныйДокумент КАК ПервичныйДокумент
		|		ПО ПервичныйДокумент.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ РеестрДокументовОстаткиПартий КАК Реестр
		|		ПО Реестр.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ НеотфактурованныеПоставки КАК НеотфактурованныеПоставки
		|		ПО НеотфактурованныеПоставки.Партия = Т.Партия
		|		И НеотфактурованныеПоставки.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		И НеотфактурованныеПоставки.ВидЗапасов = Т.ВидЗапасов
		|		И НеотфактурованныеПоставки.РазделУчета = Т.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПриобретенияТоваровПоЗаказам КАК ПриобретенияТоваровПоЗаказам
		|		ПО ПриобретенияТоваровПоЗаказам.Партия = Т.Партия
		|		И ПриобретенияТоваровПоЗаказам.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		И ПриобретенияТоваровПоЗаказам.ВидЗапасов = Т.ВидЗапасов
		|		И ПриобретенияТоваровПоЗаказам.РазделУчета = Т.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровНаСклад КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = Т.Партия
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ЗакупкаВСтранахЕАЭС
		|		ПО ЗакупкаВСтранахЕАЭС.Ссылка = Т.Партия
		|		И ЗакупкаВСтранахЕАЭС.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьУведомленияОВвозе КАК ЕстьУведомленияОВвозе
		|		ПО ЕстьУведомленияОВвозе.Партия = Т.Партия
		|		И ЕстьУведомленияОВвозе.Номенклатура = Аналитика.Номенклатура
		//-- Локализация
		|ГДЕ
		|	НЕ (НЕ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|		И НЕ Импорт.Ссылка ЕСТЬ NULL И ЕстьДекларации.Партия ЕСТЬ NULL
		|		И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа))
		//++ Локализация
		|	И НЕ (НЕ ЗакупкаВСтранахЕАЭС.Ссылка ЕСТЬ NULL
		|		 И ЕСТЬNULL(Аналитика.Номенклатура.ПрослеживаемыйТовар, ЛОЖЬ)
		|		 И ЕстьУведомленияОВвозе.Номенклатура ЕСТЬ NULL)
		//-- Локализация
		|	И НЕ (Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		|		)
		|	И &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|";
КонецФункции

Функция ТекстКонечныеОстаткиПартийТоваров() // использует ЕстьДекларации, НеотфактурованныеПоставки, ЕстьУведомленияОВвозе
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстКонечныеОстаткиПартийТоваров"" 			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)							 КАК ЭтоСторно,
		|	0 												 КАК Приоритет,
		|	0 												 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	Т.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	(ВЫБОР
		|		КОГДА НЕ ЕстьДекларации.Дата ЕСТЬ NULL ТОГДА ЕстьДекларации.Дата
		//++ Локализация
		|		КОГДА НЕ ЕстьУведомленияОВвозе.Дата ЕСТЬ NULL ТОГДА ЕстьУведомленияОВвозе.Дата
		//-- Локализация
		|		КОГДА НЕ ПервичныйДокумент.Дата ЕСТЬ NULL ТОГДА ПервичныйДокумент.Дата
		// Для остатков с партиями период определяется датой партии.
		|		КОГДА НЕ Реестр.ДатаДокументаИБ ЕСТЬ NULL ТОГДА Реестр.ДатаДокументаИБ
		// При учете по ФИФО остатки без партий должны списываться в первую очередь.
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		// При учете по средней остатки без партий должны списываться после остатков с партиями.
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)        КАК Период,
		// Поле ПериодПоступления заполняется аналогично полю Период.
		|	(ВЫБОР
		|		КОГДА НЕ ЕстьДекларации.Дата ЕСТЬ NULL ТОГДА ЕстьДекларации.Дата
		//++ Локализация
		|		КОГДА НЕ ЕстьУведомленияОВвозе.Дата ЕСТЬ NULL ТОГДА ЕстьУведомленияОВвозе.Дата
		//-- Локализация
		|		КОГДА НЕ ПервичныйДокумент.Дата ЕСТЬ NULL ТОГДА ПервичныйДокумент.Дата
		|		КОГДА НЕ Реестр.ДатаДокументаИБ ЕСТЬ NULL ТОГДА Реестр.ДатаДокументаИБ
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)        КАК ПериодПоступления,
		|	Т.Партия										 КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					 КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры 					 КАК АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета				 					 КАК РазделУчета,
		|	Т.ВидЗапасов				 					 КАК ВидЗапасов,
		|	Т.Организация				 					 КАК Организация,
		|	Т.Партия					 					 КАК Партия,
		|	НЕОПРЕДЕЛЕНО									 КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий		 					 КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета  					 КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС		 					 КАК ВидДеятельностиНДС,
		|
		|	Т.Количество 									 КАК Количество,
		|	Т.Стоимость 									 КАК Стоимость,
		|	Т.СтоимостьБезНДС 								 КАК СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансовая 						 КАК СтоимостьЗабалансовая,
		|	Т.СтоимостьУпр 									 КАК СтоимостьУпр,
		|	Т.ДопРасходыУпр 								 КАК ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДС 					 КАК ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДС 					 КАК ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпр 								 КАК ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпр 						 КАК ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпр 						 КАК ПостатейныеПеременныеУпр,
		|	Т.ДопРасходы 								 	 КАК ДопРасходы,
		|	Т.ДопРасходыБезНДС 				 				 КАК ДопРасходыБезНДС,
		|	Т.Трудозатраты 									 КАК Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДС 					 КАК ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДС 					 КАК ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРегл 								 КАК СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРегл 					 КАК СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазница 							 КАК ПостояннаяРазница,
		|	Т.ВременнаяРазница 								 КАК ВременнаяРазница,
		|	Т.ДопРасходыРегл 								 КАК ДопРасходыРегл,
		|	Т.ТрудозатратыРегл 								 КАК ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРегл 					 КАК ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРегл 				   	 КАК ПостатейныеПеременныеРегл,
		|	Т.РезервПодОбесценениеРегл 					     КАК РезервПодОбесценениеРегл,
		|	Т.РезервПодОбесценениеУпр 					     КАК РезервПодОбесценениеУпр,
		|
		|	ЕСТЬNULL(Реестр.ХозяйственнаяОперация,
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)) КАК ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры,
		|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка))	КАК КорАналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорРазделУчета,
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)) КАК КорРазделУчета,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорВидЗапасов,
		|		ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))						КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорПартия,
		|		НЕОПРЕДЕЛЕНО)														КАК КорПартия,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаПартий,
		|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))		КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|		 И ТИПЗНАЧЕНИЯ(ПоступлениеТоваров.Распоряжение) = ТИП(Документ.ЗаказПоставщику)
		|			ТОГДА ПоступлениеТоваров.Распоряжение
		|		ИНАЧЕ ЕСТЬNULL(ПриобретенияТоваровПоЗаказам.ЗаказПоставщику, НЕОПРЕДЕЛЕНО) КОНЕЦ) КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ЛОЖЬ																	КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОстаткиСебестоимостьТоваров КАК Т
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Т.Партия
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДекларации КАК ЕстьДекларации
		|		ПО ЕстьДекларации.Партия = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПервичныйДокумент КАК ПервичныйДокумент
		|		ПО ПервичныйДокумент.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ РеестрДокументовОстаткиПартий КАК Реестр
		|		ПО Реестр.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ НеотфактурованныеПоставки КАК НеотфактурованныеПоставки
		|		ПО НеотфактурованныеПоставки.Партия = Т.Партия
		|		И НеотфактурованныеПоставки.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		И НеотфактурованныеПоставки.ВидЗапасов = Т.ВидЗапасов
		|		И НеотфактурованныеПоставки.РазделУчета = Т.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПриобретенияТоваровПоЗаказам КАК ПриобретенияТоваровПоЗаказам
		|		ПО ПриобретенияТоваровПоЗаказам.Партия = Т.Партия
		|		И ПриобретенияТоваровПоЗаказам.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		И ПриобретенияТоваровПоЗаказам.ВидЗапасов = Т.ВидЗапасов
		|		И ПриобретенияТоваровПоЗаказам.РазделУчета = Т.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровНаСклад КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = Т.Партия
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ЗакупкаВСтранахЕАЭС
		|		ПО ЗакупкаВСтранахЕАЭС.Ссылка = Т.Партия
		|		И ЗакупкаВСтранахЕАЭС.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьУведомленияОВвозе КАК ЕстьУведомленияОВвозе
		|		ПО ЕстьУведомленияОВвозе.Партия = Т.Партия
		|		И ЕстьУведомленияОВвозе.Номенклатура = Аналитика.Номенклатура
		//-- Локализация
		|ГДЕ
		|	Т.Количество > 0
		|	И НЕ (НЕ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|		И НЕ Импорт.Ссылка ЕСТЬ NULL И ЕстьДекларации.Партия ЕСТЬ NULL
		|		И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа))
		//++ Локализация
		|	И НЕ (НЕ ЗакупкаВСтранахЕАЭС.Ссылка ЕСТЬ NULL
		|		 И ЕСТЬNULL(Аналитика.Номенклатура.ПрослеживаемыйТовар, ЛОЖЬ)
		|		 И ЕстьУведомленияОВвозе.Номенклатура ЕСТЬ NULL)
		//-- Локализация
		|	И НЕ (Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		|		)
		|	И НЕ &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|";
КонецФункции

Функция ТекстНачальныеОстаткиНЗП()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиНЗП"" 			 		 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокНЗП) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.КоличествоОстаток < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)							 КАК ЭтоСторно,
		|	0 												 КАК Приоритет,
		|	0 												 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	Т.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	ЕСТЬNULL(Реестр.ДатаДокументаИБ,
		|			&КонецПредыдущегоПериода)				 КАК Период,
		|	ЕСТЬNULL(Реестр.ДатаДокументаИБ,
		|			&КонецПредыдущегоПериода)				 КАК ПериодПоступления,
		|	НЕОПРЕДЕЛЕНО									 КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					 КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры 					 КАК АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета				 					 КАК РазделУчета,
		|	Т.ВидЗапасов				 					 КАК ВидЗапасов,
		|	Т.Организация				 					 КАК Организация,
		|	Т.Партия					 					 КАК Партия,
		|	Т.Партия 										 КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий		 					 КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета  					 КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС		 					 КАК ВидДеятельностиНДС,
		|
		|	Т.КоличествоОстаток 							 КАК Количество,
		|	Т.СтоимостьОстаток 								 КАК Стоимость,
		|	Т.СтоимостьБезНДСОстаток 						 КАК СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансоваяОстаток 					 КАК СтоимостьЗабалансовая,
		|	Т.СтоимостьУпрОстаток 							 КАК СтоимостьУпр,
		|	Т.ДопРасходыУпрОстаток 							 КАК ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДСОстаток 				 КАК ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДСОстаток 			 КАК ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпрОстаток 						 КАК ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпрОстаток 				 КАК ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпрОстаток 				 КАК ПостатейныеПеременныеУпр,
		|	Т.ДопРасходыОстаток 						 	 КАК ДопРасходы,
		|	Т.ДопРасходыБезНДСОстаток 				 		 КАК ДопРасходыБезНДС,
		|	Т.ТрудозатратыОстаток 							 КАК Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДСОстаток 				 КАК ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДСОстаток 			 КАК ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРеглОстаток 							 КАК СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРеглОстаток 				 КАК СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазницаОстаток 						 КАК ПостояннаяРазница,
		|	Т.ВременнаяРазницаОстаток 						 КАК ВременнаяРазница,
		|	Т.ДопРасходыРеглОстаток 						 КАК ДопРасходыРегл,
		|	Т.ТрудозатратыРеглОстаток 						 КАК ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРеглОстаток 				 КАК ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРеглОстаток 			     КАК ПостатейныеПеременныеРегл,
		|	Т.РезервПодОбесценениеРеглОстаток 			     КАК РезервПодОбесценениеРегл,
		|	Т.РезервПодОбесценениеУпрОстаток 			     КАК РезервПодОбесценениеУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ЛОЖЬ																	КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК Т
		|	ЛЕВОЕ СОЕДИНЕНИЕ РеестрДокументовОстаткиПартий КАК Реестр
		|		ПО Реестр.Ссылка = Т.Партия
		|ГДЕ
		|	Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|";
КонецФункции

Функция ТекстТекущиеПриходыПартийТоваров() // использует ЕстьДекларации, ВозвратныеОтходы, ЕстьУведомленияОВвозе
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеПриходыПартийТоваров"" 						КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток)			КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)										КАК ЭтоСторно,
		|	(ВЫБОР
		//++ Локализация
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход И Т.Регистратор ССЫЛКА Документ.КорректировкаВидаДеятельностиНДС ТОГДА 15
		//-- Локализация
		|		КОГДА Т.СлужебноеВидДвиженияПриход ТОГДА 10
		|		ИНАЧЕ 90 КОНЕЦ)											КАК Приоритет,
		|	0 															КАК Знаменатель,
		|	ИСТИНА 														КАК РасчетЗавершен,
		|	Аналитика.Номенклатура										КАК Номенклатура,
		|	ВЫБОР КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|		ТОГДА Т.АналитикаУчетаПартий.НалогообложениеНДС
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ 														КАК НалогообложениеПартии,
		|
		|	Т.Период КАК Период,
		|	ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА Т.Период // для удобства расстановки тегов
		//++ Локализация
		|		КОГДА НЕ ЕстьУведомленияОВвозе.Дата ЕСТЬ NULL ТОГДА ЕстьУведомленияОВвозе.Дата
		//-- Локализация
		|		КОГДА НЕ Исправления.ДатаДокументаИсточника ЕСТЬ NULL
		|			ТОГДА Исправления.ДатаДокументаИсточника
		|		ИНАЧЕ ЕСТЬNULL(ЕстьДекларации.Дата, Т.Период)
		|	КОНЕЦ КАК ПериодПоступления,
		|	Т.Регистратор,
		|	ВЫБОР КОГДА Т.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	ВЫБОР
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 ИЛИ Т.РазделУчета В (
		|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|			ТОГДА Т.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Партия,
		|	(ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ЗаказНаПроизводство,
		|	ВЫБОР
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 ИЛИ Т.РазделУчета В (
		|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|			ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК АналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		ИНАЧЕ Т.АналитикаФинансовогоУчета
		|	КОНЕЦ КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС,
		|
		|	Т.Количество,
		|	Т.Стоимость,
		|	Т.СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансовая,
		|	Т.СтоимостьУпр,
		|	Т.ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпр,
		|	Т.ДопРасходы,
		|	Т.ДопРасходыБезНДС,
		|	Т.Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазница,
		|	Т.ВременнаяРазница,
		|	Т.ДопРасходыРегл,
		|	Т.ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРегл,
		|	Т.РезервПодОбесценениеРегл,
		|	Т.РезервПодОбесценениеУпр,
		|
		|	Т.ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.Партия
		|		ИНАЧЕ Т.КорПартия
		|	КОНЕЦ КАК КорПартия,
		|	ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ Т.КорАналитикаУчетаПартий
		|	КОНЕЦ КАК КорАналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		ИНАЧЕ Т.КорАналитикаФинансовогоУчета
		|	КОНЕЦ КАК КорАналитикаФинансовогоУчета,
		|	Т.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА Т.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА Т.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ Т.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	Т.ВидДеятельностиНДСОтгрузки,
		|	Т.АналитикаФинансовогоУчетаДокумента,
		|	Т.ОперацияУчетаСебестоимости,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	ЕСТЬNULL(Корректировка.ДокументОснование, Т.ДокументИсточник) КАК ДокументИсточник,
		|	(ВЫБОР
		// Для исправительного документа приоритетным источником является сам исправительный документ. 
		|		КОГДА НЕ Исправления.Регистратор ЕСТЬ NULL
		|		 И Т.РазделУчета  = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|			ТОГДА Исправления.Регистратор
		|		КОГДА Т.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|		 И ТИПЗНАЧЕНИЯ(ПоступлениеТоваров.Распоряжение) = ТИП(Документ.ЗаказПоставщику)
		|			ТОГДА ПоступлениеТоваров.Распоряжение
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|		 И НЕ ПриобретениеВидыЗапасов.ЗаказПоставщику ЕСТЬ NULL
		|		 И ПриобретениеВидыЗапасов.ЗаказПоставщику <> ЗНАЧЕНИЕ(Документ.ЗаказПоставщику.ПустаяСсылка)
		|			ТОГДА ПриобретениеВидыЗапасов.ЗаказПоставщику
		|		ИНАЧЕ ЕСТЬNULL(ИсправленныеДокументы.ДокументИсточник, НЕОПРЕДЕЛЕНО) КОНЕЦ) КАК ПриоритетныйИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.НастройкаСчетовУчета,
		|	Т.Сторно,
		|	ЛОЖЬ КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитика
		|		ПО КорАналитика.Ссылка = Т.КорАналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК КорСклады
		|		ПО КорАналитика.МестоХранения = КорСклады.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Т.Партия
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДекларации КАК ЕстьДекларации
		|		ПО ЕстьДекларации.Партия = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровНаСклад КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг.ВидыЗапасов КАК ПриобретениеВидыЗапасов
		|		ПО ПриобретениеВидыЗапасов.Ссылка = Т.Регистратор
		|		И ПриобретениеВидыЗапасов.ИдентификаторСтроки = Т.ИдентификаторСтроки
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ ИсправленныеДокументы КАК ИсправленныеДокументы
		|		ПО ИсправленныеДокументы.ДокументИсточник = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ ИсправленныеДокументы КАК Исправления
		|		ПО Исправления.Регистратор = Т.Регистратор
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ЗакупкаВСтранахЕАЭС
		|		ПО ЗакупкаВСтранахЕАЭС.Ссылка = Т.Партия
		|		И ЗакупкаВСтранахЕАЭС.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьУведомленияОВвозе КАК ЕстьУведомленияОВвозе
		|		ПО ЕстьУведомленияОВвозе.Партия = Т.Регистратор
		|		И ЕстьУведомленияОВвозе.Номенклатура = Аналитика.Номенклатура
		//-- Локализация
		|ГДЕ
		|	Т.Количество <> 0
		|	И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|	И НЕ (НЕ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|		И НЕ Импорт.Ссылка ЕСТЬ NULL И ЕстьДекларации.Партия ЕСТЬ NULL
		|		И Аналитика.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа))
		//++ Локализация
		|	И НЕ (НЕ ЗакупкаВСтранахЕАЭС.Ссылка ЕСТЬ NULL
		|		 И ЕСТЬNULL(Аналитика.Номенклатура.ПрослеживаемыйТовар, ЛОЖЬ)
		|		 И ЕстьУведомленияОВвозе.Номенклатура ЕСТЬ NULL)
		//-- Локализация
		|	И НЕ Т.Сторно
		|	И &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|";
КонецФункции

Функция ТекстОстатокСгруппированный()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстОстатокСгруппированный"" 								КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокСгруппированный) КАК ТипЗаписи,
		|	ЛОЖЬ КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ КАК ЭтоСторно,
		|	90	 КАК Приоритет,
		|	0 	 КАК Знаменатель,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	Аналитика.Номенклатура КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК НалогообложениеПартии,
		|
		|	МИНИМУМ(Т.Период) КАК Период,
		|	МИНИМУМ(Т.Период) КАК ПериодПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДС,
		|
		|	СУММА(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА -Т.Количество
		|		ИНАЧЕ Т.Количество КОНЕЦ) КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорСтоимость,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовСписания,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаДоходов,
		|	НЕОПРЕДЕЛЕНО КАК ПериодПродажи,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
		|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
		|	НЕОПРЕДЕЛЕНО КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДСДокумента,
		|	НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО КАК ОперацияУчетаСебестоимости,
		|	0 КАК НДСУпр,
		|	0 КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	0 КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаХозяйственнойОперации,
		|	"""" КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаСчетовУчета,
		|	ЛОЖЬ КАК Сторно,
		|	ЛОЖЬ КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	Т.Количество <> 0
		|	И Т.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратБезДокументаИсточника))
		|СГРУППИРОВАТЬ ПО
		|	Аналитика.Номенклатура,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация
		|";
КонецФункции

Функция ТекстТекущиеОборотыПартийТоваров() // использует ВозвратныеОтходы
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеОборотыПартийТоваров"" 						КАК ЗапросИсточник,
		|	Т.ТипЗаписи 												КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)										КАК ЭтоСторно,
		|	(ВЫБОР
		//++ Локализация
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход И Т.Регистратор ССЫЛКА Документ.КорректировкаВидаДеятельностиНДС ТОГДА 15
		//-- Локализация
		|		КОГДА Т.СлужебноеВидДвиженияПриход И Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей) ТОГДА 10
		|		ИНАЧЕ 90 КОНЕЦ)											КАК Приоритет,
		|	0 															КАК Знаменатель,
		|	ВЫБОР
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ 														КАК РасчетЗавершен,
		|	Аналитика.Номенклатура										КАК Номенклатура,
		|	ВЫБОР КОГДА (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей) И Т.Организация В (&ОрганизацииСФИФОСкользящая))
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ТОГДА Т.АналитикаУчетаПартий.НалогообложениеНДС
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ 														КАК НалогообложениеПартии,
		|
		|	Т.Период КАК Период,
		|	ВЫБОР
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА &НачалоПериода
		// Для возврата без документа источника перид поступления увеличиваем на 1 секунду,
		// что бы возврат по сортировке был позднее потребления.
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратБезДокументаИсточника)
		|			ТОГДА ДОБАВИТЬКДАТЕ(Т.Период, СЕКУНДА, 1)
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|		 И НЕ ПервичныйДокумент.Дата ЕСТЬ NULL
		|			ТОГДА ПервичныйДокумент.Дата
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И Т.КорРазделУчета В (
		|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты),
		|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
		|			ТОГДА КОНЕЦПЕРИОДА(Т.Период, ДЕНЬ)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|		 И Т.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|			ТОГДА КОНЕЦПЕРИОДА(Т.Период, ДЕНЬ)
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(Т.Период, ДЕНЬ), СЕКУНДА, -1)
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА КОНЕЦПЕРИОДА(Т.Период, ДЕНЬ)
		|		ИНАЧЕ Т.Период
		|	КОНЕЦ КАК ПериодПоступления,
		|	Т.Регистратор,
		|	ВЫБОР КОГДА Т.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	ВЫБОР КОГДА (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая))
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|			И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		ИЛИ Т.Сторно
		|			ТОГДА Т.Партия
		|		КОГДА ВозвратыТоваровПоставщику.ДокументПоступления ЕСТЬ НЕ NULL
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ВозвратыТоваровПоставщику.ДокументПоступления
		//++ Локализация
		|		КОГДА КорректировкаНДС.ДокументПоступления ЕСТЬ НЕ NULL
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА КорректировкаНДС.ДокументПоступления
		//-- Локализация
		|		КОГДА ТИПЗНАЧЕНИЯ(ЕСТЬNULL(ПоступлениеТоваров.Распоряжение, НЕОПРЕДЕЛЕНО)) = ТИП(Документ.ПриобретениеТоваровУслуг)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 	ТОГДА ПоступлениеТоваров.Распоряжение
		|		КОГДА КорректировкаПриобретения.ДокументОснование ЕСТЬ НЕ NULL
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА КорректировкаПриобретения.ДокументОснование
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Партия,
		|	(ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // Для удобства расстановки тегов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ЗаказНаПроизводство,
		|	ВЫБОР КОГДА (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая))
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		ИЛИ Т.Сторно
		|			ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК АналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Т.АналитикаФинансовогоУчетаДокумента <> НЕОПРЕДЕЛЕНО
		|		 И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА Т.АналитикаФинансовогоУчетаДокумента
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|			ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|			ТОГДА Т.АналитикаФинансовогоУчета
		|		ИНАЧЕ Т.КорАналитикаФинансовогоУчета
		|	КОНЕЦ КАК АналитикаФинансовогоУчета,
		|	ВЫБОР
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|		 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА Т.ВидДеятельностиНДС
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
		|				<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		 И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|		 И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|			ТОГДА Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС
		//++ Локализация
		|		КОГДА НЕ КорректировкаНДС.НалогообложениеНДС ЕСТЬ NULL И Т.СлужебноеВидДвиженияПриход
		|			ТОГДА КорректировкаНДС.НовоеНалогообложениеНДС
		|		КОГДА НЕ КорректировкаНДС.НалогообложениеНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА КорректировкаНДС.НалогообложениеНДС
		//-- Локализация
		|		КОГДА НЕ Перемещение.ПеремещениеПодДеятельность ЕСТЬ NULL
		|			ТОГДА
		|				ВЫБОР КОГДА Перемещение.ПеремещениеПодДеятельность <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА Перемещение.ПеремещениеПодДеятельность
		|				КОГДА Т.СлужебноеВидДвиженияПриход
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию КОНЕЦ
		|		КОГДА НЕ ВнутреннееПотребление.ПотреблениеДляДеятельности ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				 И СтатьяСписания.ВидЦенностиНДС В (ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС), ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.НМА))
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию)
		|				КОГДА ВнутреннееПотребление.ПотреблениеДляДеятельности <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА ВнутреннееПотребление.ПотреблениеДляДеятельности
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА НЕ Пересортица.ВидДеятельностиНДС ЕСТЬ NULL
		|			ТОГДА
		|				ВЫБОР КОГДА Пересортица.ВидДеятельностиНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА Пересортица.ВидДеятельностиНДС
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА НЕ Порча.ВидДеятельностиНДС ЕСТЬ NULL
		|			ТОГДА
		|				ВЫБОР КОГДА Порча.ВидДеятельностиНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА Порча.ВидДеятельностиНДС
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА НЕ ПередачаТоваров.НалогообложениеНДС ЕСТЬ NULL ТОГДА
		|			ПередачаТоваров.НалогообложениеНДС
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|		 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
		|			И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноРеализации)
		|			ТОГДА УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|		ИНАЧЕ Т.КорВидДеятельностиНДС
		|	КОНЕЦ КАК ВидДеятельностиНДС,
		|
		|	Т.Количество,
		|	Т.Стоимость,
		|	Т.СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансовая,
		|	Т.СтоимостьУпр,
		|	Т.ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпр,
		|	Т.ДопРасходы,
		|	Т.ДопРасходыБезНДС,
		|	Т.Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазница,
		|	Т.ВременнаяРазница,
		|	Т.ДопРасходыРегл,
		|	Т.ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРегл,
		|	Т.РезервПодОбесценениеРегл,
		|	Т.РезервПодОбесценениеУпр,
		|
		|	Т.ХозяйственнаяОперация,
		// Заполнение поля ПриоритетнаяХозяйственнаяОперация должно быть одинаковым в функциях:
		// - ТекстТекущиеОборотыПартийТоваров()
		// - ТекстСторноДвиженияИсправленныхДокументовТекущегоПериода()
		// - ТекстСторноДвиженияИсправленныхДокументовПрошлогоПериода()
		|	(ВЫБОР
		|		КОГДА Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии))
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И Т.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	(ВЫБОР
		|		КОГДА Т.Подразделение = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяССылка)
		|		 И Т.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки))
		|			ТОГДА ПриобретениеТоваров.Подразделение
		|		ИНАЧЕ Т.Подразделение КОНЕЦ) КАК Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	ВЫБОР КОГДА Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			И (Т.КорПартия <> Т.Регистратор
		|				ИЛИ Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаВПроизводство))
		|			И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|			И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|       	ТОГДА Т.Партия
		|		ИНАЧЕ Т.КорПартия
		|	КОНЕЦ КАК КорПартия,
		|	ВЫБОР КОГДА Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|			И Т.КорПартия <> Т.Регистратор
		|			И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|       	ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ Т.КорАналитикаУчетаПартий
		|	КОНЕЦ КАК КорАналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		КОГДА Т.АналитикаФинансовогоУчетаДокумента <> НЕОПРЕДЕЛЕНО
		|			ТОГДА Т.АналитикаФинансовогоУчетаДокумента
		|		ИНАЧЕ Т.КорАналитикаФинансовогоУчета
		|	КОНЕЦ КАК КорАналитикаФинансовогоУчета,
		|	ВЫБОР
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
		|				<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|			ТОГДА Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС
		|		КОГДА НЕ Перемещение.ПеремещениеПодДеятельность ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Перемещение.ПеремещениеПодДеятельность <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА Перемещение.ПеремещениеПодДеятельность
		|		КОГДА НЕ ВнутреннееПотребление.ПотреблениеДляДеятельности ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				 И СтатьяСписания.ВидЦенностиНДС В (ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС), ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.НМА))
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию)
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				ИНАЧЕ ВнутреннееПотребление.ПотреблениеДляДеятельности КОНЕЦ
		|		КОГДА НЕ КорректировкаНазначения.Ссылка ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ ИсправлениеРазвернутогоСальдо.Ссылка ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Пересортица.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Пересортица.ВидДеятельностиНДС
		|		КОГДА НЕ Порча.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Порча.ВидДеятельностиНДС
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Т.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|		ИНАЧЕ Т.КорВидДеятельностиНДС
		|	КОНЕЦ КАК КорВидДеятельностиНДС,
		|
		|	ВЫБОР
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
		|				<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
		|			ТОГДА Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС
		|		КОГДА НЕ Перемещение.ПеремещениеПодДеятельность ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Перемещение.ПеремещениеПодДеятельность
		|		КОГДА НЕ ВнутреннееПотребление.ПотреблениеДляДеятельности ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				 И СтатьяСписания.ВидЦенностиНДС В (ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС), ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.НМА))
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию)
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				ИНАЧЕ ВнутреннееПотребление.ПотреблениеДляДеятельности КОНЕЦ
		|		КОГДА НЕ КорректировкаНазначения.Ссылка ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ ИсправлениеРазвернутогоСальдо.Ссылка ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Пересортица.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Пересортица.ВидДеятельностиНДС
		|		КОГДА НЕ Порча.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Порча.ВидДеятельностиНДС
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА Т.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА Т.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ Т.КорВидДеятельностиНДС
		|	КОНЕЦ КАК ВидДеятельностиНДСДокумента,
		|	Т.ВидДеятельностиНДСОтгрузки,
		|	Т.АналитикаФинансовогоУчетаДокумента,
		|	Т.ОперацияУчетаСебестоимости,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	ВЫБОР
		|		КОГДА Т.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути))
		|			ТОГДА Т.Регистратор
		|		КОГДА НЕ Т.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		|		ТОГДА НЕОПРЕДЕЛЕНО
		|		ИНАЧЕ Т.ДокументИсточник
		|	КОНЕЦ КАК ДокументИсточник,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|		 И ТИПЗНАЧЕНИЯ(ПоступлениеТоваров.Распоряжение) = ТИП(Документ.ЗаказПоставщику)
		|			ТОГДА ПоступлениеТоваров.Распоряжение
		|		КОГДА Т.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|		 И НЕ ПриобретениеВидыЗапасов.ЗаказПоставщику ЕСТЬ NULL
		|		 И ПриобретениеВидыЗапасов.ЗаказПоставщику <> ЗНАЧЕНИЕ(Документ.ЗаказПоставщику.ПустаяСсылка)
		|			ТОГДА ПриобретениеВидыЗапасов.ЗаказПоставщику
		|		ИНАЧЕ ЕСТЬNULL(ИсправленныеДокументы.Регистратор, НЕОПРЕДЕЛЕНО) КОНЕЦ) КАК ПриоритетныйИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.НастройкаСчетовУчета,
		|	Т.Сторно,
		|	ЛОЖЬ КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитика
		|		ПО КорАналитика.Ссылка = Т.КорАналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК КорСклады
		|		ПО КорАналитика.МестоХранения = КорСклады.Ссылка
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаВидаДеятельностиНДС КАК КорректировкаНДС
		|		ПО КорректировкаНДС.Ссылка = Т.Регистратор
		//-- Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПеремещениеТоваров КАК Перемещение
		|		ПО Перемещение.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаНазначенияТоваров КАК КорректировкаНазначения
		|		ПО КорректировкаНазначения.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров КАК ВнутреннееПотребление
		|		ПО ВнутреннееПотребление.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкаПриобретения
		|		ПО КорректировкаПриобретения.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПересортицаТоваров КАК Пересортица
		|		ПО Пересортица.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПорчаТоваров КАК Порча
		|		ПО Порча.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровНаСклад КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПриобретениеТоваров
		|		ПО ПриобретениеТоваров.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг.ВидыЗапасов КАК ПриобретениеВидыЗапасов
		|		ПО ПриобретениеВидыЗапасов.Ссылка = Т.Регистратор
		|		И ПриобретениеВидыЗапасов.ИдентификаторСтроки = Т.ИдентификаторСтроки
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК ПередачаТоваров
		|		ПО ПередачаТоваров.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПервичныйДокумент КАК ПервичныйДокумент
		|		ПО ПервичныйДокумент.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ИсправлениеРазвернутогоСальдоТоваровОрганизаций КАК ИсправлениеРазвернутогоСальдо
		|		ПО ИсправлениеРазвернутогоСальдо.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровПоставщику.ВидыЗапасов КАК ВозвратыТоваровПоставщику
		|		ПО ВозвратыТоваровПоставщику.Ссылка = Т.Регистратор
		|		И Т.ИдентификаторСтроки = ВозвратыТоваровПоставщику.ИдентификаторСтроки
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизаций
		|		ПО Т.Организация = УчетныеПолитикиОрганизаций.Организация
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьяСписания
		|		ПО СтатьяСписания.Ссылка = Т.СтатьяРасходовСписания
		|	ЛЕВОЕ СОЕДИНЕНИЕ ИсправленныеДокументы КАК ИсправленныеДокументы
		|		ПО ИсправленныеДокументы.Регистратор = Т.Регистратор
		|ГДЕ
		|	(Т.Количество <> 0 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		|	И НЕ Т.Сторно
		|	И (НЕ Т.ВыполненРасчетПартий
		|		ИЛИ &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий)
		// Приходы при реализации по регл учету описаны в функции ТекстТекущиеРеализацииТолькоРегл()
		|	И НЕ (Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)
		|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
		// Получение первичных партий описано в функциях ТекстКонечныеОстаткиПартийТоваров() и ТекстТекущиеПриходыПартийТоваров()
		|	И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|";
КонецФункции

Функция ТекстТекущиеРеализацииТолькоРегл()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеРеализацииТолькоРегл"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ЛОЖЬ КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ КАК ЭтоСторно,
		|	90 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	0 КАК КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	0 КАК НДСУпр,
		|	0 КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)
		|	И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ, // ВидДвижения
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ), // ВидДеятельностиНДСДокумента
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции


Функция ТекстНачальныеОстаткиЗакупокПоИмпорту()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиЗакупокПоИмпорту"" 	  	КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ											КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											КАК ЭтоСторно,
		|	0 										  		КАК Приоритет,
		|	0								  				КАК Знаменатель,
		|	ИСТИНА 											КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 		КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 		КАК НалогообложениеПартии,
		|
		|	&КонецПредыдущегоПериода 	 					КАК Период,
		|	&КонецПредыдущегоПериода 	 					КАК ПериодПоступления,
		|	ДД.Партия 				 	 					КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.КоличествоОстаток КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ЕСТЬNULL(Поступление.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) 		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ЛОЖЬ																	КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Поступление
		|		ПО Поступление.Ссылка = ДД.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ ДокументыПоступления КАК ДокументыПрошлогоПериода
		|		ПО ДокументыПрошлогоПериода.Ссылка = ДД.Партия
		|ГДЕ
		|	(ЕСТЬNULL(Поступление.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ИЛИ ДД.Партия = НЕОПРЕДЕЛЕНО)
		|	И ДокументыПрошлогоПериода.Ссылка ЕСТЬ NULL
		|";
КонецФункции

Функция ТекстНачальныеОстаткиДляКорректировкиПриобретения()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиДляКорректировкиПриобретения"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) 	  КАК ТипЗаписи,
		|	ЛОЖЬ												  КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ												  КАК ЭтоСторно,
		|	0 										  			  КАК Приоритет,
		|	0								  					  КАК Знаменатель,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 			  КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 			  КАК НалогообложениеПартии,
		|
		|	&КонецПредыдущегоПериода 	 						  КАК Период,
		|	&КонецПредыдущегоПериода 	 						  КАК ПериодПоступления,
		|	(ВЫБОР
		|		КОГДА НЕ Корректировка.Ссылка ЕСТЬ NULL ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ)						  КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 						  КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.Количество КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация 												КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ЛОЖЬ																	КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПоступления КАК Поступление
		|		ПО Поступление.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Количество <> 0
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДД.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|";
КонецФункции

Функция ТекстТекущиеЗакупкиПоИмпорту()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеЗакупкиПоИмпорту"" 	  				 		 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Импорт) 			 КАК ТипЗаписи,
		|	ЛОЖЬ														 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														 КАК ЭтоСторно,
		|	10 										  					 КАК Приоритет,
		|	0								  							 КАК Знаменатель,
		|	ИСТИНА 														 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					 КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 					 КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.НДСУпр,
		|	ДД.НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|	И ДД.ХозяйственнаяОперация В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	И НЕ ДД.Сторно
		|";
КонецФункции

Функция ТекстТекущиеДопРасходыБезПартииКРаспределению() // Использует Декларации
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыБезПартииКРаспределению"" 	  		КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК ЭтоСторно,
		|	10 										  					КАК Приоритет,
		|	МАКСИМУМ(Декларации.Количество)								КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Декларации.ДокументПоступления
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ДД.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	СУММА(ДД.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	Декларации.ДокументПоступления КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Декларации КАК Декларации
		|		ПО Декларации.Ссылка = ДД.Регистратор
		|		И Декларации.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Декларации.ВидЗапасов = ДД.ВидЗапасов
		|		И Декларации.СтавкаНДС = ДД.КорАналитикаУчетаПартий.СтавкаНДС
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
		|	И НЕ ДД.Сторно
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ), // ВидДеятельностиНДСДокумента
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.СтатьяКалькуляции,
		|	Декларации.ДокументПоступления,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

Функция ТекстТекущиеДопРасходыСПартиейКРаспределению() // Использует ДекларацииПоПоступлениям
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыСПартиейКРаспределению"" 	  		КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК ЭтоСторно,
		|	10 										  					КАК Приоритет,
		|	МАКСИМУМ(Декларации.Количество)			  					КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	МАКСИМУМ(Декларации.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ДД.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	СУММА(ДД.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДекларацииПоПоступлениям КАК Декларации
		|		ПО Декларации.Ссылка = ДД.Регистратор
		|		И Декларации.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Декларации.ВидЗапасов = ДД.ВидЗапасов
		|		И Декларации.ДокументПоступления = ДД.ДокументИсточник
		|		И Декларации.СтавкаНДС = ДД.КорАналитикаУчетаПартий.СтавкаНДС
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|	И НЕ ДД.Сторно
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ), // ВидДеятельностиНДСДокумента
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

//++ Локализация

Функция ТекстТекущиеДопРасходыСПартиейЗаявленияОВвозе()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыСПартиейЗаявленияОВвозе"" 	  		КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК ЭтоСторно,
		|	10 										  					КАК Приоритет,
		|	СУММА(ТоварыЗаявления.Количество)							КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ДД.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	СУММА(ДД.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявлениеОВвозеТоваров.Товары КАК ТоварыЗаявления
		|		ПО ТоварыЗаявления.ссылка = ДД.Регистратор
		|		И ТоварыЗаявления.ИдентификаторСтроки = ДД.ИдентификаторФинЗаписи
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|	И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки)
		|	И НЕ ДД.Сторно
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ), // ВидДеятельностиНДСДокумента
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

//-- Локализация

Функция ТекстТекущиеДопРасходыСПартиейКорректировкаПриобретения()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыСПартиейКорректировкаПриобретения"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК ЭтоСторно,
		|	10 										  					КАК Приоритет,
		|	0															КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ДД.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	СУММА(ДД.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|	И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки)
		|	И НЕ ДД.Сторно
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ), // ВидДеятельностиНДСДокумента
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

Функция ТекстКорректировкиПриобретения()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстКорректировкиПриобретения""							КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК ЭтоСторно,
		|	10 										  					КАК Приоритет,
		|	0															КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ДД.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	СУММА(ДД.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|	И НЕ ДД.Сторно
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	(ВЫБОР
		|		КОГДА ДД.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДСДокумента
		|		ИНАЧЕ ДД.ВидДеятельностиНДС КОНЕЦ), // ВидДеятельностиНДСДокумента
		|	ДД.АналитикаФинансовогоУчетаДокумента,
		|	ДД.ОперацияУчетаСебестоимости,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.НастройкаХозяйственнойОперации,
		|	ДД.ИдентификаторФинЗаписи,
		|	ДД.НастройкаСчетовУчета,
		|	ДД.Сторно,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцев() // использует ПрошлыеРеализации 
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцев"" 	  			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											 КАК ЭтоСторно,
		|	0 										  		 КАК Приоритет,
		|	0								  				 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА Прошлые.ВидЗапасов
		|		ИНАЧЕ ДД.ВидЗапасов КОНЕЦ) КАК ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДС
		|		ИНАЧЕ ДД.КорВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДС,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) 		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	Прошлые.ДокументИсточник												КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ДД.ВыполненРасчетПартий													КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализации КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументРеализации
		|		И ДД.АналитикаУчетаНоменклатуры = Прошлые.АналитикаУчетаНоменклатуры
		|		И (ДД.ВидЗапасов = Прошлые.ВидЗапасов
		|			ИЛИ ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
		|ГДЕ
		|	ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Активность
		|	И НЕ ДД.РасчетСебестоимости
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДД.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|	И НЕ ДД.Сторно
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА Прошлые.ВидЗапасов
		|		ИНАЧЕ ДД.ВидЗапасов КОНЕЦ),
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДС
		|		ИНАЧЕ ДД.КорВидДеятельностиНДС КОНЕЦ),
		|	Прошлые.ДокументИсточник,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

Функция ТекстОтчетыКомиссионеровПрошлыхМесяцев() // использует ВозвратыБезДокументаИсточника 
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстОтчетыКомиссионеровПрошлыхМесяцев"" 	  	 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											 КАК ЭтоСторно,
		|	0 										  		 КАК Приоритет,
		|	0								  				 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	МАКСИМУМ(ДД.Период) КАК Период,
		|	МАКСИМУМ(ДД.Период) КАК ПериодПоступления,
		|	МАКСИМУМ(ДД.Регистратор) КАК Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА Прошлые.ВидЗапасов
		|		ИНАЧЕ ДД.ВидЗапасов КОНЕЦ) КАК ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) 		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС 												КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ДД.ВидДеятельностиНДСОтгрузки 											КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО 															КАК ОперацияУчетаСебестоимости,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаХозяйственнойОперации,
		|	НЕОПРЕДЕЛЕНО															КАК ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО															КАК НастройкаСчетовУчета,
		|	ЛОЖЬ																	КАК Сторно,
		|	ДД.ВыполненРасчетПартий													КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО															КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВозвратыБезДокументаИсточника КАК Прошлые
		|		ПО Прошлые.Организация = ДД.Организация
		|		И Прошлые.РазделУчета = ДД.РазделУчета
		|		И Прошлые.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И (Прошлые.ВидЗапасов = ДД.ВидЗапасов
		|			ИЛИ ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
		|ГДЕ
		|	ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Период < &НачалоПериода
		|	И ДД.Активность
		|	И НЕ ДД.РасчетСебестоимости
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|	И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетКомиссионера)
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДД.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|	И НЕ ДД.Сторно
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС,
		|	ДД.ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА Прошлые.ВидЗапасов
		|		ИНАЧЕ ДД.ВидЗапасов КОНЕЦ),
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДСОтгрузки,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.ВыполненРасчетПартий
		|";
КонецФункции

Функция ТекстСторноДвиженияИсправленныхДокументовТекущегоПериода() // использует ИсправленныеДокументы
	
	// Заполнение полей должно соответствовать функции ПартионныйУчетСервер.ТекстыЗапросовСторнирования():
	// Регистратор, Период, ТипЗаписи, ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов
	Возврат " 
		|ВЫБРАТЬ
		|	""ТекстСторноДвиженияИсправленныхДокументовТекущегоПериода"" КАК ЗапросИсточник,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		// Для возврата товаров от клиента оставляем текущие типы записей
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА ДанныеРегистра.ТипЗаписи
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратаПрошлыхПериодов)
		// Приходные движения
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноДопРасходов)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ИсправлениеТекущегоПериода)
		// Расходные движения
		// Для реализации товаров между организациями отдельное правило
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноПотребления)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноПотребления)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноСписанияНаДругиеПартии)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозврата)
		|
		|		ИНАЧЕ ДанныеРегистра.ТипЗаписи КОНЕЦ) КАК ТипЗаписи,
		|	ЛОЖЬ КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|		 И ДанныеРегистра.Количество < 0
		|			ТОГДА ЛОЖЬ
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА КОНЕЦ) КАК ЭтоСторно,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА 90 
		|		ИНАЧЕ 0 КОНЕЦ)                                   КАК Приоритет,
		|	-МАКСИМУМ(Декларации.Количество)                     КАК Знаменатель,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|		 И ДанныеРегистра.Количество < 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход И ДанныеРегистра.Количество = 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ИСТИНА		
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)                                КАК РасчетЗавершен,
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры.Номенклатура           КАК Номенклатура,
		|	ДанныеРегистра.АналитикаУчетаПартий.НалогообложениеНДС           КАК НалогообложениеПартии,
		|
		|	ИсправленныеДокументы.Период,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ДАТАВРЕМЯ(1,1,1)
		// Корректировка приобретения текущего периода должна быть отработана раньше других приемников.
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно))
		|			ТОГДА &НачалоПериода
		|		ИНАЧЕ ДанныеРегистра.Период КОНЕЦ) КАК ПериодПоступления,
		|	ИсправленныеДокументы.Регистратор,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КОНЕЦ) КАК ВидДвижения,
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.РазделУчета,
		|	ДанныеРегистра.ВидЗапасов,
		|	ДанныеРегистра.Организация,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ДанныеРегистра.Партия
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА ДанныеРегистра.Партия
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
		|		 И ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 И ДанныеРегистра.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|		 И ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДанныеРегистра.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ДанныеРегистра.АналитикаУчетаПартий
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА ДанныеРегистра.АналитикаУчетаПартий
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|		 И ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДанныеРегистра.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК АналитикаУчетаПартий,
		|	ДанныеРегистра.АналитикаФинансовогоУчета,
		|	ДанныеРегистра.ВидДеятельностиНДС,
		|
		|	-СУММА(ДанныеРегистра.Количество) КАК Количество,
		|	-СУММА(ДанныеРегистра.Стоимость) КАК Стоимость,
		|	-СУММА(ДанныеРегистра.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	-СУММА(ДанныеРегистра.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	-СУММА(ДанныеРегистра.СтоимостьУпр) КАК СтоимостьУпр,
		|	-СУММА(ДанныеРегистра.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	-СУММА(ДанныеРегистра.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	-СУММА(ДанныеРегистра.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	-СУММА(ДанныеРегистра.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	-СУММА(ДанныеРегистра.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	-СУММА(ДанныеРегистра.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	-СУММА(ДанныеРегистра.ДопРасходы) КАК ДопРасходы,
		|	-СУММА(ДанныеРегистра.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	-СУММА(ДанныеРегистра.Трудозатраты) КАК Трудозатраты,
		|	-СУММА(ДанныеРегистра.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	-СУММА(ДанныеРегистра.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	-СУММА(ДанныеРегистра.СтоимостьРегл) КАК СтоимостьРегл,
		|	-СУММА(ДанныеРегистра.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	-СУММА(ДанныеРегистра.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	-СУММА(ДанныеРегистра.ВременнаяРазница) КАК ВременнаяРазница,
		|	-СУММА(ДанныеРегистра.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	-СУММА(ДанныеРегистра.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	-СУММА(ДанныеРегистра.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	-СУММА(ДанныеРегистра.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	-СУММА(ДанныеРегистра.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	-СУММА(ДанныеРегистра.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	ДанныеРегистра.ХозяйственнаяОперация,
		// Заполнение поля ПриоритетнаяХозяйственнаяОперация должно быть одинаковым в функциях:
		// - ТекстТекущиеОборотыПартийТоваров()
		// - ТекстСторноДвиженияИсправленныхДокументовТекущегоПериода()
		// - ТекстСторноДвиженияИсправленныхДокументовПрошлогоПериода()
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии))
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И ДанныеРегистра.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДанныеРегистра.КорАналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.КорРазделУчета,
		|	ДанныеРегистра.КорВидЗапасов,
		|	ДанныеРегистра.КорОрганизация,
		|	ДанныеРегистра.КорСтоимость,
		|	ДанныеРегистра.АналитикаУчетаПоПартнерам,
		|	ДанныеРегистра.ЗаказКлиента,
		|	ДанныеРегистра.Подразделение,
		|	ДанныеРегистра.АналитикаРасходов,
		|	ДанныеРегистра.СтатьяРасходовСписания,
		|	ДанныеРегистра.СтатьяДоходов,
		|	ДанныеРегистра.АналитикаДоходов,
		|	ДанныеРегистра.ПериодПродажи,
		|	ДанныеРегистра.СтатьяАктивовПассивов,
		|	ДанныеРегистра.АналитикаАктивовПассивов,
		|	ДанныеРегистра.ДокументДвижения,
		|	ДанныеРегистра.ИдентификаторСтроки,
		|	ДанныеРегистра.ГруппаПродукции,
		|	ДанныеРегистра.КорПартия,
		|	ДанныеРегистра.КорАналитикаУчетаПартий,
		|	ДанныеРегистра.КорАналитикаФинансовогоУчета,
		|	ДанныеРегистра.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		ИНАЧЕ ДанныеРегистра.КорВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДСДокумента,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДСОтгрузки,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход ТОГДА НЕОПРЕДЕЛЕНО
		|		ИНАЧЕ ДанныеРегистра.АналитикаФинансовогоУчетаДокумента КОНЕЦ) КАК АналитикаФинансовогоУчетаДокумента,
		|	ДанныеРегистра.ОперацияУчетаСебестоимости,
		|	-СУММА(ДанныеРегистра.НДСУпр) КАК НДСУпр,
		|	-СУММА(ДанныеРегистра.НДСРегл) КАК НДСРегл,
		|	ДанныеРегистра.СтатьяКалькуляции,
		|	(ВЫБОР
		// Для реализации товаров между организациями отдельное правило
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
		|			ТОГДА ДанныеРегистра.Регистратор
		// При возврате товаров от клиента на другой склад ДокументИсточник заполняется исправительный документом.
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА ИсправленныеДокументы.Регистратор
		//	При сторнировании возврата товаров от клиента прошлого периода ДокументИсточник заполняется документом реализации
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ИсправленныеДокументы.Регистратор
		// При сторнировании доп расходов с указанной партией ДокументИсточник заполняется партией (из исходного документа- источника)
		// Это необходимо для построения цепочки ДопРасходыСПартией <- СторноДопРасходов
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|
		|		ИНАЧЕ ДанныеРегистра.Регистратор КОНЕЦ) КАК ДокументИсточник,
		|	ДанныеРегистра.Регистратор КАК ПриоритетныйИсточник,
		|	ДанныеРегистра.КорНаправлениеДеятельности,
		|	ДанныеРегистра.КодСтроки,
		|	ДанныеРегистра.НастройкаХозяйственнойОперации,
		|	ДанныеРегистра.ИдентификаторФинЗаписи,
		|	ДанныеРегистра.НастройкаСчетовУчета,
		|	ИСТИНА КАК Сторно,
		|	ДанныеРегистра.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДанныеРегистра
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИсправленныеДокументы КАК ИсправленныеДокументы
		|		ПО ИсправленныеДокументы.ДокументИсточник = ДанныеРегистра.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ ДекларацииПоПоступлениям КАК Декларации
		|		ПО Декларации.Ссылка = ДанныеРегистра.Регистратор
		|		И Декларации.АналитикаУчетаНоменклатуры = ДанныеРегистра.АналитикаУчетаНоменклатуры
		|		И Декларации.ВидЗапасов = ДанныеРегистра.ВидЗапасов
		|		И Декларации.ДокументПоступления = ДанныеРегистра.ДокументИсточник
		|		И Декларации.СтавкаНДС = ДанныеРегистра.КорАналитикаУчетаПартий.СтавкаНДС
		|ГДЕ
		|	НЕ ДанныеРегистра.РасчетСебестоимости
		|	И НЕ ДанныеРегистра.РасчетПартий
		|	И НЕ ДанныеРегистра.Сторно
		|
		|СГРУППИРОВАТЬ ПО
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		// Для возврата товаров от клиента оставляем текущие типы записей
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА ДанныеРегистра.ТипЗаписи
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратаПрошлыхПериодов)
		// Приходные движения
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноДопРасходов)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ИсправлениеТекущегоПериода)
		// Расходные движения
		// Для реализации товаров между организациями отдельное правило
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноПотребления)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноПотребления)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноСписанияНаДругиеПартии)
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозврата)
		|
		|		ИНАЧЕ ДанныеРегистра.ТипЗаписи КОНЕЦ), // ТипЗаписи
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|		 И ДанныеРегистра.Количество < 0
		|			ТОГДА ЛОЖЬ
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА КОНЕЦ), // ЭтоСторно
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА 90 
		|		ИНАЧЕ 0 КОНЕЦ), // Приоритет
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|		 И ДанныеРегистра.Количество < 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход И ДанныеРегистра.Количество = 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ИСТИНА		
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ), // РасчетЗавершен
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДанныеРегистра.АналитикаУчетаПартий.НалогообложениеНДС,
		|	ДанныеРегистра.Период,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно))
		|			ТОГДА &НачалоПериода
		|		ИНАЧЕ ДанныеРегистра.Период КОНЕЦ), // ПериодПоступления
		|	ИсправленныеДокументы.Период,
		|	ИсправленныеДокументы.Регистратор,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КОНЕЦ),
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.РазделУчета,
		|	ДанныеРегистра.ВидЗапасов,
		|	ДанныеРегистра.Организация,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ДанныеРегистра.Партия
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА ДанныеРегистра.Партия
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
		|		 И ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 И ДанныеРегистра.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|		 И ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДанныеРегистра.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ), // Партия
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ДанныеРегистра.АналитикаУчетаПартий
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА ДанныеРегистра.АналитикаУчетаПартий
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|		 И ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДанныеРегистра.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДанныеРегистра.АналитикаФинансовогоУчета,
		|	ДанныеРегистра.ВидДеятельностиНДС,
		|	ДанныеРегистра.ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии))
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И ДанныеРегистра.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ), // ПриоритетнаяХозяйственнаяОперация
		|	ДанныеРегистра.КорАналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.КорРазделУчета,
		|	ДанныеРегистра.КорВидЗапасов,
		|	ДанныеРегистра.КорОрганизация,
		|	ДанныеРегистра.КорСтоимость,
		|	ДанныеРегистра.АналитикаУчетаПоПартнерам,
		|	ДанныеРегистра.ЗаказКлиента,
		|	ДанныеРегистра.Подразделение,
		|	ДанныеРегистра.АналитикаРасходов,
		|	ДанныеРегистра.СтатьяРасходовСписания,
		|	ДанныеРегистра.СтатьяДоходов,
		|	ДанныеРегистра.АналитикаДоходов,
		|	ДанныеРегистра.ПериодПродажи,
		|	ДанныеРегистра.СтатьяАктивовПассивов,
		|	ДанныеРегистра.АналитикаАктивовПассивов,
		|	ДанныеРегистра.ДокументДвижения,
		|	ДанныеРегистра.ИдентификаторСтроки,
		|	ДанныеРегистра.ГруппаПродукции,
		|	ДанныеРегистра.КорПартия,
		|	ДанныеРегистра.КорАналитикаУчетаПартий,
		|	ДанныеРегистра.КорАналитикаФинансовогоУчета,
		|	ДанныеРегистра.КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		ИНАЧЕ ДанныеРегистра.КорВидДеятельностиНДС КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.СлужебноеВидДвиженияПриход ТОГДА НЕОПРЕДЕЛЕНО
		|		ИНАЧЕ ДанныеРегистра.АналитикаФинансовогоУчетаДокумента КОНЕЦ), // АналитикаФинансовогоУчетаДокумента
		|	ДанныеРегистра.ОперацияУчетаСебестоимости,
		|	ДанныеРегистра.СтатьяКалькуляции,
		|	(ВЫБОР
		// Для реализации товаров между организациями отдельное правило
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
		|			ТОГДА ДанныеРегистра.Регистратор
		// При возврате товаров от клиента на другой склад ДокументИсточник заполняется исправительный документом.
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА ИсправленныеДокументы.Регистратор
		//	При сторнировании возврата товаров от клиента прошлого периода ДокументИсточник заполняется документом реализации
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ИсправленныеДокументы.Регистратор
		// При сторнировании доп расходов с указанной партией ДокументИсточник заполняется партией (из исходного документа- источника)
		// Это необходимо для построения цепочки ДопРасходыСПартией <- СторноДопРасходов
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|
		|		ИНАЧЕ ДанныеРегистра.Регистратор КОНЕЦ), // ДокументИсточник
		|	ДанныеРегистра.Регистратор, // ПриоритетныйИсточник
		|	ДанныеРегистра.КорНаправлениеДеятельности,
		|	ДанныеРегистра.КодСтроки,
		|	ДанныеРегистра.НастройкаХозяйственнойОперации,
		|	ДанныеРегистра.ИдентификаторФинЗаписи,
		|	ДанныеРегистра.НастройкаСчетовУчета,
		|	ДанныеРегистра.ВыполненРасчетПартий
		|";
КонецФункции

Функция ТекстСторноДвиженияИсправленныхДокументовПрошлогоПериода() // использует ИсправленныеДокументы
	
	// Заполнение полей должно соответствовать функциям ПартионныйУчетСервер.ТекстыЗапросовСторнирования() и
	// РасчетСебестоимостиКорректировкаСтоимости.СкорректироватьСтоимостьСторноДвиженийИсправленныхДокументов()
	// Поля: Регистратор, Период, ТипЗаписи, ДокументИсточник 
	Возврат " 
		|ВЫБРАТЬ
		|	""ТекстСторноДвиженияИсправленныхДокументовПрошлогоПериода""        КАК ЗапросИсточник,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпускСторноПрошлогоПериода)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДополнениеПрошлыйПериод)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратаПрошлыхПериодов)
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
		|		КОГДА ДанныеРегистра.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		 ИЛИ ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ИсправлениеПрошлогоПериода) КОНЕЦ) КАК ТипЗаписи,
		|	ЛОЖЬ                                                 КАК ЭтоТочноРасчетноеДвижение,
		|	ИСТИНА                                               КАК ЭтоСторно,
		|	0                                                    КАК Приоритет,
		|	0                                                    КАК Знаменатель,
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 ИЛИ ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов)
		|		 И ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионераПрошлыхПериодов)
		|		 И ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) И ДанныеРегистра.Количество = 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДанныеРегистра.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		 ИЛИ ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА КОНЕЦ)                              КАК РасчетЗавершен,
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДанныеРегистра.АналитикаУчетаПартий.НалогообложениеНДС КАК НалогообложениеПартии,
		|
		|	ИсправленныеДокументы.Период,
		|	(ВЫБОР
		|		КОГДА НЕ Реестр.ДатаДокументаИБ ЕСТЬ NULL ТОГДА Реестр.ДатаДокументаИБ
		|		КОГДА ДанныеРегистра.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)            КАК ПериодПоступления,
		|	ИсправленныеДокументы.Регистратор,
		|	ДанныеРегистра.ВидДвижения,
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.РазделУчета,
		|	ДанныеРегистра.ВидЗапасов,
		|	ДанныеРегистра.Организация,
		|	ДанныеРегистра.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДанныеРегистра.АналитикаУчетаПартий,
		|	ДанныеРегистра.АналитикаФинансовогоУчета,
		|	ДанныеРегистра.ВидДеятельностиНДС,
		|
		|	-ДанныеРегистра.Количество,
		|	-ДанныеРегистра.Стоимость,
		|	-ДанныеРегистра.СтоимостьБезНДС,
		|	-ДанныеРегистра.СтоимостьЗабалансовая,
		|	-ДанныеРегистра.СтоимостьУпр,
		|	-ДанныеРегистра.ДопРасходыУпр,
		|	-ДанныеРегистра.ПостатейныеПеременныеСНДС,
		|	-ДанныеРегистра.ПостатейныеПеременныеБезНДС,
		|	-ДанныеРегистра.ТрудозатратыУпр,
		|	-ДанныеРегистра.ПостатейныеПостоянныеУпр,
		|	-ДанныеРегистра.ПостатейныеПеременныеУпр,
		|	-ДанныеРегистра.ДопРасходы,
		|	-ДанныеРегистра.ДопРасходыБезНДС,
		|	-ДанныеРегистра.Трудозатраты,
		|	-ДанныеРегистра.ПостатейныеПостоянныеСНДС,
		|	-ДанныеРегистра.ПостатейныеПостоянныеБезНДС,
		|	-ДанныеРегистра.СтоимостьРегл,
		|	-ДанныеРегистра.СтоимостьЗабалансоваяРегл,
		|	-ДанныеРегистра.ПостояннаяРазница,
		|	-ДанныеРегистра.ВременнаяРазница,
		|	-ДанныеРегистра.ДопРасходыРегл,
		|	-ДанныеРегистра.ТрудозатратыРегл,
		|	-ДанныеРегистра.ПостатейныеПостоянныеРегл,
		|	-ДанныеРегистра.ПостатейныеПеременныеРегл,
		|	-ДанныеРегистра.РезервПодОбесценениеРегл,
		|	-ДанныеРегистра.РезервПодОбесценениеУпр,
		|
		|	ДанныеРегистра.ХозяйственнаяОперация,
		// Заполнение поля ПриоритетнаяХозяйственнаяОперация должно быть одинаковым в функциях:
		// - ТекстТекущиеОборотыПартийТоваров()
		// - ТекстСторноДвиженияИсправленныхДокументовТекущегоПериода()
		// - ТекстСторноДвиженияИсправленныхДокументовПрошлогоПериода()
		|	(ВЫБОР
		|		КОГДА ДанныеРегистра.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии))
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И ДанныеРегистра.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДанныеРегистра.КорАналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.КорРазделУчета,
		|	ДанныеРегистра.КорВидЗапасов,
		|	ДанныеРегистра.КорОрганизация,
		|	ДанныеРегистра.КорСтоимость,
		|	ДанныеРегистра.АналитикаУчетаПоПартнерам,
		|	ДанныеРегистра.ЗаказКлиента,
		|	ДанныеРегистра.Подразделение,
		|	ДанныеРегистра.АналитикаРасходов,
		|	ДанныеРегистра.СтатьяРасходовСписания,
		|	ДанныеРегистра.СтатьяДоходов,
		|	ДанныеРегистра.АналитикаДоходов,
		|	ДанныеРегистра.ПериодПродажи,
		|	ДанныеРегистра.СтатьяАктивовПассивов,
		|	ДанныеРегистра.АналитикаАктивовПассивов,
		|	ДанныеРегистра.ДокументДвижения,
		|	ДанныеРегистра.ИдентификаторСтроки,
		|	ДанныеРегистра.ГруппаПродукции,
		|	ДанныеРегистра.КорПартия,
		|	ДанныеРегистра.КорАналитикаУчетаПартий,
		|	ДанныеРегистра.КорАналитикаФинансовогоУчета,
		|	ДанныеРегистра.КорВидДеятельностиНДС,
		|	ДанныеРегистра.ВидДеятельностиНДСДокумента,
		|	ДанныеРегистра.ВидДеятельностиНДСОтгрузки,
		|	ДанныеРегистра.АналитикаФинансовогоУчетаДокумента,
		|	ДанныеРегистра.ОперацияУчетаСебестоимости,
		|	-ДанныеРегистра.НДСУпр,
		|	-ДанныеРегистра.НДСРегл,
		|	ДанныеРегистра.СтатьяКалькуляции,
		|	(ВЫБОР
		// При возврате товаров от клиента на другой склад ДокументИсточник заполняется исправительный документом.
		|		КОГДА ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента)
		|		 И ДанныеРегистра.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|			ТОГДА ИсправленныеДокументы.Регистратор
		// При исправлении записей корректировки стоимости ДокумаентИсточник заполняется исходным документом - источником.
		|		КОГДА ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
		|			ТОГДА ДанныеРегистра.ДокументИсточник
		|		ИНАЧЕ ДанныеРегистра.Регистратор КОНЕЦ) КАК ДокументИсточник,
		|	ИсправленныеДокументы.Регистратор КАК ПриоритетныйИсточник,
		|	ДанныеРегистра.КорНаправлениеДеятельности,
		|	ДанныеРегистра.КодСтроки,
		|	ДанныеРегистра.НастройкаХозяйственнойОперации,
		|	ДанныеРегистра.ИдентификаторФинЗаписи,
		|	ДанныеРегистра.НастройкаСчетовУчета,
		|	ИСТИНА КАК Сторно,
		|	ДанныеРегистра.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДанныеРегистра
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИсправленныеДокументы КАК ИсправленныеДокументы
		|		ПО ИсправленныеДокументы.ДокументИсточник = ДанныеРегистра.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДанныеРегистра.Партия
		|		И НЕ Реестр.ДополнительнаяЗапись
		|		И ДанныеРегистра.Партия <> НЕОПРЕДЕЛЕНО
		|ГДЕ
		|	ДанныеРегистра.Организация В (&МассивОрганизаций)
		|	И ДанныеРегистра.Период < &НачалоПериода
		|	И ДанныеРегистра.Активность
		|	И НЕ ДанныеРегистра.РасчетСебестоимости
		|	И (НЕ ДанныеРегистра.РасчетПартий
		|		ИЛИ ДанныеРегистра.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск))
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДанныеРегистра.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|	И НЕ ДанныеРегистра.Сторно
		|";
КонецФункции

Функция ТекстДвиженияСПодобраннымиПартиями()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстДвиженияСПодобраннымиПартиями"" 						КАК ЗапросИсточник,
		|	Т.ТипЗаписи 												КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)										КАК ЭтоСторно,
		|	10															КАК Приоритет,
		|	0 															КАК Знаменатель,
		|	ИСТИНА 														КАК РасчетЗавершен,
		|	Аналитика.Номенклатура										КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО												КАК НалогообложениеПартии,
		|
		|	Т.Период КАК Период,
		|	Т.Период КАК ПериодПоступления,
		|	Т.Регистратор,
		|	ВЫБОР КОГДА Т.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	Т.Партия КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	СУММА(Т.Количество) КАК Количество,
		|	СУММА(Т.Стоимость) КАК Стоимость,
		|	СУММА(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(Т.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(Т.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(Т.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(Т.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(Т.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(Т.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(Т.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(Т.ДопРасходы) КАК ДопРасходы,
		|	СУММА(Т.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(Т.Трудозатраты) КАК Трудозатраты,
		|	СУММА(Т.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(Т.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(Т.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(Т.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(Т.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(Т.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(Т.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(Т.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(Т.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(Т.РезервПодОбесценениеРегл) КАК РезервПодОбесценениеРегл,
		|	СУММА(Т.РезервПодОбесценениеУпр) КАК РезервПодОбесценениеУпр,
		|
		|	Т.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.Партия
		|		ИНАЧЕ Т.КорПартия КОНЕЦ) КАК КорПартия,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ Т.КорАналитикаУчетаПартий КОНЕЦ) КАК КорАналитикаУчетаПартий,
		|	Т.КорАналитикаФинансовогоУчета,
		|	Т.КорВидДеятельностиНДС,
		|	Т.ВидДеятельностиНДСДокумента,
		|	Т.ВидДеятельностиНДСОтгрузки,
		|	Т.АналитикаФинансовогоУчетаДокумента,
		|	Т.ОперацияУчетаСебестоимости,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	Т.ДокументИсточник КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.НастройкаСчетовУчета,
		|	Т.Сторно,
		|	Т.ВыполненРасчетПартий,
		|	Т.РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	Т.Количество <> 0
		|	И Т.ВыполненРасчетПартий
		|	И НЕ Т.Сторно
		|	И НЕ &ВосстанавливатьХронологическуюПоследовательностьСписанияПартий
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ), // ЭтоСторно
		|	Аналитика.Номенклатура,
		|	Т.Период,
		|	Т.Регистратор,
		|	ВЫБОР КОГДА Т.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ, // ВидДвижения
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	Т.Партия,
		|	Т.АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС,
		|	Т.ХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.Партия
		|		ИНАЧЕ Т.КорПартия КОНЕЦ), // КорПартия
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ Т.КорАналитикаУчетаПартий КОНЕЦ), // КорАналитикаУчетаПартий
		|	Т.КорАналитикаФинансовогоУчета,
		|	Т.КорВидДеятельностиНДС,
		|	Т.ВидДеятельностиНДСДокумента,
		|	Т.ВидДеятельностиНДСОтгрузки,
		|	Т.АналитикаФинансовогоУчетаДокумента,
		|	Т.ОперацияУчетаСебестоимости,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	Т.ДокументИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.НастройкаСчетовУчета,
		|	Т.Сторно,
		|	Т.ВыполненРасчетПартий,
		|	Т.РежимЗакрытияМесяца
		|";
КонецФункции

Функция ТекстКорректировкаСтоимостиТМЦОприходованныхПриВыбытииОС()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстКорректировкаСтоимостиТМЦОприходованныхПриВыбытииОС"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ЛОЖЬ КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ КАК ЭтоСторно,
		|	10 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	ИСТИНА КАК РасчетЗавершен,
		|	Аналитика.Номенклатура КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК НалогообложениеПартии,
		|
		|	Т.Период КАК Период,
		|	Т.Период КАК ПериодПоступления,
		|	Т.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	Т.Партия КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	ПрочиеРасходы.Сумма КАК Стоимость,
		|	ПрочиеРасходы.СуммаБезНДС КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	ПрочиеРасходы.СуммаУпр КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	ПрочиеРасходы.СуммаРегл КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	ПрочиеРасходы.ПостояннаяРазница КАК ПостояннаяРазница,
		|	ПрочиеРасходы.ВременнаяРазница КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаСтоимостиТМЦОприходованныхПриВыбытииОС) КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.Партия
		|		ИНАЧЕ Т.КорПартия КОНЕЦ) КАК КорПартия,
		|	(ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ Т.КорАналитикаУчетаПартий КОНЕЦ) КАК КорАналитикаУчетаПартий,
		|	Т.КорАналитикаФинансовогоУчета,
		|	Т.КорВидДеятельностиНДС,
		|	Т.ВидДеятельностиНДСДокумента,
		|	Т.ВидДеятельностиНДСОтгрузки,
		|	Т.АналитикаФинансовогоУчетаДокумента,
		|	Т.ОперацияУчетаСебестоимости,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	Т.ДокументИсточник КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки,
		|	ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.КорректировкаСтоимостиТМЦОприходованныхПриВыбытииОС) КАК НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.НастройкаСчетовУчета,
		|	Т.Сторно,
		|	ИСТИНА КАК ВыполненРасчетПартий,
		|	&РежимЗакрытияМесяца КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПрочиеРасходы КАК ПрочиеРасходы
		|		ПО ПрочиеРасходы.Регистратор = Т.Регистратор
		|		И ПрочиеРасходы.Период = Т.Период
		|		И ПрочиеРасходы.ИдентификаторФинЗаписи = Т.ИдентификаторФинЗаписи
		|ГДЕ
		|	Т.Количество <> 0
		|	И Т.СлужебноеВидДвиженияПриход
		|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеТоваров)
		|	И Т.НастройкаХозяйственнойОперации = ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ОприходованиеПриВыбытииОС)
		|	И НЕ Т.Сторно
		|	И ПрочиеРасходы.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаСтоимостиТМЦОприходованныхПриВыбытииОС)
		|";
КонецФункции


// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюСебестоимостиТоваров(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	Если (Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
			ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение)
	 И Не ЗначениеЗаполнено(Расход.ЗаказНаПроизводство)
	 И ЗначениеЗаполнено(Расход.РазделУчета)
	 И Расход.РазделУчета <> Приход.РазделУчета Тогда
		Возврат;
	
	//++ Устарело_Производство21	
	//-- Устарело_Производство21
	// Для доп. расходов, отраженных таможенной декларацией на импорт исключаем источники, отличные от закупки по импорту.
	ИначеЕсли (Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией)
	 И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.СторноДопРасходов
	 И ЗначениеЗаполнено(Приход.ХозяйственнаяОперация)
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаПоИмпорту
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути Тогда
		Возврат;
		
	// Для корректировки приобретения должна подбираться партия, соответствующая корректируемому приобретению.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И Расход.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки
	 И ЗначениеЗаполнено(Приход.Партия)
	 И ЗначениеЗаполнено(Расход.Партия)
	 И Приход.Партия <> Расход.Партия
	 И Приход.ДокументИсточник <> Расход.Партия Тогда
		Возврат;
		
	// Для фактуровки поставки должна подбираться только партия, образованная неотфактурованной поставкой.
	ИначеЕсли Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки
	 И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка
	 ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
	 И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка Тогда
		Возврат;
		
	// Для возврата без документа источника не может быть источником возврат товаров от комиссионера.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника
	 И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление
	 И Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратОтКомиссионера Тогда
		Возврат;
	 
	ИначеЕсли ЗначениеЗаполнено(Расход.Регистратор)
		И Расход.Регистратор = Приход.ДокументИсточник
		И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Сторно
		И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.СторноДопРасходов
		И Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Сторно
		И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника
		И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
		И Не Расход.Регистратор = Приход.Регистратор Тогда
		Возврат;
	
	// Расход из товаров в пути должен подбирать партию из того же документа реализации, которым делался приход.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление
		 И Приход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыВПути
		 И Расход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыВПути
		 И ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.РеализацияТоваровУслуг")
		 И ТипЗнч(Расход.Регистратор) = Тип("ДокументСсылка.РеализацияТоваровУслуг")
		 И Приход.Регистратор <> Расход.Регистратор Тогда
			Возврат;
	
	КонецЕсли;
	
	СуммовыеРесурсыСтрокой = 
	"Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
	|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
	|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
	|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
	|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл";
	СуммовыеРесурсы = Новый Структура(СуммовыеРесурсыСтрокой);
	СуммовыеРесурсыНДС = Новый Структура("НДСРегл, НДСУпр");
	
	ЭтоРеализацияТоварыВПути = ТипЗнч(Расход.Регистратор) = Тип("ДокументСсылка.РеализацияТоваровУслуг")
		И Расход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыВПути;
	ЭтоКорРеализацияТоварыВПути = ТипЗнч(Расход.Регистратор) = Тип("ДокументСсылка.РеализацияТоваровУслуг")
		И Расход.КорРазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыВПути;
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	//	Заполняем партионную идентификацию в расчетной партии
	Если НЕ ЭтоРеализацияТоварыВПути Тогда
		
		ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "Партия, АналитикаУчетаПартий, НалогообложениеПартии, АналитикаФинансовогоУчета, ПериодПоступления, ЗаказНаПроизводство");
		
		Если ЗначениеЗаполнено(РасчетнаяПартия.КорПартия)
		 И РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности
		 И ТипЗнч(РасчетнаяПартия.КорПартия) = Тип("ДокументСсылка.РеализацияТоваровУслуг")
		 И ТипЗнч(РасчетнаяПартия.Регистратор) = Тип("ДокументСсылка.РеализацияТоваровУслуг") Тогда
			РасчетнаяПартия.КорАналитикаУчетаПартий = РасчетнаяПартия.АналитикаУчетаПартий;
		КонецЕсли;
		
	ИначеЕсли ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) <> Неопределено Тогда
		РасчетнаяПартия.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
	КонецЕсли;
	
	Если (РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности
		ИЛИ РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности)
	 И РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход
	 И ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) <> Неопределено Тогда
		РасчетнаяПартия.Партия = РасчетнаяПартия.Регистратор;
		Если НЕ ЭтоРеализацияТоварыВПути Тогда
			РасчетнаяПартия.АналитикаУчетаПартий = Неопределено;
		КонецЕсли;
	//++ Устарело_Производство21
	//-- Устарело_Производство21
	ИначеЕсли РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход
	 И ЗначениеЗаполнено(РасчетнаяПартия.Партия)
	 И НЕ РасчетнаяПартия.Сторно
	 И НЕ ЭтоРеализацияТоварыВПути
	 И РасчетнаяПартия.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути
	 И РасчетнаяПартия.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
	 И ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) = Неопределено Тогда
		РасчетнаяПартия.Партия = Неопределено;
		РасчетнаяПартия.АналитикаУчетаПартий = Неопределено;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода
	 И РасчетнаяПартия.Количество = 0 Тогда
		// ДокументИсточник не меняется, нужно сохранить запись как есть
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения Тогда
		// ДокументИсточник не меняется, нужно сохранить запись как есть
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск
	 ИЛИ Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск
	 ИЛИ Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный Тогда
		РасчетнаяПартия.ДокументИсточник = Приход.ДокументИсточник;
	Иначе
		РасчетнаяПартия.ДокументИсточник = Приход.Регистратор;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск Тогда
		РасчетнаяПартия.ЭтоСторно = Ложь;
		РасчетнаяПартия.АналитикаУчетаПоПартнерам = Приход.АналитикаУчетаПоПартнерам;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		РасчетнаяПартия.ВидДвижения = Приход.ВидДвижения;
		РасчетнаяПартия.АналитикаУчетаПоПартнерам = Приход.АналитикаУчетаПоПартнерам;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Перемещение
		И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно
		И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПеремещениеУпр
		И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПеремещениеАвто
		И НЕ ЭтоРеализацияТоварыВПути Тогда
		Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов
		 И НЕ (РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Сторно
		 	И РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторноРеализации)
		 ИЛИ Не ЗначениеЗаполнено(РасчетнаяПартия.ВидДеятельностиНДС) Тогда
			РасчетнаяПартия.ВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
		КонецЕсли;
		Если (РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Сторно
		 И РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторноРеализации)
		 И РасчетнаяПартия.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию Тогда
			РасчетнаяПартия.ВидДеятельностиНДСОтгрузки = Приход.ВидДеятельностиНДС;
		КонецЕсли;
	ИначеЕсли НЕ ЭтоРеализацияТоварыВПути Тогда
		Если ЗначениеЗаполнено(Приход.КорАналитикаФинансовогоУчета) Тогда
			РасчетнаяПартия.АналитикаФинансовогоУчета = Приход.КорАналитикаФинансовогоУчета;
		Иначе
			РасчетнаяПартия.АналитикаФинансовогоУчета = Расход.АналитикаФинансовогоУчета;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.АналитикаФинансовогоУчета)
			И РасчетнаяПартия.АналитикаФинансовогоУчета <> Неопределено Тогда
			РасчетнаяПартия.АналитикаФинансовогоУчета = Неопределено;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.КорАналитикаФинансовогоУчета)
			И РасчетнаяПартия.КорАналитикаФинансовогоУчета <> Неопределено Тогда
			РасчетнаяПартия.КорАналитикаФинансовогоУчета = Неопределено;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Приход.КорВидДеятельностиНДС) Тогда
			РасчетнаяПартия.ВидДеятельностиНДС = Приход.КорВидДеятельностиНДС;
		Иначе
			РасчетнаяПартия.ВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
		КонецЕсли;
	КонецЕсли;
	
	Если РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход
	 И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Импорт
	 И Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И НЕ ЭтоРеализацияТоварыВПути
	 И НЕ (Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Прошлое
	 	 И Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов) Тогда
		
		РасчетнаяПартия.КорВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
		РасчетнаяПартия.КорАналитикаУчетаНоменклатуры = Приход.АналитикаУчетаНоменклатуры;
		РасчетнаяПартия.КорПартия = Приход.Партия;
		Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения Тогда
			РасчетнаяПартия.КорАналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Приход.КорОрганизация) Тогда
			РасчетнаяПартия.КорОрганизация = Приход.Организация;
		КонецЕсли;
		
	КонецЕсли;
	
	Если РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход
	 И НЕ ЭтоРеализацияТоварыВПути
	 И Не ЗначениеЗаполнено(РасчетнаяПартия.ВидДеятельностиНДСДокумента) Тогда
		РасчетнаяПартия.КорВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
	КонецЕсли;
	
	
	//++ Устарело_Производство21
	//-- Устарело_Производство21
	
	Если (ЗначениеЗаполнено(РасчетнаяПартия.КорРазделУчета)
		  ИЛИ РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет)
	 И НЕ ЭтоРеализацияТоварыВПути
	 И РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход
	 // Дополнительное условие на тип партии.
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Выпуск
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.СписаниеНаДругиеПартии
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.СторноСписанияНаДругиеПартии
	 И ТипЗнч(РасчетнаяПартия.Регистратор) <> Тип("ДокументСсылка.РасчетСебестоимостиТоваров")
	 И РасчетнаяПартия.КорПартия <> РасчетнаяПартия.Регистратор Тогда
	 
		// Сработает для расходных движений документа, удовлетворяющего следующим условиям:
		// - документ формирует движения и по приходу и по расходу
		// - его приходное движение не образует новую партию
		// Пример такого документа - перемещение товаров между складами.
		Если (ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) = Неопределено
				И РасчетнаяПартия.КорРазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
				И НЕ ЗначениеЗаполнено(РасчетнаяПартия.КорОрганизация)
		 ИЛИ (ЗначениеЗаполнено(РасчетнаяПартия.КорОрганизация)
			  И ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.КорОрганизация) = Неопределено) Тогда
			РасчетнаяПартия.КорПартия 				= Неопределено;
			РасчетнаяПартия.КорАналитикаУчетаПартий = Неопределено;
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		Иначе
			РасчетнаяПартия.КорПартия 				= Приход.Партия;
			РасчетнаяПартия.КорАналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.КорВидЗапасов) Тогда
			РасчетнаяПартия.КорВидЗапасов = Приход.ВидЗапасов;
		КонецЕсли;
		
	КонецЕсли;
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ (Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией
	 И Расход.Количество <> 0) Тогда
	 	Если Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноДопРасходов Тогда
	 		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
			ПриходБазис = ?(Приход.Количество <> 0, КоличествоСписания / Приход.Знаменатель, 0);
	 	Иначе
			КоличествоСписания = Мин(Расход.Знаменатель, Приход.Количество);
			ПриходБазис = ?(Приход.Количество <> 0, КоличествоСписания / Приход.Количество, 0);
		КонецЕсли;
		РасходБазис = ?(Расход.Знаменатель <> 0, КоличествоСписания / Расход.Знаменатель, 0);
		
	// У корректировки приобретения прошлого периода нет количества, поэтому используем первый источник полностью.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
		КоличествоСписания = Приход.Количество;
		ПриходБазис = 1;
		РасходБазис = 1;
	ИначеЕсли Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
	 И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		КоличествоСписания = Мин(Приход.Знаменатель, Расход.Количество);
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	ИначеЕсли ЭтоРеализацияТоварыВПути И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Перемещение Тогда
		КоличествоСписания = Мин(Расход.Количество, Приход.Знаменатель);
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	Иначе
		КоличествоСписания = Мин(Расход.Количество, Приход.Количество);
		ПриходБазис = ?(Приход.Количество <> 0, КоличествоСписания / Приход.Количество, 0);
		РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	КонецЕсли;
	
	Если КоличествоСписания = 0 Тогда
		Возврат;
	КонецЕсли;
	
	// Заполняем показатели расчетной партии
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода Тогда
		РасчетнаяПартия.Количество = 0;
	ИначеЕсли Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
	 И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		РасчетнаяПартия.Количество = Окр(ПриходБазис * Приход.Количество, 3);
	Иначе
		РасчетнаяПартия.Количество = Окр(КоличествоСписания, 3);
	КонецЕсли;
	Если ЭтоКорРеализацияТоварыВПути Тогда
		РасчетнаяПартия.Знаменатель = РасчетнаяПартия.Количество; 
	КонецЕсли;
	
	ЕстьСтоимостьРасчетнойПартии = Ложь;
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(РасходБазис * РасчетнаяПартия[ИмяРесурса.Ключ], 2);
		Если РасчетнаяПартия[ИмяРесурса.Ключ] <> 0 Тогда
			ЕстьСтоимостьРасчетнойПартии = Истина;
		КонецЕсли;
	КонецЦикла;
	Для Каждого ИмяРесурса Из СуммовыеРесурсыНДС Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(РасходБазис * РасчетнаяПартия[ИмяРесурса.Ключ], 2);
	КонецЦикла;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника
	 И РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ОтчетКомиссионера Тогда
		РасчетнаяПартия.ПериодПродажи = Приход.Период;
	КонецЕсли;
	
	// Корректируем базу расчета в расходе
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Выпуск Тогда
	
		Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией
		 И Расход.Количество <> 0 Тогда
			Расход.Количество = Расход.Количество - КоличествоСписания;
		Иначе
			Расход.Количество = Расход.Количество - РасчетнаяПартия.Количество;
		КонецЕсли;
		Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
			ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
			Расход.Знаменатель = Расход.Знаменатель - КоличествоСписания;
		КонецЕсли;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
		Для Каждого ИмяРесурса Из СуммовыеРесурсыНДС Цикл
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
		
	КонецЕсли;
	
	// Корректируем базу расчета в приходе
	Если НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет
			И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление)
	И НЕ (Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ИсправлениеПрошлогоПериода
			И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
			И Приход.Регистратор = Расход.Регистратор)
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию
			И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление)
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторноРеализацииВозвратНаДругойСклад
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад
		И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад) 
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства
	  И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение) Тогда
		
		Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
		 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
		 	Если Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноДопРасходов Тогда
		 		Приход.Знаменатель = Приход.Знаменатель - КоличествоСписания;
		 	Иначе
				Приход.Количество = Приход.Количество - КоличествоСписания;
		 	КонецЕсли;
		ИначеЕсли ЭтоРеализацияТоварыВПути И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Перемещение Тогда
			Приход.Знаменатель = Приход.Знаменатель - КоличествоСписания;
		ИначеЕсли НЕ Приход.ЭтоСторно И РасчетнаяПартия.ЭтоСторно
		 И РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда	
			Приход.Количество = Приход.Количество + РасчетнаяПартия.Количество;
		ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
		 И РасчетнаяПартия.Количество < 0 Тогда
			Приход.Количество = Приход.Количество + РасчетнаяПартия.Количество;
			
		// При корректировке неотфактурованной поставки нужно скорректировать количественные и стоимостные показатели в источнике.
		ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
		 И Расход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки
		 И НЕ Расход.Сторно Тогда
			Приход.Количество = Приход.Количество + РасчетнаяПартия.Количество;
			Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
				Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] + РасчетнаяПартия[ИмяРесурса.Ключ];
			КонецЦикла;
			Для Каждого ИмяРесурса Из СуммовыеРесурсыНДС Цикл
				Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] + РасчетнаяПартия[ИмяРесурса.Ключ];
			КонецЦикла;
		Иначе
			Приход.Количество = Приход.Количество - РасчетнаяПартия.Количество;
		КонецЕсли;
		
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.РазделУчета) Тогда
		РасчетнаяПартия.РазделУчета = Приход.РазделУчета;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.ВидЗапасов) И ЗначениеЗаполнено(Приход.ВидЗапасов)
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство Тогда
		РасчетнаяПартия.ВидЗапасов = Приход.ВидЗапасов;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		
		РасчетнаяПартия.АналитикаУчетаНоменклатуры = Приход.АналитикаУчетаНоменклатуры;
		РасчетнаяПартия.Партия = Приход.Партия;
		РасчетнаяПартия.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
		РасчетнаяПартия.Подразделение = Приход.Подразделение;
		РасчетнаяПартия.СтатьяКалькуляции = Приход.СтатьяКалькуляции;
		РасчетнаяПартия.ИдентификаторСтроки = Приход.ИдентификаторСтроки;
		РасчетнаяПартия.КодСтроки = Приход.КодСтроки;
		
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		Если РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство
			ИЛИ РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты Тогда
			Если Приход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку Тогда
				РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку;
			ИначеЕсли Приход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение Тогда
				РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение;
			КонецЕсли;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.КорАналитикаУчетаНоменклатуры)
			И (РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку
				ИЛИ РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение) Тогда
			РасчетнаяПартия.КорРазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка();
		ИначеЕсли ЗначениеЗаполнено(РасчетнаяПартия.КорАналитикаУчетаНоменклатуры)
			И РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход
			И Не РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратИзПроизводства
			И (РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку
				ИЛИ РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение) Тогда
			РасчетнаяПартия.КорРазделУчета = РасчетнаяПартия.РазделУчета;
		КонецЕсли;
	КонецЕсли;
	
	// Для товаров, переданных переработчику, заполняем приоритетный источник.
	Если РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику
	 И ЗначениеЗаполнено(Приход.ЗаказНаПроизводство) Тогда
	 	РасчетнаяПартия.ПриоритетныйИсточник = Приход.ЗаказНаПроизводство; 
	КонецЕсли;
	
	// Заменим старые аналитики учета партий на новые.
	Если ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.Свойство("АналитикиУчетаПартий") Тогда
		
		АналитикиУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий; // Соответствие
		
		НоваяАналитикаУчетаПартий = АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
		НоваяАналитикаУчетаПартий = АналитикиУчетаПартий.Получить(РасчетнаяПартия.КорАналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.КорАналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
	КонецЕсли;
	
	// Сторно списания на выпуск только уменьшает количество списания на выпуск,
	// но в дальнейших цепочках результат не должен использоваться.  
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
	 И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск Тогда
		РасчетнаяПартия.РасчетЗавершен = Ложь;
	Иначе
		// По результатам партионной идентификации определяем завершенность расчета
		РасчетнаяПартия.РасчетЗавершен = Приход.РасчетЗавершен;
	КонецЕсли;
	
	// Включение или исключение НДС в стоимости товаров для движений таможенной декларации на импорт.
	Если (РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией)
	 И РасчетнаяПартия.ВидДеятельностиНДС <> РасчетнаяПартия.КорВидДеятельностиНДС Тогда
	 
		ВключениеИсключениеНДС = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета);
		ЗаполнитьЗначенияСвойств(ВключениеИсключениеНДС, РасчетнаяПартия,, СуммовыеРесурсыСтрокой);
		ВключениеИсключениеНДС.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости;
		
		Если ПараметрыРасчета.ТипыНалогообложенияНДСУчитываетсяВСтоимости[РасчетнаяПартия.ВидДеятельностиНДС] <> Неопределено
		 И ПараметрыРасчета.ТипыНалогообложенияНДСНеУчитываетсяВСтоимости[РасчетнаяПартия.КорВидДеятельностиНДС] <> Неопределено Тогда
			ВключениеИсключениеНДС.ДопРасходыРегл = РасчетнаяПартия.НДСРегл;
			ВключениеИсключениеНДС.ДопРасходыУпр = ?(ПараметрыРасчета.УправленческийУчетОрганизаций, РасчетнаяПартия.НДСУпр, 0);
			
		ИначеЕсли ПараметрыРасчета.ТипыНалогообложенияНДСНеУчитываетсяВСтоимости[РасчетнаяПартия.ВидДеятельностиНДС] <> Неопределено
		 И ПараметрыРасчета.ТипыНалогообложенияНДСУчитываетсяВСтоимости[РасчетнаяПартия.КорВидДеятельностиНДС] <> Неопределено Тогда
			ВключениеИсключениеНДС.ДопРасходыРегл = -РасчетнаяПартия.НДСРегл;
			ВключениеИсключениеНДС.ДопРасходыУпр = ?(ПараметрыРасчета.УправленческийУчетОрганизаций, -РасчетнаяПартия.НДСУпр, 0);
		 
		КонецЕсли;
	 
	КонецЕсли;
	
	// Отклонения в стоимости товаров
	Если Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
	 ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
		И Приход.Количество = 0 // корректировкой приобретения списано все количество
		И (ЕстьСтоимостьРасчетнойПартии
		// При неотфактурованной поставке стоимость может быть нулевой. 
		ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка) Тогда
	 
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			СуммовыеРесурсы[ИмяРесурса.Ключ] = Окр(ПриходБазис * Приход[ИмяРесурса.Ключ], 2);
			Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - СуммовыеРесурсы[ИмяРесурса.Ключ];
		КонецЦикла;
		
		ЕстьОтклонения = Ложь;

		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Если (РасчетнаяПартия[ИмяРесурса.Ключ] <> 0
			 ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка)
			 И (СуммовыеРесурсы[ИмяРесурса.Ключ] <> 0
				ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
				ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки)
			 И РасчетнаяПартия[ИмяРесурса.Ключ] - СуммовыеРесурсы[ИмяРесурса.Ключ] <> 0 Тогда
			 	ЕстьОтклонения = Истина;
			 	Прервать;
			КонецЕсли;
		КонецЦикла;
		
		// Заполним кор реквизиты. Они будут нужны для отнесения доп расходов.
		ОтноситьОтклоненияНаПрочиеДоходыРасходы = Ложь; 
		Если Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
		 И Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка
		 ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки
		 И Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка Тогда
			ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорПартия, КорАналитикаУчетаПартий");
			Если НЕ ПараметрыРасчета.ФО.РаспределениеДопРасходовПоВыбывшимТоварам 
			 И Приход.ПериодПоступления < ПараметрыРасчета.РасчетныйПериод.НачалоПериода Тогда
				ОтноситьОтклоненияНаПрочиеДоходыРасходы = Истина;
			КонецЕсли;
	 	КонецЕсли;
		
		// Отклонения между фактической и договорной стоимостью.
		Если ЕстьОтклонения Тогда
			Отклонения = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета, РасчетнаяПартия, Ложь);
			
			ОтклоненияИтог = 0;
			Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
				// Всю сумму доп расходов по неотфактурованнм поставкам относим на отклонение в стоимости. 
				Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
					Отклонения[ИмяРесурса.Ключ] = РасчетнаяПартия[ИмяРесурса.Ключ];
				Иначе
					Если (РасчетнаяПартия[ИмяРесурса.Ключ] <> 0
						ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения)
					 И СуммовыеРесурсы[ИмяРесурса.Ключ] <> 0 Тогда
						Отклонения[ИмяРесурса.Ключ] = РасчетнаяПартия[ИмяРесурса.Ключ] - СуммовыеРесурсы[ИмяРесурса.Ключ];
						ОтклоненияИтог = ОтклоненияИтог  + Отклонения[ИмяРесурса.Ключ]; 
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
			 И Расход.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки Тогда
				Отклонения.ВидДвижения = ВидДвиженияНакопления.Приход;
			Иначе
				Отклонения.ВидДвижения = ВидДвиженияНакопления.Расход;
			КонецЕсли;
			Отклонения.Количество  = 0;
			Если НЕ ОтноситьОтклоненияНаПрочиеДоходыРасходы 
			 И (ЗначениеЗаполнено(Приход.КорРазделУчета)
			 ИЛИ (Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка
			 И (Отклонения.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах
			 	ИЛИ Отклонения.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))) Тогда
				Отклонения.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости;
			ИначеЕсли ОтклоненияИтог < 0 Тогда
				Отклонения.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимостиНаПрочиеДоходы;
				Отклонения.СтатьяДоходов = ПланыВидовХарактеристик.СтатьиДоходов.ОтклонениеВСтоимостиТоваров;
				Отклонения.АналитикаДоходов = Расход.Номенклатура;
			Иначе
				Отклонения.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимостиНаПрочиеРасходы;
				Отклонения.СтатьяРасходовСписания = ПланыВидовХарактеристик.СтатьиРасходов.ОтклонениеВСтоимостиТоваров;
				Отклонения.АналитикаРасходов = Расход.Номенклатура;
			КонецЕсли;
			Отклонения.Сторно      = Ложь;
			Отклонения.ИдентификаторФинЗаписи = Отклонения.ИдентификаторСтроки;
			
			// Отклонения отражаем как доп. расходы.
			Если ЗначениеЗаполнено(Приход.КорРазделУчета) И НЕ ОтноситьОтклоненияНаПрочиеДоходыРасходы Тогда
				
				ОтклоненияНаСклад = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета,, Ложь);
				ЗаполнитьЗначенияСвойств(ОтклоненияНаСклад, Отклонения,
					"Период, Регистратор, ВидЗапасов, Организация, АналитикаФинансовогоУчета, ВидДеятельностиНДС, ХозяйственнаяОперация, ДокументИсточник,
					|ИдентификаторФинЗаписи, НастройкаХозяйственнойОперации,
					|НДСРегл, НДСУпр, РасчетЗавершен");
				
				ОтклоненияНаСклад.АналитикаУчетаНоменклатуры = Приход.КорАналитикаУчетаНоменклатуры;
				ОтклоненияНаСклад.РазделУчета 				 = Приход.КорРазделУчета;
				ОтклоненияНаСклад.ВидЗапасов 				 = Приход.КорВидЗапасов;
				ОтклоненияНаСклад.Партия 					 = Приход.КорПартия;
				ОтклоненияНаСклад.АналитикаУчетаПартий  	 = Приход.КорАналитикаУчетаПартий;
				ОтклоненияНаСклад.КорАналитикаУчетаПартий  	 = Приход.АналитикаУчетаПартий;
				ОтклоненияНаСклад.ТипЗаписи 				 = Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости;
				ОтклоненияНаСклад.ДопРасходы 				 = Отклонения.Стоимость + Отклонения.ДопРасходы;
				ОтклоненияНаСклад.ДопРасходыБезНДС 			 = Отклонения.СтоимостьБезНДС + Отклонения.ДопРасходыБезНДС;
				ОтклоненияНаСклад.ДопРасходыУпр 			 = Отклонения.СтоимостьУпр + Отклонения.ДопРасходыУпр;
				ОтклоненияНаСклад.ДопРасходыРегл 			 = Отклонения.СтоимостьРегл + Отклонения.ДопРасходыРегл;
				ОтклоненияНаСклад.АналитикаРасходов 		 = Приход.Партия;
				
			КонецЕсли;
			
		КонецЕсли;
		
	ИначеЕсли РасчетнаяПартия.РасчетЗавершен Тогда
		// При предварительном закрытии месяца признак выполнения расчета партий устанавливается только при наличии
		// заполненной партии.
		Если ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) <> Неопределено
		 И ПараметрыРасчета.РежимЗакрытияМесяца = Перечисления.РежимыЗакрытияМесяца.ПредварительноеЗакрытие
		 И НЕ ЗначениеЗаполнено(РасчетнаяПартия.Партия) Тогда
			РасчетнаяПартия.ВыполненРасчетПартий = Ложь;
		Иначе
			РасчетнаяПартия.ВыполненРасчетПартий = Истина;
		КонецЕсли;
		РасчетнаяПартия.РежимЗакрытияМесяца = ПараметрыРасчета.РежимЗакрытияМесяца;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ПроцедурыЭтапа_ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж

// Инициализация данных

Функция ПоляПотребленийПартииВыручки(ПараметрыРасчета)
	
	Возврат "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета, АналитикаУчетаПоПартнерам, ЗаказКлиента";
	
КонецФункции

Функция ОписаниеЦепочекПартийВыручки(ПараметрыРасчета)
	
	ОписаниеЦепочек = Новый Соответствие;
	ПоляПотреблений	= ПоляПотребленийПартииВыручки(ПараметрыРасчета);
	
	// Потребление <- (Партия)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Партия,		ПоляПотреблений);
		
	// ПотреблениеАвто <- (Партия)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Партия,		ПоляПотреблений);	
	
	// Дополнение <- (<без источников - для формирования записей по данным запроса>)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Дополнение);
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийВыручки(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийВыручки(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
	ОписаниеДвижений.Вставить("Контекст", "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж");
	ОписаниеДвижений.Вставить("ИмяРегистра", Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя);
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииВыручки(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Количество, Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
		|СуммаВыручки, СуммаВыручкиБезНДС, СуммаВыручкиРегл, СуммаВыручкиСНДСРегл, СуммаРучнойСкидки, СуммаАвтоматическойСкидки,
		|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
		|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
		|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
		|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
		|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл,
		|ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
		|СуммаВВалютеВзаиморасчетов, СуммаБезНДСВВалютеВзаиморасчетов, СуммаВВалютеДокумента, СуммаБезНДСВВалютеДокумента");
	ОписаниеДвижений.Вставить("БазисПрихода", "Количество");
	ОписаниеДвижений.Вставить("БазисРасхода", "Количество");
	ОписаниеДвижений.Вставить("ПолеПорядка", "Период");
	ОписаниеДвижений.Вставить("ПоляСортировки", "ИдентификаторФинЗаписи");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);
	ОписаниеДвижений.Вставить("ЕстьСторно", Истина);
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийВыручки(ПараметрыРасчета)
	
	НезаписываемыеТипыЗаписей = Новый Соответствие;
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Партия, Истина);
	
	НезаписываемыеРазделы = Новый Соответствие;
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Истина, НезаписываемыеТипыЗаписей, НезаписываемыеРазделы);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийВыручки(ПараметрыРасчета)
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,
		ТекстОписаниеДанныхПартийВыручки());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийВыручки(ПараметрыРасчета)
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"АналитикаУчетаНоменклатуры", // разделитель
		ПараметрыРасчета.РаспределениеПартий.ОписаниеДвижений.Показатели, // ресурсы
		ПоляПотребленийПартииВыручки(ПараметрыРасчета)); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийВыручки(ПараметрыРасчета),
		ПараметрыНумерации);
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийВыручки(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийВыручки()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхПартийВыручки() // вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПартииДляВыручки()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПартииДляВыручкиБезКоличества()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВыручкаБезПартий()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВыручкаБезПартийБезКоличества()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВыручкаСохраняемыеДвижения()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхПартийВыручки()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 						  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка) КАК ТипЗаписи,
		|	ЛОЖЬ 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ЛОЖЬ 												  КАК ЭтоСторно,
		|
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)		  КАК Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.РасходыНаПродажуСНДС,
		|   Т.РасходыНаПродажуБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.РасходыНаПродажуРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.РасходыНаПродажуУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ПОМЕСТИТЬ Данные
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|";

	ТекстЗапроса = РасчетСебестоимостиПрикладныеАлгоритмы.ПодготовитьЗапросОписанияДанных(ТекстЗапроса);
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийВыручки()
	Возврат "
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.Регистратор,
		|	АналитикаПартнеров.Организация КАК Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения,
		|   Т.НастройкаХозяйственнойОперации,
		|   Т.ИдентификаторФинЗаписи,
		|	Т.Сторно,
		|
		|	СУММА(Т.Количество) КАК Количество,
		|	СУММА(Т.СуммаВыручки) КАК СуммаВыручки,
		|	СУММА(Т.СуммаВыручкиБезНДС) КАК СуммаВыручкиБезНДС,
		|	СУММА(Т.Стоимость) КАК Стоимость,
		|	СУММА(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(Т.ДопРасходы) КАК ДопРасходы,
		|	СУММА(Т.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(Т.РасходыНаПродажуСНДС) КАК РасходыНаПродажуСНДС,
		|	СУММА(Т.РасходыНаПродажуБезНДС) КАК РасходыНаПродажуБезНДС,
		|	СУММА(Т.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(Т.СуммаВыручкиРегл) КАК СуммаВыручкиРегл,
		|	СУММА(Т.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(Т.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(Т.СуммаВыручкиСНДСРегл) КАК СуммаВыручкиСНДСРегл,
		|	СУММА(Т.СуммаРучнойСкидки) КАК СуммаРучнойСкидки,
		|	СУММА(Т.СуммаАвтоматическойСкидки) КАК СуммаАвтоматическойСкидки,
		|	СУММА(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(Т.Трудозатраты) КАК Трудозатраты,
		|	СУММА(Т.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(Т.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(Т.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(Т.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(Т.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(Т.РасходыНаПродажуРегл) КАК РасходыНаПродажуРегл,		
		|	СУММА(Т.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(Т.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(Т.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(Т.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(Т.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(Т.РасходыНаПродажуУпр) КАК РасходыНаПродажуУпр,		
		|	СУММА(Т.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(Т.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(Т.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|
		|   СУММА(Т.СуммаВВалютеВзаиморасчетов) КАК СуммаВВалютеВзаиморасчетов,
		|   СУММА(Т.СуммаБезНДСВВалютеВзаиморасчетов) КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|   СУММА(Т.СуммаВВалютеДокумента) КАК СуммаВВалютеДокумента,
		|   СУММА(Т.СуммаБезНДСВВалютеДокумента) КАК СуммаБезНДСВВалютеДокумента
		|ПОМЕСТИТЬ ВТВыручкаБезПартий
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
		|			ПО Т.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|				ПО АналитикаНоменклатуры.Номенклатура = СпрНоменклатура.Ссылка
		|			ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И НЕ (Т.Регистратор ССЫЛКА Документ.ВводОстатков 
		|		ИЛИ Т.Регистратор ССЫЛКА Документ.ВводОстатковОПродажахЗаПрошлыеПериоды)
		|	И СпрНоменклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Т.Активность
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.Регистратор,
		|	АналитикаПартнеров.Организация,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.Подразделение,
		|	Т.ТипЗапасов,
		|	Т.ВидЗапасов,
		|	Т.РазделУчета,
		|	Т.Менеджер,
		|	Т.Склад,
		|	Т.Соглашение,
		|	Т.Договор,
		|	Т.ХозяйственнаяОперация,
		|	Т.АналитикаУчетаНаборов,
		|	Т.НаправлениеДеятельностиКонтрагента,
		|	Т.НаправлениеДеятельностиНоменклатуры,
		|	Т.НалогообложениеНДС,
		|	Т.ВалютаВзаиморасчетов,
		|	Т.ВалютаДокумента,
		|	Т.ИсточникГФУНоменклатуры,
		|	Т.ИсточникГФУРасчетов,
		|	Т.ДокументДвижения,
		|   Т.НастройкаХозяйственнойОперации,
		|   Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор,
		|   Т.ЗаказКлиента
		|ПОМЕСТИТЬ ВТКорректировкиСумм
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|ГДЕ
		|	Т.Количество = 0
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|   Т.Регистратор КАК Регистратор,
		|	Т.ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Отбор.Регистратор КАК Корректировка
		|ПОМЕСТИТЬ ВТДокументыРеализации
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКорректировкиСумм КАК Отбор
		|			ПО Т.ЗаказКлиента = Отбор.ЗаказКлиента
		|ГДЕ
		|	Т.Период <= &КонецПериода
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Т.Активность
		|	И Т.Количество <> 0
		|	И (Отбор.ЗаказКлиента <> НЕОПРЕДЕЛЕНО ИЛИ Т.Регистратор = Отбор.Регистратор)
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.Регистратор КАК Регистратор,
		|	Регистраторы.Корректировка,
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|	ВЫБОР КОГДА Т.ЗаказКлиента = НЕОПРЕДЕЛЕНО
		|		ТОГДА Регистраторы.ЗаказКлиента
		|		ИНАЧЕ Т.ЗаказКлиента
		|	КОНЕЦ КАК ЗаказКлиента,
		|	ВЫБОР КОГДА Т.АналитикаУчетаПоПартнерам = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка)
		|		ТОГДА Регистраторы.АналитикаУчетаПоПартнерам
		|		ИНАЧЕ Т.АналитикаУчетаПоПартнерам
		|	КОНЕЦ КАК АналитикаУчетаПоПартнерам,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.ХозяйственнаяОперация,
		|   Т.Количество
		|ПОМЕСТИТЬ ВТПартииДляКорректировокСумм
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРеализации КАК Регистраторы
		|		ПО Т.Регистратор = Регистраторы.Регистратор
		|ГДЕ
		|	Т.Количество <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.Регистратор КАК Регистратор,
		|	Регистраторы.Корректировка,
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|	ВЫБОР КОГДА Т.ЗаказКлиента = НЕОПРЕДЕЛЕНО
		|		ТОГДА Регистраторы.ЗаказКлиента
		|		ИНАЧЕ Т.ЗаказКлиента
		|	КОНЕЦ КАК ЗаказКлиента,
		|	ВЫБОР КОГДА Т.АналитикаУчетаПоПартнерам = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка)
		|		ТОГДА Регистраторы.АналитикаУчетаПоПартнерам
		|		ИНАЧЕ Т.АналитикаУчетаПоПартнерам
		|	КОНЕЦ КАК АналитикаУчетаПоПартнерам,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.ХозяйственнаяОперация,
		|   Т.Количество
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРеализации КАК Регистраторы
		|		ПО Т.Регистратор = Регистраторы.Регистратор
		|ГДЕ
		|	Т.Период < &НачалоПериода
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Т.Активность
		|	И Т.Количество <> 0
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	АналитикаУчетаНоменклатуры
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК Период,
		|	Т.Регистратор КАК Регистратор,
		|	Т.Организация КАК Организация,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.ЗаказКлиента КАК ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
		|	Т.Подразделение КАК Подразделение,
		|	Т.ТипЗапасов КАК ТипЗапасов,
		|	Т.ВидЗапасов КАК ВидЗапасов,
		|	Т.РазделУчета КАК РазделУчета,
		|	Т.Менеджер КАК Менеджер,
		|	Т.Склад КАК Склад,
		|	Т.Соглашение КАК Соглашение,
		|	Т.Договор КАК Договор,
		|	Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	Т.АналитикаУчетаНаборов КАК АналитикаУчетаНаборов,
		|	Т.НаправлениеДеятельностиКонтрагента КАК НаправлениеДеятельностиКонтрагента,
		|	Т.НаправлениеДеятельностиНоменклатуры КАК НаправлениеДеятельностиНоменклатуры,
		|	СУММА(Реализации.Количество) КАК Количество,
		|	СУММА(ВЫБОР КОГДА Реализации.Количество > 0 ТОГДА Реализации.Количество ИНАЧЕ 0 КОНЕЦ) КАК КоличествоПоложительное,
		|	МИНИМУМ(Т.СуммаВыручки) КАК СуммаВыручки,
		|	МИНИМУМ(Т.СуммаВыручкиБезНДС) КАК СуммаВыручкиБезНДС,
		|	МИНИМУМ(Т.Стоимость) КАК Стоимость,
		|	МИНИМУМ(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	МИНИМУМ(Т.ДопРасходы) КАК ДопРасходы,
		|	МИНИМУМ(Т.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	МИНИМУМ(Т.РасходыНаПродажуСНДС) КАК РасходыНаПродажуСНДС,
		|	МИНИМУМ(Т.РасходыНаПродажуБезНДС) КАК РасходыНаПродажуБезНДС,
		|	МИНИМУМ(Т.СтоимостьРегл) КАК СтоимостьРегл,
		|	МИНИМУМ(Т.СуммаВыручкиРегл) КАК СуммаВыручкиРегл,
		|	МИНИМУМ(Т.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	МИНИМУМ(Т.ВременнаяРазница) КАК ВременнаяРазница,
		|	МИНИМУМ(Т.СуммаВыручкиСНДСРегл) КАК СуммаВыручкиСНДСРегл,
		|	МИНИМУМ(Т.СуммаРучнойСкидки) КАК СуммаРучнойСкидки,
		|	МИНИМУМ(Т.СуммаАвтоматическойСкидки) КАК СуммаАвтоматическойСкидки,
		|	МИНИМУМ(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	МИНИМУМ(Т.Трудозатраты) КАК Трудозатраты,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	МИНИМУМ(Т.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	МИНИМУМ(Т.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	МИНИМУМ(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	МИНИМУМ(Т.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	МИНИМУМ(Т.РасходыНаПродажуРегл) КАК РасходыНаПродажуРегл,
		|	МИНИМУМ(Т.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	МИНИМУМ(Т.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	МИНИМУМ(Т.СтоимостьУпр) КАК СтоимостьУпр,
		|	МИНИМУМ(Т.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	МИНИМУМ(Т.РасходыНаПродажуУпр) КАК РасходыНаПродажуУпр,
		|	МИНИМУМ(Т.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	МИНИМУМ(Т.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	Т.НалогообложениеНДС КАК НалогообложениеНДС,
		|	Т.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
		|	МИНИМУМ(Т.СуммаВВалютеВзаиморасчетов) КАК СуммаВВалютеВзаиморасчетов,
		|	МИНИМУМ(Т.СуммаБезНДСВВалютеВзаиморасчетов) КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|	Т.ВалютаДокумента КАК ВалютаДокумента,
		|	МИНИМУМ(Т.СуммаВВалютеДокумента) КАК СуммаВВалютеДокумента,
		|	МИНИМУМ(Т.СуммаБезНДСВВалютеДокумента) КАК СуммаБезНДСВВалютеДокумента,
		|	Т.ИсточникГФУНоменклатуры КАК ИсточникГФУНоменклатуры,
		|	Т.ИсточникГФУРасчетов КАК ИсточникГФУРасчетов,
		|	Т.ДокументДвижения КАК ДокументДвижения,
		|   Т.НастройкаХозяйственнойОперации,
		|   Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ПОМЕСТИТЬ ВТВыручкаБезПартийБезКоличества
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКорректировкиСумм КАК Корректировки
		|		ПО Т.Регистратор = Корректировки.Регистратор
		|			И Т.ЗаказКлиента = Корректировки.ЗаказКлиента
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПартииДляКорректировокСумм КАК Реализации
		|		ПО Т.АналитикаУчетаНоменклатуры = Реализации.АналитикаУчетаНоменклатуры
		|			И Т.ВидЗапасов = Реализации.ВидЗапасов
		|			И Т.Организация = Реализации.Организация
		|			И Т.РазделУчета = Реализации.РазделУчета
		|			И (Т.АналитикаУчетаПоПартнерам = Реализации.АналитикаУчетаПоПартнерам
		|				ИЛИ Реализации.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
		|				И Реализации.АналитикаУчетаПоПартнерам = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка))
		|			И (Т.ЗаказКлиента = Реализации.ЗаказКлиента
		|				ИЛИ Реализации.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
		|				И Реализации.ЗаказКлиента = НЕОПРЕДЕЛЕНО)
		|			И Т.Регистратор = Реализации.Корректировка
		|ГДЕ
		|	Т.Количество = 0
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.Регистратор,
		|	Т.Организация,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.Подразделение,
		|	Т.ТипЗапасов,
		|	Т.ВидЗапасов,
		|	Т.РазделУчета,
		|	Т.Менеджер,
		|	Т.Склад,
		|	Т.Соглашение,
		|	Т.Договор,
		|	Т.ХозяйственнаяОперация,
		|	Т.АналитикаУчетаНаборов,
		|	Т.НаправлениеДеятельностиКонтрагента,
		|	Т.НаправлениеДеятельностиНоменклатуры,
		|	Т.НалогообложениеНДС,
		|	Т.ВалютаВзаиморасчетов,
		|	Т.ВалютаДокумента,
		|	Т.ИсточникГФУНоменклатуры,
		|	Т.ИсточникГФУРасчетов,
		|	Т.ДокументДвижения,
		|	Т.НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор
		|ПОМЕСТИТЬ ВТРегистраторыВыручки
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор,
		|	Т.АналитикаУчетаНоменклатуры
		|ПОМЕСТИТЬ ВТОтборКорректировкаСумм
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор,
		|	Т.АналитикаУчетаНоменклатуры
		|ИЗ
		|	ВТВыручкаБезПартийБезКоличества КАК Т
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	АналитикаУчетаНоменклатуры
		|";
	
КонецФункции

// ... выборки данных

Функция ТекстПартииДляВыручки()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстПартииДляВыручки"" 						  	  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)  	  КАК ТипЗаписи,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ВЫБОР КОГДА Т.Количество < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК ЭтоСторно,
		|
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   НЕОПРЕДЕЛЕНО КАК Подразделение,
		|   НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   НЕОПРЕДЕЛЕНО КАК Менеджер,
		|   НЕОПРЕДЕЛЕНО КАК Склад,
		|   НЕОПРЕДЕЛЕНО КАК Соглашение,
		|   НЕОПРЕДЕЛЕНО КАК Договор,
		|   НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНаборов,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКонтрагента,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   0 КАК СуммаВыручки,
		|   0 КАК СуммаВыручкиБезНДС,
		|   0 КАК Стоимость,
		|   0 КАК СтоимостьБезНДС,
		|   0 КАК ДопРасходы,
		|   0 КАК ДопРасходыБезНДС,
		|   0 КАК РасходыНаПродажуСНДС,
		|   0 КАК РасходыНаПродажуБезНДС,
		|   0 КАК СтоимостьРегл,
		|   0 КАК СуммаВыручкиРегл,
		|   0 КАК ПостояннаяРазница,
		|   0 КАК ВременнаяРазница,
		|   0 КАК СуммаВыручкиСНДСРегл,
		|   0 КАК СуммаРучнойСкидки,
		|   0 КАК СуммаАвтоматическойСкидки,
		|   0 КАК СтоимостьЗабалансовая,
		|   0 КАК Трудозатраты,
		|   0 КАК ПостатейныеПостоянныеСНДС,
		|   0 КАК ПостатейныеПеременныеСНДС,
		|   0 КАК ПостатейныеПостоянныеБезНДС,
		|   0 КАК ПостатейныеПеременныеБезНДС,
		|   0 КАК СтоимостьЗабалансоваяРегл,
		|   0 КАК ДопРасходыРегл,
		|   0 КАК РасходыНаПродажуРегл,
		|   0 КАК ТрудозатратыРегл,
		|   0 КАК ПостатейныеПостоянныеРегл,
		|   0 КАК ПостатейныеПеременныеРегл,
		|   0 КАК СтоимостьУпр,
		|   0 КАК ДопРасходыУпр,
		|   0 КАК РасходыНаПродажуУпр,
		|   0 КАК ТрудозатратыУпр,
		|   0 КАК ПостатейныеПостоянныеУпр,
		|   0 КАК ПостатейныеПеременныеУпр,
		|
		|   НЕОПРЕДЕЛЕНО КАК НалогообложениеНДС,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаВзаиморасчетов,
		|   0 КАК СуммаВВалютеВзаиморасчетов,
		|   0 КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаДокумента,
		|   0 КАК СуммаВВалютеДокумента,
		|   0 КАК СуммаБезНДСВВалютеДокумента,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаХозяйственнойОперации,
		|	Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторыВыручки КАК Регистраторы
		|		ПО Т.Регистратор = Регистраторы.Регистратор
		|ГДЕ
		|	Т.Количество <> 0
		|";
КонецФункции

Функция ТекстПартииДляВыручкиБезКоличества()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстПартииДляВыручкиБезКоличества"" 				  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)  	  КАК ТипЗаписи,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Корректировка										  КАК Регистратор,
		|	ВЫБОР КОГДА СУММА(Т.Количество) < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК ЭтоСторно,
		|
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   НЕОПРЕДЕЛЕНО КАК Подразделение,
		|   НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   НЕОПРЕДЕЛЕНО КАК Менеджер,
		|   НЕОПРЕДЕЛЕНО КАК Склад,
		|   НЕОПРЕДЕЛЕНО КАК Соглашение,
		|   НЕОПРЕДЕЛЕНО КАК Договор,
		|   НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНаборов,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКонтрагента,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиНоменклатуры,
		|
		|   СУММА(Т.Количество) КАК Количество,
		|   0 КАК СуммаВыручки,
		|   0 КАК СуммаВыручкиБезНДС,
		|   0 КАК Стоимость,
		|   0 КАК СтоимостьБезНДС,
		|   0 КАК ДопРасходы,
		|   0 КАК ДопРасходыБезНДС,
		|   0 КАК РасходыНаПродажуСНДС,
		|   0 КАК РасходыНаПродажуБезНДС,
		|   0 КАК СтоимостьРегл,
		|   0 КАК СуммаВыручкиРегл,
		|   0 КАК ПостояннаяРазница,
		|   0 КАК ВременнаяРазница,
		|   0 КАК СуммаВыручкиСНДСРегл,
		|   0 КАК СуммаРучнойСкидки,
		|   0 КАК СуммаАвтоматическойСкидки,
		|   0 КАК СтоимостьЗабалансовая,
		|   0 КАК Трудозатраты,
		|   0 КАК ПостатейныеПостоянныеСНДС,
		|   0 КАК ПостатейныеПеременныеСНДС,
		|   0 КАК ПостатейныеПостоянныеБезНДС,
		|   0 КАК ПостатейныеПеременныеБезНДС,
		|   0 КАК СтоимостьЗабалансоваяРегл,
		|   0 КАК ДопРасходыРегл,
		|   0 КАК РасходыНаПродажуРегл,
		|   0 КАК ТрудозатратыРегл,
		|   0 КАК ПостатейныеПостоянныеРегл,
		|   0 КАК ПостатейныеПеременныеРегл,
		|   0 КАК СтоимостьУпр,
		|   0 КАК ДопРасходыУпр,
		|   0 КАК РасходыНаПродажуУпр,
		|   0 КАК ТрудозатратыУпр,
		|   0 КАК ПостатейныеПостоянныеУпр,
		|   0 КАК ПостатейныеПеременныеУпр,
		|
		|   НЕОПРЕДЕЛЕНО КАК НалогообложениеНДС,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаВзаиморасчетов,
		|   0 КАК СуммаВВалютеВзаиморасчетов,
		|   0 КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаДокумента,
		|   0 КАК СуммаВВалютеДокумента,
		|   0 КАК СуммаБезНДСВВалютеДокумента,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаХозяйственнойОперации,
		|	"""" КАК ИдентификаторФинЗаписи,
		|	ЛОЖЬ КАК Сторно
		|ИЗ
		|	ВТПартииДляКорректировокСумм КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборКорректировкаСумм КАК Отбор
		|		ПО Т.Корректировка = Отбор.Регистратор
		|		 И Т.АналитикаУчетаНоменклатуры = Отбор.АналитикаУчетаНоменклатуры
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.Корректировка,
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС
		|";
КонецФункции

Функция ТекстВыручкаБезПартий()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстВыручкаБезПартий"" 						  	  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)  КАК ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)								  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ВЫБОР КОГДА Т.Количество < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК ЭтоСторно,
		|
		|	Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   НЕОПРЕДЕЛЕНО КАК Партия,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|   НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.РасходыНаПродажуСНДС,
		|   Т.РасходыНаПродажуБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.РасходыНаПродажуРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.РасходыНаПродажуУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения,
		|   Т.НастройкаХозяйственнойОперации,
		|   Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|ГДЕ
		|	Т.Количество <> 0
		|";
КонецФункции

Функция ТекстВыручкаБезПартийБезКоличества()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстВыручкаБезПартийБезКоличества"" 				  	 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеАвто) КАК ТипЗаписи,
		|	ЛОЖЬ 												  	 КАК РасчетЗавершен,
		|	Т.Период											  	 КАК Период,
		|	Т.Регистратор										  	 КАК Регистратор,
		|	ВЫБОР КОГДА Т.Количество < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК ЭтоСторно,
		|
		|	Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   НЕОПРЕДЕЛЕНО КАК Партия,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|   НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   ВЫБОР КОГДА Т.КоличествоПоложительное > 0
		|		ТОГДА Т.КоличествоПоложительное
		|		ИНАЧЕ Т.Количество
		|	КОНЕЦ КАК Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.РасходыНаПродажуСНДС,
		|   Т.РасходыНаПродажуБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.РасходыНаПродажуРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.РасходыНаПродажуУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения,
		|   Т.НастройкаХозяйственнойОперации,
		|   Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ИЗ
		|	ВТВыручкаБезПартийБезКоличества КАК Т
		|";
КонецФункции

Функция ТекстВыручкаСохраняемыеДвижения()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстВыручкаСохраняемыеДвижения"" 				  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)   КАК ТипЗаписи,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ЛОЖЬ 												  КАК ЭтоСторно,
		|
		|	АналитикаПартнеров.Организация 						  КАК Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.РасходыНаПродажуСНДС,
		|   Т.РасходыНаПродажуБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.РасходыНаПродажуРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.РасходыНаПродажуУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения,
		|   Т.НастройкаХозяйственнойОперации,
		|   Т.ИдентификаторФинЗаписи,
		|	Т.Сторно
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
		|			ПО Т.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|				ПО АналитикаНоменклатуры.Номенклатура = СпрНоменклатура.Ссылка
		|			ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|		ИЛИ Т.Регистратор ССЫЛКА Документ.ВводОстатков
		|		ИЛИ Т.Регистратор ССЫЛКА Документ.ВводОстатковОПродажахЗаПрошлыеПериоды)
		|	И Т.Активность
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|";
КонецФункции

// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюВыручкиИСебестоимостьПродаж(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	// Для корректировок сумм без корректировки количества в качестве источников используем только
	// записи с положительным количеством, т.е. берем данные только из реальных реализаций,
	// т.к. в них есть вся нужная информация о корректируемых партиях товаров.
	// Если есть только сторно реализаций, то берем данные из них.
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПотреблениеАвто
	 И Приход.Количество <= 0 И Расход.Количество >= 0 Тогда
		КоличествоСписания = 0;
	Иначе
		КоличествоСписания = Мин(Расход.Количество, Приход.Количество);
	КонецЕсли;
	
	Если КоличествоСписания = 0 Тогда
		Возврат;
	КонецЕсли;
	
	СуммовыеРесурсы = Новый Структура(
	"Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
    |СуммаВыручки, СуммаВыручкиБезНДС, СуммаВыручкиРегл, СуммаВыручкиСНДСРегл, СуммаРучнойСкидки, СуммаАвтоматическойСкидки,
	|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
	|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
	|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
	|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл,
	|ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
	|СуммаВВалютеВзаиморасчетов, СуммаБезНДСВВалютеВзаиморасчетов, СуммаВВалютеДокумента, СуммаБезНДСВВалютеДокумента");
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	//	Заполняем партионную идентификацию в расчетной партии
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "Партия, АналитикаУчетаПартий, ВидДеятельностиНДС, АналитикаФинансовогоУчета");
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	
	// Заполняем показатели расчетной партии
	
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПотреблениеАвто Тогда
		РасчетнаяПартия.Количество = 0;
	Иначе
		РасчетнаяПартия.Количество = КоличествоСписания;
	КонецЕсли;
	
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(РасходБазис * РасчетнаяПартия[ИмяРесурса.Ключ], 2);
		Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
	КонецЦикла;
	
	// Корректируем базу расчета в приходе и расходе
	Если Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПотреблениеАвто Тогда
		Приход.Количество = Приход.Количество - КоличествоСписания;
	КонецЕсли;
	Расход.Количество = Расход.Количество - КоличествоСписания;
	
	РасчетнаяПартия.РасчетЗавершен = Истина;
	
КонецПроцедуры

#КонецОбласти

#Область ПроцедураЭтапа_ПересортицаПартийТоваров

Процедура ПересортицаПартийТоваров(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПересортицаПартийТоваров");
	СуществующиеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(ПараметрыРасчета);
	
	#Область ПодготовкаДанных
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	АВТОНОМЕРЗАПИСИ() КАК НомерЗаписи,
	|	Остатки.АналитикаУчетаНоменклатуры,
	|	Остатки.РазделУчета,
	|	Остатки.ВидЗапасов,
	|	Остатки.Организация,
	|	Остатки.Партия КАК КорПартия,
	|	Остатки.АналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
	|	Остатки.АналитикаФинансовогоУчета КАК КорАналитикаФинансовогоУчета,
	|	Остатки.ВидДеятельностиНДС КАК КорВидДеятельностиНДС,
	// Ресурсы
	|	-Остатки.Количество КАК Количество
	|
	|ПОМЕСТИТЬ ПартииСОтрицательнымКоличествомВрем
	|ИЗ
	|	ВТКэшРасчетныеОстаткиСебестоимостьТоваров КАК Остатки
	|ГДЕ
	|	Остатки.Количество < 0
	|	И Остатки.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|;
	|ВЫБРАТЬ
	|	Т.НомерЗаписи
	|ИЗ
	|	ПартииСОтрицательнымКоличествомВрем КАК Т
	|";
	ТаблицаИдентификаторов = Новый ТаблицаЗначений;
	ТаблицаИдентификаторов.Колонки.Добавить("Идентификатор", ОбщегоНазначения.ОписаниеТипаСтрока(36));
	ТаблицаИдентификаторов.Колонки.Добавить("НомерЗаписи", ОбщегоНазначения.ОписаниеТипаЧисло(31));
	
	Выборка = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос);
	Пока Выборка.Следующий() Цикл
		НоваяСтрока = ТаблицаИдентификаторов.Добавить();
		НоваяСтрока.Идентификатор = Новый УникальныйИдентификатор;
		НоваяСтрока.НомерЗаписи = Выборка.НомерЗаписи;
	КонецЦикла;
	
	Запрос.УстановитьПараметр("ТаблицаИдентификаторов", ТаблицаИдентификаторов);
	
	Если РасчетСебестоимостиПрикладныеАлгоритмы.РазмерВременнойТаблицы(ПараметрыРасчета, "ПартииСОтрицательнымКоличествомВрем") = 0 Тогда
		
		// Уничтожим ненужные временные таблицы.
		НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(ПараметрыРасчета, СуществующиеВТ);
		РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
		
		Возврат;
		
	КонецЕсли;
	
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ТаблицаИдентификаторов.Идентификатор КАК Идентификатор,
	|	ТаблицаИдентификаторов.НомерЗаписи КАК НомерЗаписи
	|ПОМЕСТИТЬ ТаблицаИдентификаторов
	|ИЗ
	|	&ТаблицаИдентификаторов КАК ТаблицаИдентификаторов
	|ИНДЕКСИРОВАТЬ ПО
	|	НомерЗаписи
	|;
	|ВЫБРАТЬ
	|	Остатки.АналитикаУчетаНоменклатуры,
	|	Остатки.РазделУчета,
	|	Остатки.ВидЗапасов,
	|	Остатки.Организация,
	|	Остатки.КорПартия,
	|	Остатки.КорАналитикаУчетаПартий,
	|	Остатки.КорАналитикаФинансовогоУчета,
	|	Остатки.КорВидДеятельностиНДС,
	|	ТаблицаИдентификаторов.Идентификатор КАК ИдентификаторФинЗаписи,
	// Ресурсы
	|	Остатки.Количество КАК Количество
	|
	|ПОМЕСТИТЬ ПартииСОтрицательнымКоличеством
	|ИЗ
	|	ПартииСОтрицательнымКоличествомВрем КАК Остатки
	|	ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаИдентификаторов КАК ТаблицаИдентификаторов
	|		ПО ТаблицаИдентификаторов.НомерЗаписи = Остатки.НомерЗаписи
	|;
	|ВЫБРАТЬ
	|	Остатки.АналитикаУчетаНоменклатуры,
	|	Остатки.РазделУчета,
	|	Остатки.ВидЗапасов,
	|	Остатки.Организация,
	|	Остатки.Партия,
	|	Остатки.АналитикаУчетаПартий,
	|	Остатки.АналитикаФинансовогоУчета,
	|	Остатки.ВидДеятельностиНДС,
	|	Остатки.Количество
	|ПОМЕСТИТЬ ДоступныеПартии
	|ИЗ
	|	ВТКэшРасчетныеОстаткиСебестоимостьТоваров КАК Остатки
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
	|		ПО Импорт.Ссылка = Остатки.Партия
	|		И Импорт.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
	|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДекларации КАК ЕстьДекларации
	|		ПО ЕстьДекларации.Партия = Остатки.Партия
	//++ Локализация
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ЗакупкаВСтранахЕАЭС
	|		ПО ЗакупкаВСтранахЕАЭС.Ссылка = Остатки.Партия
	|		И ЗакупкаВСтранахЕАЭС.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
	|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьУведомленияОВвозе КАК ЕстьУведомленияОВвозе
	|		ПО ЕстьУведомленияОВвозе.Партия = Остатки.Партия
	|		И ЕстьУведомленияОВвозе.Номенклатура = Остатки.АналитикаУчетаНоменклатуры.Номенклатура
	//-- Локализация
	|ГДЕ
	|	Остатки.Количество > 0
	|	И (
	|		Остатки.АналитикаУчетаНоменклатуры,
	|		Остатки.РазделУчета,
	|		Остатки.ВидЗапасов,
	|		Остатки.Организация) В (
	|	ВЫБРАТЬ
	|		Партии.АналитикаУчетаНоменклатуры,
	|		Партии.РазделУчета,
	|		Партии.ВидЗапасов,
	|		Партии.Организация
	|	ИЗ
	|		ПартииСОтрицательнымКоличеством КАК Партии)
	|	И НЕ (НЕ Остатки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|		И НЕ Импорт.Ссылка ЕСТЬ NULL И ЕстьДекларации.Партия ЕСТЬ NULL)
	//++ Локализация
	|	И НЕ (НЕ ЗакупкаВСтранахЕАЭС.Ссылка ЕСТЬ NULL
	|		 И ЕСТЬNULL(Остатки.АналитикаУчетаНоменклатуры.Номенклатура.ПрослеживаемыйТовар, ЛОЖЬ)
	|		 И ЕстьУведомленияОВвозе.Номенклатура ЕСТЬ NULL)
	//-- Локализация
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос);
	
	#КонецОбласти
	
	#Область РаспределениеДанных
	
	// Инициализируем распределение
	ПараметрыРаспределения = РасчетСебестоимостиУниверсальныеАлгоритмы.ИнициализироватьПараметрыРаспределенияМетодомУменьшаемогоОстатка(
		"ПартииСОтрицательнымКоличеством",
		"ДоступныеПартии",
		"АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация");
		
	РасчетСебестоимостиУниверсальныеАлгоритмы.ИнициализироватьЧисловыеПоляРаспределенияМетодомУменьшаемогоОстатка(
		ПараметрыРаспределения);
		
	РасчетСебестоимостиУниверсальныеАлгоритмы.ИнициализироватьПрочиеПоляРаспределенияМетодомУменьшаемогоОстатка(
		ПараметрыРаспределения,
		"КорПартия, КорАналитикаУчетаПартий, КорАналитикаФинансовогоУчета, КорВидДеятельностиНДС, ИдентификаторФинЗаписи",
		"Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, ВидДеятельностиНДС");
		
	// Распределяем
	РасчетСебестоимостиПрикладныеАлгоритмы.РаспределитьМетодомУменьшаемогоОстаткаСЗамеромВремени(
		ПараметрыРасчета,
		ПараметрыРаспределения,
		"РаспределитьМетодомУменьшаемогоОстатка",
		"ПересортицаПартийТоваров");
		
	Если ПараметрыРаспределения.РезультатыРаспределения.РазмерРезультата = 0 Тогда
		
		// Уничтожим ненужные временные таблицы.
		НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(ПараметрыРасчета, СуществующиеВТ);
		РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
		
		Возврат; // нет распределенных данных
		
	КонецЕсли;
	
	#КонецОбласти
	
	#Область ФормированиеДвижений
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
	|	&КонецПериода КАК Период,
	|	ВТДокументыРасчетаСебестоимости.Ссылка КАК Регистратор,
	|	ВТДокументыРасчетаСебестоимости.Ссылка КАК ДокументДвижения,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
	// Изменения
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	// Ресурсы
	|	ДД.Количество КАК Количество,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Стоимость, 0) КАК ЧИСЛО(31,2)) КАК Стоимость,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьЗабалансовая, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьЗабалансовая,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьДопРасходы, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходы,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьДопРасходыБезНДС, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходыБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Трудозатраты, 0) КАК ЧИСЛО(31,2)) КАК Трудозатраты,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеСНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеСНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеСНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеСНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеБезНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеБезНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьЗабалансоваяРегл, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьЗабалансоваяРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ДопРасходыРегл, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходыРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ТрудозатратыРегл, 0) КАК ЧИСЛО(31,2)) КАК ТрудозатратыРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеРегл, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеРегл, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостояннаяРазница, 0) КАК ЧИСЛО(31,2)) КАК ПостояннаяРазница,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ВременнаяРазница, 0) КАК ЧИСЛО(31,2)) КАК ВременнаяРазница,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьУпр, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ДопРасходыУпр, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходыУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ТрудозатратыУпр, 0) КАК ЧИСЛО(31,2)) КАК ТрудозатратыУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеУпр, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеУпр, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеУпр,
	// Реквизиты
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаПартийТоваров) КАК ХозяйственнаяОперация,
	|	ДД.АналитикаУчетаНоменклатуры.СкладскаяТерритория.Подразделение КАК Подразделение,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ОтклонениеВСтоимостиТоваров) КАК СтатьяРасходовСписания,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ОтклонениеВСтоимостиТоваров) КАК СтатьяДоходов,
	|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК АналитикаРасходов,
	|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК АналитикаДоходов,
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.ИдентификаторФинЗаписи,
	|	НастройкиХозяйственныхОпераций.Ссылка КАК НастройкаХозяйственнойОперации
	|
	|ПОМЕСТИТЬ ВТДвиженияПересортицаПартий
	|ИЗ
	|	ВТРезультатРаспределения КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРасчетаСебестоимости КАК ВТДокументыРасчетаСебестоимости
	|		ПО ВТДокументыРасчетаСебестоимости.Организация = ДД.Организация
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
	|		ПО Цены.Организация = ДД.Организация
	|		И Цены.Партия = ДД.КорПартия
	|		И Цены.АналитикаУчетаПартий = ДД.КорАналитикаУчетаПартий
	|		И Цены.АналитикаФинансовогоУчета = ДД.КорАналитикаФинансовогоУчета
	|		И Цены.ВидДеятельностиНДС = ДД.КорВидДеятельностиНДС
	|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
	|		И Цены.ВидЗапасов = ДД.ВидЗапасов
	|		И Цены.РазделУчета = ДД.РазделУчета
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НастройкиХозяйственныхОпераций КАК НастройкиХозяйственныхОпераций
	|		ПО НастройкиХозяйственныхОпераций.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаПартийТоваров)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения) КАК ТипЗаписи,
	|	&КонецПериода КАК Период,
	|	ВТДокументыРасчетаСебестоимости.Ссылка КАК Регистратор,
	|	ВТДокументыРасчетаСебестоимости.Ссылка КАК ДокументДвижения,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
	// Изменения
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.КорПартия КАК Партия,
	|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
	|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
	// Ресурсы
	|	ДД.Количество КАК Количество,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Стоимость, 0) КАК ЧИСЛО(31,2)) КАК Стоимость,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьЗабалансовая, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьЗабалансовая,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьДопРасходы, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходы,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьДопРасходыБезНДС, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходыБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Трудозатраты, 0) КАК ЧИСЛО(31,2)) КАК Трудозатраты,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеСНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеСНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеСНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеСНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеБезНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеБезНДС, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеБезНДС,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьЗабалансоваяРегл, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьЗабалансоваяРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ДопРасходыРегл, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходыРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ТрудозатратыРегл, 0) КАК ЧИСЛО(31,2)) КАК ТрудозатратыРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеРегл, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеРегл, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеРегл,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостояннаяРазница, 0) КАК ЧИСЛО(31,2)) КАК ПостояннаяРазница,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ВременнаяРазница, 0) КАК ЧИСЛО(31,2)) КАК ВременнаяРазница,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьУпр, 0) КАК ЧИСЛО(31,2)) КАК СтоимостьУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ДопРасходыУпр, 0) КАК ЧИСЛО(31,2)) КАК ДопРасходыУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ТрудозатратыУпр, 0) КАК ЧИСЛО(31,2)) КАК ТрудозатратыУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПостоянныеУпр, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПостоянныеУпр,
	|	ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.ПостатейныеПеременныеУпр, 0) КАК ЧИСЛО(31,2)) КАК ПостатейныеПеременныеУпр,
	// Реквизиты
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаПартийТоваров) КАК ХозяйственнаяОперация,
	|	НЕОПРЕДЕЛЕНО КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО КАК СтатьяДоходов,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаДоходов,
	|	ДД.ВидДеятельностиНДС КАК КорВидДеятельностиНДС,
	|	ДД.ИдентификаторФинЗаписи,
	|	НастройкиХозяйственныхОпераций.Ссылка КАК НастройкаХозяйственнойОперации
	|ИЗ
	|	ВТРезультатРаспределения КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРасчетаСебестоимости КАК ВТДокументыРасчетаСебестоимости
	|		ПО ВТДокументыРасчетаСебестоимости.Организация = ДД.Организация
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
	|		ПО Цены.Организация = ДД.Организация
	|		И Цены.Партия = ДД.КорПартия
	|		И Цены.АналитикаУчетаПартий = ДД.КорАналитикаУчетаПартий
	|		И Цены.АналитикаФинансовогоУчета = ДД.КорАналитикаФинансовогоУчета
	|		И Цены.ВидДеятельностиНДС = ДД.КорВидДеятельностиНДС
	|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
	|		И Цены.ВидЗапасов = ДД.ВидЗапасов
	|		И Цены.РазделУчета = ДД.РазделУчета
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НастройкиХозяйственныхОпераций КАК НастройкиХозяйственныхОпераций
	|		ПО НастройкиХозяйственныхОпераций.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаПартийТоваров)
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос);
	
	ИмяВременнойТаблицы = "ВТДвиженияСебестоимости";
	ИмяРегистра = Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя;
	ОписаниеПриемника = ПараметрыРасчета.Движения[ИмяРегистра];
	ИмяВременнойТаблицыИсточник = "ВТДвиженияПересортицаПартий";
	
	КопируемыеПоля = РасчетСебестоимостиУниверсальныеАлгоритмы.ПолучитьИменаКолонокВременнойТаблицыСтрокой(ПараметрыРасчета, ИмяВременнойТаблицыИсточник);
	
	ТаблицаОписанияПолей = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьОписаниеПолейЗапроса(ОписаниеПриемника.Таблица);
	РасчетСебестоимостиПрикладныеАлгоритмы.КопироватьПоляЗапроса(ТаблицаОписанияПолей, КопируемыеПоля);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросПоОписаниюПолей(ПараметрыРасчета, ТаблицаОписанияПолей, 
		ИмяРегистра, ИмяВременнойТаблицыИсточник, ИмяВременнойТаблицы);
	
	СоответствиеВременныхТаблицДвижений = Новый Соответствие;
	СоответствиеВременныхТаблицДвижений.Вставить(ИмяВременнойТаблицы, ИмяРегистра);
	
	#КонецОбласти
	
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвиженияИзВременныхТаблиц(ПараметрыРасчета, СоответствиеВременныхТаблицДвижений);
	
	// Уничтожим ненужные временные таблицы.
	НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(ПараметрыРасчета, СуществующиеВТ);
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
	
КонецПроцедуры

#КонецОбласти

#Область ПроцедураЭтапа_СторноДвиженийРасчетаПартийИсправленныхДокументов

Процедура СторноДвиженийРасчетаПартийИсправленныхДокументов(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "СторноДвиженийРасчетаПартийИсправленныхДокументов");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	
	// 2. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляСторноДвиженийРасчетаПартийСебестоимостьТоваров(ПараметрыРасчета));
		
	// 3. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру СебестоимостьТоваров.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
КонецПроцедуры

// Получение данных для движений по регистру "Себестоимость товаров".

Функция ТекстЗапросаДляСторноДвиженийРасчетаПартийСебестоимостьТоваров(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИсправленныеДокументы() // вт ИсправленныеДокументы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхДляПартийТоваров() // вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСторноДвиженияРасчетаПартийСебестоимостьТоваров()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстСторноДвиженияРасчетаПартийСебестоимостьТоваров() // использует ИсправленныеДокументы
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстСторноДвиженияРасчетаПартийСебестоимостьТоваров"" КАК ЗапросИсточник,
		|	ДанныеРегистра.ТипЗаписи						КАК ТипЗаписи,
		|	ЛОЖЬ											КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											КАК ЭтоСторно,
		|	0 												КАК Приоритет,
		|	0 												КАК Знаменатель,
		|	ИСТИНА 											КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)  КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО							 		КАК НалогообложениеПартии,
		|	ИсправленныеДокументы.Период,
		|	ИсправленныеДокументы.Период КАК ПериодПоступления,
		|	ИсправленныеДокументы.Регистратор,
		|	ДанныеРегистра.ВидДвижения,
		|
		|	ДанныеРегистра.АналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.РазделУчета,
		|	ДанныеРегистра.ВидЗапасов,
		|	ДанныеРегистра.Организация,
		|	ДанныеРегистра.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДанныеРегистра.АналитикаУчетаПартий,
		|	ДанныеРегистра.АналитикаФинансовогоУчета,
		|	ДанныеРегистра.ВидДеятельностиНДС,
		|
		|	-ДанныеРегистра.Количество,
		|	-ДанныеРегистра.Стоимость,
		|	-ДанныеРегистра.СтоимостьБезНДС,
		|	-ДанныеРегистра.СтоимостьЗабалансовая,
		|	-ДанныеРегистра.СтоимостьУпр,
		|	-ДанныеРегистра.ДопРасходыУпр,
		|	-ДанныеРегистра.ПостатейныеПеременныеСНДС,
		|	-ДанныеРегистра.ПостатейныеПеременныеБезНДС,
		|	-ДанныеРегистра.ТрудозатратыУпр,
		|	-ДанныеРегистра.ПостатейныеПостоянныеУпр,
		|	-ДанныеРегистра.ПостатейныеПеременныеУпр,
		|	-ДанныеРегистра.ДопРасходы,
		|	-ДанныеРегистра.ДопРасходыБезНДС,
		|	-ДанныеРегистра.Трудозатраты,
		|	-ДанныеРегистра.ПостатейныеПостоянныеСНДС,
		|	-ДанныеРегистра.ПостатейныеПостоянныеБезНДС,
		|	-ДанныеРегистра.СтоимостьРегл,
		|	-ДанныеРегистра.СтоимостьЗабалансоваяРегл,
		|	-ДанныеРегистра.ПостояннаяРазница,
		|	-ДанныеРегистра.ВременнаяРазница,
		|	-ДанныеРегистра.ДопРасходыРегл,
		|	-ДанныеРегистра.ТрудозатратыРегл,
		|	-ДанныеРегистра.ПостатейныеПостоянныеРегл,
		|	-ДанныеРегистра.ПостатейныеПеременныеРегл,
		|	-ДанныеРегистра.РезервПодОбесценениеРегл,
		|	-ДанныеРегистра.РезервПодОбесценениеУпр,
		|
		|	ДанныеРегистра.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДанныеРегистра.КорАналитикаУчетаНоменклатуры,
		|	ДанныеРегистра.КорРазделУчета,
		|	ДанныеРегистра.КорВидЗапасов,
		|	ДанныеРегистра.КорОрганизация,
		|	ДанныеРегистра.КорСтоимость,
		|	ДанныеРегистра.АналитикаУчетаПоПартнерам,
		|	ДанныеРегистра.ЗаказКлиента,
		|	ДанныеРегистра.Подразделение,
		|	ДанныеРегистра.АналитикаРасходов,
		|	ДанныеРегистра.СтатьяРасходовСписания,
		|	ДанныеРегистра.СтатьяДоходов,
		|	ДанныеРегистра.АналитикаДоходов,
		|	ДанныеРегистра.ПериодПродажи,
		|	ДанныеРегистра.СтатьяАктивовПассивов,
		|	ДанныеРегистра.АналитикаАктивовПассивов,
		|	ДанныеРегистра.ДокументДвижения,
		|	ДанныеРегистра.ИдентификаторСтроки,
		|	ДанныеРегистра.ГруппаПродукции,
		|	ДанныеРегистра.КорПартия,
		|	ДанныеРегистра.КорАналитикаУчетаПартий,
		|	ДанныеРегистра.КорАналитикаФинансовогоУчета,
		|	ДанныеРегистра.КорВидДеятельностиНДС,
		|	ДанныеРегистра.ВидДеятельностиНДСДокумента,
		|	ДанныеРегистра.ВидДеятельностиНДСОтгрузки,
		|	ДанныеРегистра.АналитикаФинансовогоУчетаДокумента,
		|	ДанныеРегистра.ОперацияУчетаСебестоимости,
		|	-ДанныеРегистра.НДСУпр,
		|	-ДанныеРегистра.НДСРегл,
		|	ДанныеРегистра.СтатьяКалькуляции,
		|	ДанныеРегистра.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	ДанныеРегистра.КорНаправлениеДеятельности,
		|	ДанныеРегистра.КодСтроки,
		|	ДанныеРегистра.НастройкаХозяйственнойОперации,
		|	ДанныеРегистра.ИдентификаторФинЗаписи,
		|	ДанныеРегистра.НастройкаСчетовУчета,
		|	ИСТИНА КАК Сторно,
		|	ДанныеРегистра.ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДанныеРегистра
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИсправленныеДокументы КАК ИсправленныеДокументы
		|		ПО ИсправленныеДокументы.ДокументИсточник = ДанныеРегистра.Регистратор
		|ГДЕ
		|	ДанныеРегистра.Организация В (&МассивОрганизаций)
		|	И ДанныеРегистра.Период < &НачалоПериода
		|	И ДанныеРегистра.Активность
		|	И ДанныеРегистра.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимостиНаПрочиеРасходы),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск))
		|	И ДанныеРегистра.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И НЕ ДанныеРегистра.РасчетСебестоимости
		|	И ДанныеРегистра.РасчетПартий
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДанныеРегистра.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|";
КонецФункции

#КонецОбласти

#Область ПроцедураЭтапа_ПодготовкаДанныхДляПредварительногоРасчетаСебестоимости

// Тексты запросов

// ... общий

Функция ТекстЗапросаПодготовкиДанныхДляПредварительногоРасчетаСебестоимости(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		+ ТекстВтТоварыКПередаче()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхДляПартийТоваров() //вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТоварыКПередачеРасход()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТоварыКПередачеПриход()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстВтТоварыКПередаче() // ВтТоварыКПередаче
	Возврат
		"ВЫБРАТЬ
		|	ПроданныеТовары.ОрганизацияВладелец            КАК ОрганизацияПродавец,
		|	ПроданныеТовары.ВидЗапасовПродавца.Организация КАК ОрганизацияПолучатель,
		|	ПроданныеТовары.АналитикаУчетаНоменклатуры     КАК АналитикаУчетаНоменклатуры,
		|	СУММА(ПроданныеТовары.КоличествоОстаток)       КАК Количество,
		|	ПроданныеТовары.ВидЗапасовПродавца.ВидЗапасовВладельца            КАК ВидЗапасовПродавца,
		|	ПроданныеТовары.ВидЗапасовПродавца.ВидЗапасовВладельца.ТипЗапасов КАК ТипЗапасовПродавца,
		|	ПроданныеТовары.ВидЗапасовПродавца 								  КАК ВидЗапасовПолучателя,
		|	ПроданныеТовары.ВидЗапасовПродавца.ТипЗапасов					  КАК ТипЗапасовПолучателя
		|
		|ПОМЕСТИТЬ ВтТоварыКПередаче
		|ИЗ
		|	РегистрНакопления.ТоварыОрганизацийКПередаче.Остатки(&ГраницаКонецПериода,
		|		ОрганизацияВладелец В (&МассивОрганизаций)
		|		И ВидЗапасовПродавца.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
		|		И (&РежимЗакрытияМесяца = ЗНАЧЕНИЕ(Перечисление.РежимыЗакрытияМесяца.ПредварительноеЗакрытие)
		|			ИЛИ &РегламентноеЗадание)
		|	) КАК ПроданныеТовары
		|
		|СГРУППИРОВАТЬ ПО
		|	ПроданныеТовары.ОрганизацияВладелец,
		|	ПроданныеТовары.ВидЗапасовПродавца.Организация,
		|	ПроданныеТовары.АналитикаУчетаНоменклатуры,
		|	ПроданныеТовары.ВидЗапасовПродавца.ВидЗапасовВладельца,
		|	ПроданныеТовары.ВидЗапасовПродавца
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Резервы.Организация                            КАК ОрганизацияПродавец,
		|	Резервы.КорОрганизация                         КАК ОрганизацияПолучатель,
		|	Резервы.АналитикаУчетаНоменклатуры             КАК АналитикаУчетаНоменклатуры,
		|	СУММА(Резервы.Количество)                      КАК Количество,
		|	Резервы.ВидЗапасов                             КАК ВидЗапасовПродавца,
		|	Резервы.ВидЗапасов.ТипЗапасов                  КАК ТипЗапасовПродавца,
		|	Резервы.КорВидЗапасов                          КАК ВидЗапасовПолучателя,
		|	Резервы.КорВидЗапасов.ТипЗапасов               КАК ТипЗапасовПолучателя
		|
		|ИЗ
		|	РегистрНакопления.РезервыТоваровОрганизаций КАК Резервы
		|ГДЕ
		|	Резервы.Период МЕЖДУ &НачалоПериода И КОНЕЦПЕРИОДА(&КонецПериода, МЕСЯЦ)
		|	И Резервы.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И Резервы.Организация В (&МассивОрганизаций)
		|	И Резервы.КорВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
		|	И (&РежимЗакрытияМесяца = ЗНАЧЕНИЕ(Перечисление.РежимыЗакрытияМесяца.ПредварительноеЗакрытие)
		|		ИЛИ &РегламентноеЗадание)
		|
		|СГРУППИРОВАТЬ ПО
		|	Резервы.Организация,
		|	Резервы.КорОрганизация,
		|	Резервы.АналитикаУчетаНоменклатуры,
		|	Резервы.ВидЗапасов,
		|	Резервы.КорВидЗапасов
		|";
КонецФункции

Функция ТекстТоварыКПередачеРасход() // использует ВтТоварыКПередаче
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТоварыКПередачеРасход"" 	  				 			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеАвто)	 КАК ТипЗаписи,
		|	ЛОЖЬ														 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														 КАК ЭтоСторно,
		|	10 										  					 КАК Приоритет,
		|	0								  							 КАК Знаменатель,
		|	(ВЫБОР
		|		КОГДА &РегламентноеЗадание ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)										 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					 КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												 КАК НалогообложениеПартии,
		|
		|	&КонецПериода КАК Период,
		|	&НачалоПериода КАК ПериодПоступления,
		|	ВТДокументыРасчетаСебестоимости.Ссылка КАК Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	(ВЫБОР 
		|		КОГДА ДД.ТипЗапасовПродавца = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
		|		КОГДА ДД.ТипЗапасовПродавца = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
		|		КОГДА ДД.ТипЗапасовПродавца = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|		КОГДА ДД.ТипЗапасовПродавца = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
		|		КОГДА ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая, ЛОЖЬ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|	КОНЕЦ) КАК РазделУчета,
		|	ДД.ВидЗапасовПродавца КАК ВидЗапасов,
		|	ДД.ОрганизацияПродавец КАК Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДС,
		|
		|	ДД.Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию) КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	(ВЫБОР 
		|		КОГДА ДД.ВидЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
		|		КОГДА ДД.ВидЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
		|		КОГДА ДД.ВидЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|		КОГДА ДД.ВидЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
		|		КОГДА ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая, ЛОЖЬ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|	КОНЕЦ) КАК КорРазделУчета,
		|	ДД.ВидЗапасовПолучателя КАК КорВидЗапасов,
		|	ДД.ОрганизацияПолучатель КАК КорОрганизация,
		|	0 КАК КорСтоимость,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовСписания,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаДоходов,
		|	НЕОПРЕДЕЛЕНО КАК ПериодПродажи,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
		|	"""" КАК ИдентификаторСтроки,
		|	НЕОПРЕДЕЛЕНО КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию КАК КорВидДеятельностиНДС,
		|	УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию КАК ВидДеятельностиНДСДокумента,
		|	НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО КАК ОперацияУчетаСебестоимости,
		|	0 КАК НДСУпр,
		|	0 КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	0 КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаХозяйственнойОперации,
		|	"""" ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаСчетовУчета,
		|	ЛОЖЬ КАК Сторно,
		|	ЛОЖЬ КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВтТоварыКПередаче КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРасчетаСебестоимости КАК ВТДокументыРасчетаСебестоимости
		|		ПО ВТДокументыРасчетаСебестоимости.Организация = ДД.ОрганизацияПродавец
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизаций
		|		ПО ДД.ОрганизацияПолучатель = УчетныеПолитикиОрганизаций.Организация
		|";
КонецФункции

Функция ТекстТоварыКПередачеПриход() // использует ВтТоварыКПередаче
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТоварыКПередачеПриход"" 	  				 			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)	 КАК ТипЗаписи,
		|	ЛОЖЬ														 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														 КАК ЭтоСторно,
		|	10 										  					 КАК Приоритет,
		|	0								  							 КАК Знаменатель,
		|	ИСТИНА 														 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					 КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												 КАК НалогообложениеПартии,
		|
		|	&КонецПериода КАК Период,
		|	&НачалоПериода КАК ПериодПоступления,
		|	ВТДокументыРасчетаСебестоимости.Ссылка КАК Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	(ВЫБОР 
		|		КОГДА ДД.ТипЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
		|		КОГДА ДД.ТипЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
		|		КОГДА ДД.ТипЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|		КОГДА ДД.ТипЗапасовПолучателя = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
		|		КОГДА ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая, ЛОЖЬ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|	КОНЕЦ) КАК РазделУчета,
		|	ДД.ВидЗапасовПолучателя КАК ВидЗапасов,
		|	ДД.ОрганизацияПолучатель КАК Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию КАК ВидДеятельностиНДС,
		|
		|	ДД.Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|	0 КАК РезервПодОбесценениеРегл,
		|	0 КАК РезервПодОбесценениеУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию) КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	0 КАК КорСтоимость,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовСписания,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаДоходов,
		|	НЕОПРЕДЕЛЕНО КАК ПериодПродажи,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
		|	"""" КАК ИдентификаторСтроки,
		|	НЕОПРЕДЕЛЕНО КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК КорВидДеятельностиНДС,
		|	НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДСДокумента,
		|	НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДСОтгрузки,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчетаДокумента,
		|	НЕОПРЕДЕЛЕНО КАК ОперацияУчетаСебестоимости,
		|	0 КАК НДСУпр,
		|	0 КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетныйИсточник,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	0 КАК КодСтроки,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаХозяйственнойОперации,
		|	"""" ИдентификаторФинЗаписи,
		|	НЕОПРЕДЕЛЕНО КАК НастройкаСчетовУчета,
		|	ЛОЖЬ КАК Сторно,
		|	ЛОЖЬ КАК ВыполненРасчетПартий,
		|	НЕОПРЕДЕЛЕНО КАК РежимЗакрытияМесяца
		|ИЗ
		|	ВтТоварыКПередаче КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРасчетаСебестоимости КАК ВТДокументыРасчетаСебестоимости
		|		ПО ВТДокументыРасчетаСебестоимости.Организация = ДД.ОрганизацияПолучатель
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизаций
		|		ПО ДД.ОрганизацияПолучатель = УчетныеПолитикиОрганизаций.Организация
		|";
КонецФункции

#КонецОбласти

#Область ПроцедурыЭтапов_Контекстные

// Используется для всех вызовов заполнения расчетной партии.
//
Процедура ЗаполнитьРасчетнуюПартию(ПараметрыРасчета, Контекст, РасчетнаяПартия, Расход, Приход, ПартияЗаполнена) Экспорт
	
	Если Контекст = "ЗаполнениеПартийВРегистреСебестоимостьТоваров" Тогда
		ЗаполнитьРасчетнуюПартиюСебестоимостиТоваров(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	ИначеЕсли Контекст = "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж" Тогда
		ЗаполнитьРасчетнуюПартиюВыручкиИСебестоимостьПродаж(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область Тестирование

// Дополняет список этаов с распределением партий.
//
// Параметры:
//	СписокЭтапов - СписокЗначений - список этапов с распределением партий
//
Процедура ДополнитьЭтапыСРаспределениемПартий(СписокЭтапов) Экспорт
	
	СписокЭтапов.Добавить("ЗаполнениеПартийВРегистреСебестоимостьТоваров");
	СписокЭтапов.Добавить("ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж");
	СписокЭтапов.Добавить("СторноДвиженийРасчетаПартийИсправленныхДокументов");
	
КонецПроцедуры

// Дополняет список этаов с трансляцией партий.
//
// Параметры:
//	СписокЭтапов - СписокЗначений - список этапов с трансляцией партий
//
Процедура ДополнитьЭтапыСТрансляциейПартий(СписокЭтапов) Экспорт
	
	СписокЭтапов.Добавить("ПодготовкаДанныхДляПредварительногоРасчетаСебестоимости");
	
КонецПроцедуры

Процедура ТекстЗапросаДляРасчетаЭтапа(ИмяЭтапа, ПараметрыРасчета, ТекстЗапроса) Экспорт
	
	Если ИмяЭтапа = "ЗаполнениеПартийВРегистреСебестоимостьТоваров" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийТоваров(ПараметрыРасчета);
		
	ИначеЕсли ИмяЭтапа = "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийВыручки(ПараметрыРасчета);
		
	ИначеЕсли ИмяЭтапа = "СторноДвиженийРасчетаПартийИсправленныхДокументов" Тогда
		ТекстЗапроса = ТекстЗапросаДляСторноДвиженийРасчетаПартийСебестоимостьТоваров(ПараметрыРасчета);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
