////////////////////////////////////////////////////////////////////////////////
// Расширение подсистемы "Физические лица" для УТ и ERP (локализация).
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область ФИОФизическихЛиц

// Формирует структуру, содержащую информацию о фамилии, имени и отчестве физического лица.
// Строка формируется в зависимости от типа переданного параметра:
//	- либо по истории ФИО элемента справочника ФизическиеЛица,
// 	- либо разбором строки, содержащей полную ФИО.
//
// Параметры:
//  ФизическоеЛицо - Строка, СправочникСсылка.ФизическиеЛица - источник информации о ФИО
//  ФИОФизическогоЛица - Структура - со свойствами
//		Фамилия  - Строка;
//		Имя      - Строка;
//		Отчество - Строка.
//  Дата - Дата - дата для получения истории ФИО, имеет смысл если в первом параметре передана ссылка.
//
Процедура ДополнитьФИО(ФизическоеЛицо, ФИОФизическогоЛица, Дата = Неопределено) Экспорт
	//++ Локализация
	Если ЗначениеЗаполнено(ФизическоеЛицо) Тогда
		
		Если ТипЗнч(ФизическоеЛицо) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
			
			// Получим срез регистра сведений ФИОФизическихЛиц на нужную дату
			УстановитьПривилегированныйРежим(Истина);
			
			ТаблицаСрезПоследних = РегистрыСведений.ФИОФизическихЛиц.СрезПоследних(
				?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДатаСеанса()),
				Новый Структура("ФизическоеЛицо", ФизическоеЛицо));
			
			УстановитьПривилегированныйРежим(Ложь);
			
			Если ТаблицаСрезПоследних.Количество() > 0 Тогда
				// Если в регистре есть данные, то заполним возвращаемую структуру
				ЗаполнитьЗначенияСвойств(ФИОФизическогоЛица, ТаблицаСрезПоследних[0]);
			КонецЕсли;
			
		Иначе
			
			// Результат получаем разбирая строку, содержащую полную ФИО
			ЗаполнитьЗначенияСвойств(
				ФИОФизическогоЛица,
				ФизическиеЛицаКлиентСервер.ЧастиИмени(СокрЛП(ФизическоеЛицо)));
			
		КонецЕсли;
		
	КонецЕсли;
	//-- Локализация
КонецПроцедуры

// Формирует строку, содержащую фамилию и инициалы физического лица.
// Строка формируется в зависимости от типа переданного параметра:
//	- либо по истории ФИО элемента справочника ФизическиеЛица,
// 	- либо разбором строки, содержащей полную ФИО.
//
// Параметры:
//  ФизическоеЛицо - Строка, СправочникСсылка.ФизическиеЛица - источник информации о ФИО
//  ФамилияИнициалы - Строка - Фамилия И. О.
//  Дата - Дата - дата для получения истории ФИО, имеет смысл если в первом параметре передана ссылка.
//
Процедура ДополнитьФамилияИнициалыФизЛица(ФизическоеЛицо, ФамилияИнициалы, Дата = Неопределено) Экспорт
	
	//++ Локализация
	Если ЗначениеЗаполнено(ФизическоеЛицо) Тогда
		
		Если ТипЗнч(ФизическоеЛицо) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
			
			// Получаем фамилию, имя, отчество на указанную дату
			ФИОФизическогоЛица = ФизическиеЛицаУТ.ФамилияИмяОтчество(ФизическоеЛицо, Дата);
			
			// Результат получаем из отдельных частей - фамилии, имени, отчества
			ФамилияИнициалы = ФизическиеЛицаКлиентСервер.ФамилияИнициалы(ФИОФизическогоЛица);
			
		Иначе	
			
			// Результат получаем разбирая строку, содержащую полную ФИО
			ФИОФизическогоЛица = ФизическиеЛицаКлиентСервер.ЧастиИмени(СокрЛП(ФизическоеЛицо));
			ФамилияИнициалы = ФизическиеЛицаКлиентСервер.ФамилияИнициалы(ФИОФизическогоЛица);
			
		КонецЕсли;
		
	КонецЕсли;
	//-- Локализация
КонецПроцедуры

#КонецОбласти

#КонецОбласти
