#Область ПрограммныйИнтерфейс

Процедура ПриОпределенииТекстаЗапросаОформленныхДокументов(ТекстЗапроса, ОтчетОбъект) Экспорт
	
	Текст = Неопределено;
	Отчет = ОтчетОбъект.Метаданные();
	
	Если Отчет = Метаданные.Отчеты.АнализРасхожденийПриПоступленииАлкогольнойПродукции Тогда
		Текст = ОформленныеДокументыПоПоступлениюАлкогольнойПродукции();
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриОтгрузкеАлкогольнойПродукции Тогда
		Текст = ОформленныеДокументыПоОтгрузкеАлкогольнойПродукции();
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриДвиженииАлкогольнойПродукции Тогда
		Текст = ОформленныеДокументыПоДвижениюАлкогольнойПродукции();
	
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриПоступленииПродукцииВЕТИС Тогда
		Текст = ОформленныеДокументыПоПоступлениюПродукцииВЕТИС();
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриОтгрузкеПродукцииВЕТИС Тогда
		Текст = ОформленныеДокументыПоОтгрузкеПродукцииВЕТИС();
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриИнвентаризацииПродукцииВЕТИС Тогда
		Текст = ОформленныеДокументыПоИнвентаризацииПродукцииВЕТИС();
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриПроизводствеПродукцииВЕТИС Тогда
		Текст = ОформленныеДокументыПоПроизводственнойОперацииВЕТИС();
	
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриМаркировкеТоваровИСМП Тогда
		Текст = ОформленныеДокументыПоМаркировкеТоваровИСМП();
	ИначеЕсли Отчет = Метаданные.Отчеты.АнализРасхожденийПриВыводеИзОборотаИСМП Тогда
		Текст = ОформленныеДокументыВыводуИзОборотаИСМП();
	КонецЕсли;
	
	Если Не(Текст = Неопределено) Тогда
		ТекстЗапроса = Текст;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ТекстыЗапросов

Функция ОформленныеДокументыВыводуИзОборотаИСМП()
	
	МассивТекстовЗапросов = Новый Массив;
	
	Реализации = "";
	Если ДобавитьОснование(МассивТекстовЗапросов, "РеализацияТоваровУслуг", "Товары", Истина) Тогда
		ДобавитьОснование(МассивТекстовЗапросов, "РеализацияТоваровУслуг", "Серии");
		Реализации = СтрСоединить(МассивТекстовЗапросов, " ОБЪЕДИНИТЬ ВСЕ ");
		ДопОтбор = СтрШаблон("И (%1 ИЛИ %2)",
			"ТаблицаТовары.Ссылка.Контрагент.СтранаРегистрации <> ЗНАЧЕНИЕ(Справочник.СтраныМира.Россия)",
			"ТаблицаТовары.Ссылка.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
			|И ТаблицаТовары.Ссылка.Касса В(ВЫБРАТЬ Касса Из РегистрСведений.КассыНеПередающиеДанныеВИСМП)");
		Реализации = СтрЗаменить(Реализации, ".Проведен", ".Проведен "+ДопОтбор);
	КонецЕсли;
	МассивТекстовЗапросов.Очистить();
	
	Розница = "";
	ДобавитьОснование(МассивТекстовЗапросов, "ЧекККМ", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ЧекККМ", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "ОтчетОРозничныхПродажах", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ОтчетОРозничныхПродажах", "Серии");
	Если МассивТекстовЗапросов.Количество() Тогда
		Розница = СтрСоединить(МассивТекстовЗапросов, " ОБЪЕДИНИТЬ ВСЕ ");
		Розница = СтрЗаменить(Розница, ".Проведен", ".Проведен И ТаблицаТовары.Ссылка.КассаККМ В(ВЫБРАТЬ Касса Из РегистрСведений.КассыНеПередающиеДанныеВИСМП)");
	КонецЕсли;
	МассивТекстовЗапросов.Очистить();
	
	Возвраты = "";
	Если ДобавитьОснование(МассивТекстовЗапросов, "ВозвратТоваровПоставщику", "Товары", Истина) Тогда
		ДобавитьОснование(МассивТекстовЗапросов, "ВозвратТоваровПоставщику", "Серии");
		Возвраты = СтрСоединить(МассивТекстовЗапросов, " ОБЪЕДИНИТЬ ВСЕ ");
		Возвраты = СтрЗаменить(Реализации, ".Проведен", ".Проведен И ТаблицаТовары.Ссылка.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)");
	КонецЕсли;
	МассивТекстовЗапросов.Очистить();
	
	ЗнакСборки = "ВЫБОР КОГДА ТаблицаТовары.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров) ТОГДА 0 ИНАЧЕ 1 КОНЕЦ * ";
	ЗнакЭтоСерииШапки = "ВЫБОР КОГДА ТаблицаТовары.Номенклатура = ТаблицаТовары.Ссылка.Номенклатура И ТаблицаТовары.Характеристика = ТаблицаТовары.Ссылка.Характеристика ТОГДА 1 ИНАЧЕ 0 КОНЕЦ * ";
	Если ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "", Истина, ЗнакСборки) Тогда
		МассивТекстовЗапросов[0] = СтрЗаменить(МассивТекстовЗапросов[0], "Документ.СборкаТоваров.", "Документ.СборкаТоваров");
	КонецЕсли;
	ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "Товары",, ЗнакСборки+ЗнакЭтоСерииШапки);
	ДобавитьОснование(МассивТекстовЗапросов, "ВнутреннееПотреблениеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ВнутреннееПотреблениеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "СписаниеНедостачТоваров", "Товары");
	
	Если ЗначениеЗаполнено(Реализации) Тогда
		МассивТекстовЗапросов.Добавить(Реализации);
	КонецЕсли;
	Если ЗначениеЗаполнено(Возвраты) Тогда
		МассивТекстовЗапросов.Добавить(Возвраты);
	КонецЕсли;
	Если ЗначениеЗаполнено(Розница) Тогда
		МассивТекстовЗапросов.Добавить(Розница);
	КонецЕсли;
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииИСМП(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоМаркировкеТоваровИСМП()
	
	МассивТекстовЗапросов = Новый Массив;
	
	ЗнакСборки = "ВЫБОР КОГДА ТаблицаТовары.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров) ТОГДА 1 ИНАЧЕ 0 КОНЕЦ * ";
	ЗнакЭтоСерииШапки = "ВЫБОР КОГДА ТаблицаТовары.Номенклатура = ТаблицаТовары.Ссылка.Номенклатура И ТаблицаТовары.Характеристика = ТаблицаТовары.Ссылка.Характеристика ТОГДА 1 ИНАЧЕ 0 КОНЕЦ * ";
	Если ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "", Истина, ЗнакСборки) Тогда
		МассивТекстовЗапросов[0] = СтрЗаменить(МассивТекстовЗапросов[0], "Документ.СборкаТоваров.", "Документ.СборкаТоваров");
	КонецЕсли;
	ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "Товары",, ЗнакСборки+ЗнакЭтоСерииШапки);
	
	Импорт = СтрЗаменить(РасчетСтатусовОформленияИСУТ.ХозяйственнаяОперацияИмпорт(), "ТаблицаДокумента", "ТаблицаТовары.Ссылка");
	Знак = СтрШаблон("(%1 ИЛИ %2)", Импорт, "ТаблицаТовары.Ссылка.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)");
	ЗнакПоступление = СтрШаблон("ВЫБОР КОГДА %1 ТОГДА 1 ИНАЧЕ 0 КОНЕЦ * ", Знак);
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Товары", Истина, ЗнакПоступление);
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Серии",, ЗнакПоступление);
	
	ДобавитьОснование(МассивТекстовЗапросов, "ПрочееОприходованиеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ПрочееОприходованиеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "ОприходованиеИзлишковТоваров", "Товары");
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииИСМП(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоПроизводственнойОперацииВЕТИС()
	
	МассивТекстовЗапросов = Новый Массив;
	
	ЗнакСборки = "ВЫБОР КОГДА ТаблицаТовары.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров) ТОГДА 1 ИНАЧЕ -1 КОНЕЦ *";
	ЗнакЭтоСерииШапки = "ВЫБОР КОГДА ТаблицаТовары.Номенклатура = ТаблицаТовары.Ссылка.Номенклатура И ТаблицаТовары.Характеристика = ТаблицаТовары.Ссылка.Характеристика ТОГДА 1 ИНАЧЕ -1 КОНЕЦ *";
	Если ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "", Истина, ЗнакСборки) Тогда
		МассивТекстовЗапросов[0] = СтрЗаменить(МассивТекстовЗапросов[0], "Документ.СборкаТоваров.", "Документ.СборкаТоваров");
	КонецЕсли;
	ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "Товары", Истина, "-"+ЗнакСборки);
	ДобавитьОснование(МассивТекстовЗапросов, "СборкаТоваров", "Товары",, ЗнакСборки+ЗнакЭтоСерииШапки);
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииВЕТИС(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоИнвентаризацииПродукцииВЕТИС()
	
	МассивТекстовЗапросов = Новый Массив;
	ДобавитьОснование(МассивТекстовЗапросов, "ВнутреннееПотреблениеТоваров", "Товары", Истина, "-");
	ДобавитьОснование(МассивТекстовЗапросов, "ВнутреннееПотреблениеТоваров", "Серии",, "-");
	ДобавитьОснование(МассивТекстовЗапросов, "ПрочееОприходованиеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ПрочееОприходованиеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "СписаниеНедостачТоваров", "Товары",, "-");
	ДобавитьОснование(МассивТекстовЗапросов, "ОприходованиеИзлишковТоваров", "Товары");
	ДобавитьОснование(МассивТекстовЗапросов, "ПересортицаТоваров", "Товары",, "-");
	ДобавитьОснование(МассивТекстовЗапросов, "ПересортицаТоваров", "Товары",,, "Оприходование");
	ДобавитьОснование(МассивТекстовЗапросов, "ПорчаТоваров", "Товары",, "-");
	Если ДобавитьОснование(МассивТекстовЗапросов, "ПорчаТоваров", "Товары",,, "Оприходование") Тогда
		МассивТекстовЗапросов[МассивТекстовЗапросов.ВГраница()] =
			СтрЗаменить(МассивТекстовЗапросов[МассивТекстовЗапросов.ВГраница()], "СерияОприходование", "Серия");
	КонецЕсли;
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииВЕТИС(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоОтгрузкеПродукцииВЕТИС()
	
	МассивТекстовЗапросов = Новый Массив;
	ДобавитьОснование(МассивТекстовЗапросов, "РеализацияТоваровУслуг", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "РеализацияТоваровУслуг", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "ВозвратТоваровПоставщику", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ВозвратТоваровПоставщику", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "ПеремещениеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов, "ПеремещениеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов, "ВозвратТоваровМеждуОрганизациями", "Товары");
	ДобавитьОснование(МассивТекстовЗапросов, "ПередачаТоваровМеждуОрганизациями", "Товары");
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииВЕТИС(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоПоступлениюПродукцииВЕТИС()
	
	МассивТекстовЗапросов = Новый Массив;
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровОтКлиента", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровОтКлиента", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ПеремещениеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ПеремещениеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровМеждуОрганизациями", "Товары");
	ДобавитьОснование(МассивТекстовЗапросов,"ПередачаТоваровМеждуОрганизациями", "Товары");
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииВЕТИС(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоОтгрузкеАлкогольнойПродукции()
	
	МассивТекстовЗапросов = Новый Массив;
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровПоставщику", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровПоставщику", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ПеремещениеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ПеремещениеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"РеализацияТоваровУслуг", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"РеализацияТоваровУслуг", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровМеждуОрганизациями", "Товары");
	ДобавитьОснование(МассивТекстовЗапросов,"ПередачаТоваровМеждуОрганизациями", "Товары");
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииЕГАИС(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоДвижениюАлкогольнойПродукции()
	
	МассивТекстовЗапросов = Новый Массив;
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровПоставщику", "Товары", Истина, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровПоставщику", "Серии",, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"РеализацияТоваровУслуг", "Товары", Истина, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"РеализацияТоваровУслуг", "Серии",, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ОприходованиеИзлишковТоваров", "Товары");
	ДобавитьОснование(МассивТекстовЗапросов,"ВнутреннееПотреблениеТоваров", "Товары", Истина, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"ВнутреннееПотреблениеТоваров", "Серии",, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"СписаниеНедостачТоваров", "Товары",, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"СборкаТоваров", "Товары", Истина, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"СборкаТоваров", "Серии",, "-");
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровОтКлиента", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровОтКлиента", "Серии");
	
	ТолькоНемаркируемаяПродукция = Новый Массив;
	ДобавитьОснование(ТолькоНемаркируемаяПродукция,"ОтчетОРозничныхПродажах", "Товары", Истина, "-"); //!
	ДобавитьОснование(ТолькоНемаркируемаяПродукция,"ОтчетОРозничныхПродажах", "Серии",, "-"); //!
	ТолькоНемаркируемаяПродукция = СтрСоединить(ТолькоНемаркируемаяПродукция, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ТолькоНемаркируемаяПродукция = СтрЗаменить(ТолькоНемаркируемаяПродукция, "ГДЕ", "ГДЕ
	|	ТаблицаТовары.Номенклатура.ВидАлкогольнойПродукции.Маркируемый = Ложь И ");
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|")
	 + "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|"
	+ ТолькоНемаркируемаяПродукция;
	
	ДоработатьЗапросПродукцииЕГАИС(Текст);
	
	Возврат Текст;
	
КонецФункции

Функция ОформленныеДокументыПоПоступлениюАлкогольнойПродукции()
	
	МассивТекстовЗапросов = Новый Массив;
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ПриобретениеТоваровУслуг", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ПеремещениеТоваров", "Товары", Истина);
	ДобавитьОснование(МассивТекстовЗапросов,"ПеремещениеТоваров", "Серии");
	ДобавитьОснование(МассивТекстовЗапросов,"ВозвратТоваровМеждуОрганизациями", "Товары");
	ДобавитьОснование(МассивТекстовЗапросов,"ПередачаТоваровМеждуОрганизациями", "Товары");
	
	Текст = СтрСоединить(МассивТекстовЗапросов, "
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|");
	ДоработатьЗапросПродукцииЕГАИС(Текст);
	
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#Область Шаблоны

Функция ДобавитьОснование(МассивТекстовЗапросов, ИмяДокумента, ИмяТабличнойЧасти, СерииОтдельно = Ложь, Знак = "", Постфикс = "")
	
	Если Не ПравоДоступа("Просмотр", Метаданные.Документы[ИмяДокумента]) Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Шаблон = 
	"ВЫБРАТЬ
	|	ТаблицаТовары.Ссылка              КАК Ссылка,
	|	ТаблицаТовары.Номенклатура%5      КАК Номенклатура,
	|	ТаблицаТовары.Характеристика%5    КАК Характеристика,
	|	ТаблицаТовары.Серия%5             КАК Серия,
	|	%4СУММА(ТаблицаТовары.Количество) КАК Количество
	|ИЗ
	|	Документ.%1.%2 КАК ТаблицаТовары
	|ГДЕ
	|	ТаблицаТовары.Ссылка.Проведен
	|	И ТаблицаТовары.Ссылка В
	|		(ВЫБРАТЬ
	|			ПрикладныеДокументы.Ссылка
	|		ИЗ
	|			ПрикладныеДокументы КАК ПрикладныеДокументы)
	|	%3
	|
	|СГРУППИРОВАТЬ ПО
	|	ТаблицаТовары.Ссылка,
	|	ТаблицаТовары.Номенклатура%5,
	|	ТаблицаТовары.Характеристика%5,
	|	ТаблицаТовары.Серия%5";
	
	ШаблонСерииОтдельно = СтрШаблон(
	"И (ТаблицаТовары.Серия%1 <> ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
	|			ИЛИ ТаблицаТовары.СтатусУказанияСерий = 0)", Постфикс);
	
	Шаблон = СтрШаблон(Шаблон,
		ИмяДокумента,
		ИмяТабличнойЧасти,
		?(СерииОтдельно, ШаблонСерииОтдельно, ""),
		Знак,
		Постфикс);
	
	МассивТекстовЗапросов.Добавить(Шаблон);
	Возврат Истина;
	
КонецФункции

Процедура ДоработатьЗапросПродукцииВЕТИС(Текст)
	
	Позиция = СтрНайти(Текст, "ВЫБРАТЬ");
	Текст = Лев(Текст, Позиция-1) + "ВЫБРАТЬ РАЗРЕШЕННЫЕ" + Сред(Текст, Позиция + СтрДлина("ВЫБРАТЬ"));
	Позиция = СтрНайти(Текст, "
	|ИЗ");
	Текст = Лев(Текст, Позиция -1)+ "
	|ПОМЕСТИТЬ ТоварыНакладнойПредварительно
	|"+ Сред(Текст, Позиция);
	
	Текст = Текст + 
	";
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Товары.Ссылка КАК Ссылка,
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.Характеристика КАК Характеристика,
	|	Товары.Серия КАК Серия,
	|	Товары.Количество КАК Количество
	|ПОМЕСТИТЬ ТоварыНакладной
	|ИЗ
	|	ТоварыНакладнойПредварительно КАК Товары
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
	|		ПО Товары.Номенклатура = СправочникНоменклатура.Ссылка
	|		И СправочникНоменклатура.ОсобенностьУчета В(
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.ПодконтрольнаяПродукцияВЕТИС),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.МолочнаяПродукцияПодконтрольнаяВЕТИС))
	|;
	|
	|";
КонецПроцедуры

Процедура ДоработатьЗапросПродукцииЕГАИС(Текст)
	
	Позиция = СтрНайти(Текст, "ВЫБРАТЬ");
	Текст = Лев(Текст, Позиция-1) + "ВЫБРАТЬ РАЗРЕШЕННЫЕ" + Сред(Текст, Позиция + СтрДлина("ВЫБРАТЬ"));
	Позиция = СтрНайти(Текст, "
	|ИЗ");
	Текст = Лев(Текст, Позиция -1)+ "
	|ПОМЕСТИТЬ ТоварыНакладнойПредварительно
	|"+ Сред(Текст, Позиция);
	
	Текст = Текст + 
	";
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Товары.Ссылка КАК Ссылка,
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.Характеристика КАК Характеристика,
	|	Товары.Серия КАК Серия,
	|	Товары.Количество КАК Количество
	|ПОМЕСТИТЬ ТоварыНакладной
	|ИЗ
	|	ТоварыНакладнойПредварительно КАК Товары
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
	|		ПО Товары.Номенклатура = СправочникНоменклатура.Ссылка
	|		И СправочникНоменклатура.ОсобенностьУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.АлкогольнаяПродукция),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Пиво))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ТоварыНакладной.Номенклатура КАК Номенклатура,
	|	ТоварыНакладной.Характеристика КАК Характеристика,
	|	ТоварыНакладной.Номенклатура.ОбъемДАЛ КАК ОбъемДАЛ
	|ПОМЕСТИТЬ НоменклатураПереопределяемый
	|ИЗ
	|	ТоварыНакладной КАК ТоварыНакладной
	|;
	|
	|";
	
КонецПроцедуры

Процедура ДоработатьЗапросПродукцииИСМП(Текст)
	
	Позиция = СтрНайти(Текст, "ВЫБРАТЬ");
	Текст = Лев(Текст, Позиция-1) + "ВЫБРАТЬ РАЗРЕШЕННЫЕ" + Сред(Текст, Позиция + СтрДлина("ВЫБРАТЬ"));
	
	Позиция = СтрНайти(Текст, "
	|ИЗ");
	Текст = Лев(Текст, Позиция -1)+ "
	|ПОМЕСТИТЬ ТоварыНакладнойПредварительно
	|"+ Сред(Текст, Позиция)+"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	Текст = Текст + 
	
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Товары.Ссылка КАК Ссылка,
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.Характеристика КАК Характеристика,
	|	Товары.Серия КАК Серия,
	|	Товары.Количество КАК Количество
	|ПОМЕСТИТЬ ТоварыНакладной
	|ИЗ
	|	ТоварыНакладнойПредварительно КАК Товары
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
	|		ПО Товары.Номенклатура = СправочникНоменклатура.Ссылка
	|		И СправочникНоменклатура.ОсобенностьУчета В(
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.ОбувнаяПродукция),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.ТабачнаяПродукция),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.ЛегкаяПромышленность),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.МолочнаяПродукцияПодконтрольнаяВЕТИС),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Шины),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Фотоаппараты),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Духи),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Велосипеды),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.КреслаКоляски),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.АльтернативныйТабак),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.УпакованнаяВода),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.МолочнаяПродукцияБезВЕТИС),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Антисептики),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.БАДы),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.НикотиносодержащаяПродукция),
	|			ЗНАЧЕНИЕ(Перечисление.ОсобенностиУчетаНоменклатуры.Пиво))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ТоварыНакладной.Номенклатура КАК Номенклатура,
	|	&ОпределениеВидаПродукции КАК ВидПродукции
	|ПОМЕСТИТЬ НоменклатураПереопределяемый
	|ИЗ
	|	ТоварыНакладной КАК ТоварыНакладной
	|;
	|
	|";
	
	ИнтеграцияИСУТ.ОпределитьВидПродукцииТекстаЗапроса(Текст,"ТоварыНакладной.Номенклатура");
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
