#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда // Возврат при получении формы для анализа.
		Возврат;
	КонецЕсли;
	
	ЕстьКлассификатор = Метаданные.Справочники.КлассификаторТНВЭД.Макеты.Найти(
		"КлассификаторТоварнойНоменклатурыВнешнеэкономическойДеятельности") <> Неопределено;
	
	Элементы.ФормаПодборИзТНВЭД.Видимость = ПравоДоступа("Редактирование", Метаданные.Справочники.КлассификаторТНВЭД)
		И ЕстьКлассификатор;
	
	// --> Евлахов Игорь Николаевич (Начало) 04.03.2024
	// Задача #3874	
	злПриСозданииНаСервере(Отказ, СтандартнаяОбработка);
	// <-- Евлахов Игорь Николаевич (Конец) 04.03.2024
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийТаблицыФормыСписок

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Если ЕстьКлассификатор Тогда
		Отказ = Истина;
		
		ТекДанные = Элементы.Список.ТекущиеДанные;
		ДополнительныеПараметры = Новый Структура;
		Если Копирование Тогда
			ЗначенияЗаполнения = Новый Структура;
			ЗначенияЗаполнения.Вставить("Код", Элемент.ТекущиеДанные.Код);
			ЗначенияЗаполнения.Вставить("Наименование", Элемент.ТекущиеДанные.Наименование);
			ДополнительныеПараметры.Вставить("ЗначенияЗаполнения", ЗначенияЗаполнения);
		КонецЕсли;
		
		Оповещение = Новый ОписаниеОповещения("ВопросЗавершение", ЭтотОбъект, ДополнительныеПараметры);
		
		ТекстВопроса = НСтр("ru = 'Есть возможность подобрать товарную номенклатуру ВЭД из классификатора.
			|Подобрать?'");
		
		ПоказатьВопрос(Оповещение, ТекстВопроса, РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Нет);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ПодобратьИзМакета(Команда)
	
	ПараметрыФормы = Новый Структура();
	ПараметрыФормы.Вставить("Подбор", Истина);
	ПараметрыФормы.Вставить("ИмяСправочника", "КлассификаторТНВЭД");
		
	ОткрытьФорму("ОбщаяФорма.ДобавлениеЭлементовВКлассификатор", ПараметрыФормы, ЭтаФорма, , , , ,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ВопросЗавершение(Результат, ДополнительныеПараметры) Экспорт

	Если Результат = КодВозвратаДиалога.Да Тогда
		ПодобратьИзМакета(Неопределено);
	Иначе
		ОткрытьФорму("Справочник.КлассификаторТНВЭД.Форма.ФормаЭлемента", ДополнительныеПараметры, ЭтаФорма);
	КонецЕсли;

КонецПроцедуры

#КонецОбласти


#Область злОбработчикиСобытийФормы 

&НаСервере
Процедура злПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	злМодификацияФормы(Отказ, СтандартнаяОбработка);
		
КонецПроцедуры

#КонецОбласти

#Область злСлужебныеПроцедурыИФункции

&НаСервере
Процедура злМодификацияФормы(Отказ, СтандартнаяОбработка)
		
	#Область ЭлементыФормы
	// << 24.08.2022, Маскаев П.Ю., КРОК, Jira№ A2105505-324
	// КР_Маркируется
	КР_МаркируетсяЭлемент = КР_МетодыМодификацииФорм.ВставитьЭлементФормы(
		ЭтотОбъект, "Список.КР_Маркируется", Элементы["Список"]);
	// >> 24.08.2022, Маскаев П.Ю., КРОК, Jira№ A2105505-324
	
	// --> Евлахов Игорь Николаевич (Начало) 04.03.2024
	// Задача #3874
	злМаркировкаОстатков = КР_МетодыМодификацииФорм.ВставитьЭлементФормы(
		ЭтотОбъект, "Список.злМаркировкаОстатков", Элементы["Список"]);
		
	злМаркировкаДляМаркетплейсов = КР_МетодыМодификацииФорм.ВставитьЭлементФормы(
		ЭтотОбъект, "Список.злМаркировкаДляМаркетплейсов", Элементы["Список"]); 
		
	злМаркировкаДляРозницы = КР_МетодыМодификацииФорм.ВставитьЭлементФормы(
		ЭтотОбъект, "Список.злМаркировкаДляРозницы", Элементы["Список"]);
	// <-- Евлахов Игорь Николаевич (Конец) 04.03.2024
	
	#КонецОбласти
	
КонецПроцедуры

#КонецОбласти
