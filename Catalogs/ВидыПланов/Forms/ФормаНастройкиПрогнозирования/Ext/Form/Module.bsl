
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда // Возврат при получении формы для анализа.
		Возврат;
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(ЭтаФорма, Параметры.РеквизитыДляЗаполнения, , "РеквизитыРасчетаСезонности");
	РеквизитыРасчетаСезонностиОбъекта = ПолучитьИзВременногоХранилища(Параметры.РеквизитыДляЗаполнения.РеквизитыРасчетаСезонности);
	РеквизитыРасчетаСезонности.Загрузить(РеквизитыРасчетаСезонностиОбъекта);
	
	ПересчитатьПоследнююИзвестнуюДатуПродажи();
	
	УстановитьВидимостьДоступность();
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	Если ИмяСобытия = "ПодборРеквизитовКоллекцийВыборРеквизита" Тогда
		Если Не ПустаяСтрока(Параметр.ИмяВИсточнике) Тогда
			НоваяСтрока = РеквизитыРасчетаСезонности.Добавить();
			НоваяСтрока.ИмяВИсточнике = Параметр.ИмяВИсточнике;
			НоваяСтрока.ИмяВСервисе = Параметр.ИмяВСервисе;
			НоваяСтрока.Представление = Параметр.Представление;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура НачалоПрогнозированияПриИзменении(Элемент)
	
	ПересчитатьПоследнююИзвестнуюДатуПродажи();
	
КонецПроцедуры

&НаКлиенте
Процедура ПериодичностьПриИзменении(Элемент)
	УстановитьВидимостьДоступность();
КонецПроцедуры

&НаКлиенте
Процедура ИсключатьСезонностьПриИзменении(Элемент)
	УстановитьВидимостьДоступность();
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ДобавитьРеквизитСезонности(Команда)
	
	//++ Локализация
	ПараметрыПодбора = Новый Структура();
	ПараметрыПодбора.Вставить("ИмяВИсточнике", "Товары");
	ПараметрыПодбора.Вставить("ИмяВСервисе", "products");
	ПараметрыПодбора.Вставить("ЗаблокироватьФлагВыбора", Истина);
	ПараметрыПодбора.Вставить("Выбрано", Истина);
	ПараметрыПодбора.Вставить("РежимВыбора", Истина);
	ПараметрыПодбора.Вставить("ПоказыватьТолькоВыбранные", Истина);
	
	ОткрытьФорму("Обработка.ПанельУправленияСервисомПрогнозирования.Форма.ФормаПодбораРеквизитовКоллекций",
		ПараметрыПодбора,
		ЭтаФорма,
		,
		,
		,
		,
		РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	//-- Локализация
		
КонецПроцедуры

&НаКлиенте
Процедура Ок(Команда)
	
	//++ Локализация
	СписокРеквизитовДляРедактирования = СервисПрогнозированияПереопределяемыйКлиентСервер.РеквизитыВидаПланаДляСервисаПрогнозирования();
	ПараметрыФормыРедактирования = Новый Структура(СписокРеквизитовДляРедактирования);
	ЗаполнитьЗначенияСвойств(ПараметрыФормыРедактирования, ЭтаФорма, , "РеквизитыРасчетаСезонности");
	
	АдресВременногоХранилища = ПоместитьРеквизитыРасчетаСезонностиВоВременноеХранилище();
	ПараметрыФормыРедактирования.Вставить("РеквизитыРасчетаСезонности", АдресВременногоХранилища);
	
	Закрыть(ПараметрыФормыРедактирования);
	//-- Локализация
	
КонецПроцедуры

&НаКлиенте
Процедура Отмена(Команда)
	Закрыть();
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьВидимостьДоступность()
	
	Элементы.РеквизитыСезонности.Доступность = Не ИсключатьСезонность;
	Элементы.ДеньНеделиНачалаПрогноза.Видимость = (Периодичность = Перечисления.Периодичность.Неделя);
	
КонецПроцедуры

&НаСервере
Процедура ПересчитатьПоследнююИзвестнуюДатуПродажи()
	
	//++ Локализация
	ПоследняяИзвестнаяПродажа = СервисПрогнозированияПереопределяемый.ПоследняяИзвестнаяДатаПродажи();
	//-- Локализация
	
КонецПроцедуры

//++ Локализация

&НаСервере
Функция ПоместитьРеквизитыРасчетаСезонностиВоВременноеХранилище()
	АдресВременногоХранилища = ПоместитьВоВременноеХранилище(
				РеквизитыРасчетаСезонности.Выгрузить(),
				УникальныйИдентификатор);
	Возврат АдресВременногоХранилища;
КонецФункции

//-- Локализация

#КонецОбласти
