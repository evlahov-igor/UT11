////////////////////////////////////////////////////
//// Модуль дополнительной формы документа "ТранспортнаяНакладная"
//// Создан: 27.01.2023 Федоров Д.Е., КРОК, JIRA№ A2105505-848
//// Разработка по ФДР С21.006, Разработка обработки "Создание заданий на перевозку"

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Не Параметры.Свойство("ЗаданиеНаПеревозку") Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	ЗаполнитьТаблицуМаршрутыПоЗаданияНаПеревозку(Параметры.ЗаданиеНаПеревозку);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

#КонецОбласти

#Область ОбработчикиКомандФормы

#КонецОбласти

#Область СлужебныеПроцедурыФункции

&НаСервере
Процедура ЗаполнитьТаблицуМаршрутыПоЗаданияНаПеревозку(ЗаданиеНаПеревозку)

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗаданиеНаПеревозкуМаршрут.*
		|ИЗ
		|	Документ.ЗаданиеНаПеревозку.Маршрут КАК ЗаданиеНаПеревозкуМаршрут
		|ГДЕ
		|	ЗаданиеНаПеревозкуМаршрут.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", ЗаданиеНаПеревозку);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		СтрокаМаршрута = Маршрут.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаМаршрута, ВыборкаДетальныеЗаписи);
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура МаршрутВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	// << 04.04.2023 Новиков Н.С., КРОК, JIRA№ A2105505-1465
	Закрыть(Элемент.ТекущиеДанные);
	// >> 04.04.2023 Новиков Н.С., КРОК, JIRA№ A2105505-1465
	
КонецПроцедуры

#КонецОбласти

