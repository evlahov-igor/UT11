
////////////////////////////////////////////////////
//// Модуль набора записей регистра сведений "КР_ПосещаемостьМагазина"
//// Создан: 13.02.2023, Маскаев П.Ю., КРОК, JIRA№ A2105505-1166
//// Разработка по ФДР С11.035, Отчет о розничных продажах. Кассовые документы

#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;

	Если УправлениеДоступом.ЕстьРоль("КР_ДобавлениеПосещаемостиМагазина")
		И Не Пользователи.РолиДоступны("КР_ДобавлениеИзменениеПосещаемостиМагазина") Тогда
		
		СтруктураЗаписи = Новый Структура;
		СтруктураЗаписи.Вставить("Период", Отбор.Период.Значение);
		СтруктураЗаписи.Вставить("Магазин", Отбор.Магазин.Значение);
		
		Если Не ОбменДаннымиВызовСервера.НаборЗаписейРегистраПустой(СтруктураЗаписи, "КР_ПосещаемостьМагазина") Тогда
			ТекстСообщения = НСтр("ru = 'Недостаточно прав на изменение записей РС ""%1""'");
			ТекстСообщения = СтрШаблон(ТекстСообщения, ЭтотОбъект.Метаданные().Синоним);
			ОбщегоНазначения.СообщитьПользователю(ТекстСообщения, , , , Отказ);
		КонецЕсли;
		
	КонецЕсли;

КонецПроцедуры

#КонецОбласти

#КонецЕсли
