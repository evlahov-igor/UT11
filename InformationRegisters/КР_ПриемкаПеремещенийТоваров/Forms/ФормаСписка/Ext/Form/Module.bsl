// 26.07.2023 Марченко С.Н., КРОК, JIRA№A2105505-2046

&НаКлиенте
Процедура УстановитьПризнакОтложеннаяОбработка(Команда)
	
	ЭлементСписок = Элементы.Список;
	
	МассивНакладных = Новый Массив;
	Для Каждого ИдентификаторСтроки Из ЭлементСписок.ВыделенныеСтроки Цикл  
		ДанныеСтроки = ЭлементСписок.ДанныеСтроки(ИдентификаторСтроки);
		МассивНакладных.Добавить(ДанныеСтроки.Накладная);	
	КонецЦикла;

	ОбработатьЗаписиНаСервере(МассивНакладных); 
	
	Элементы.Список.Обновить();
	
КонецПроцедуры       

&НаСервере
Процедура ОбработатьЗаписиНаСервере(МассивНакладных)

	МереджерРегистра = РегистрыСведений.КР_ПриемкаПеремещенийТоваров;
	НаборЗаписей = МереджерРегистра.СоздатьНаборЗаписей(); 
	
	НаборЗаписей.ДополнительныеСвойства.Вставить("ОтложеннаяОбработка", 
		КР_ДополнительныеНастройкиПовтИсп.БазаЯвляетсяЦентральной());
		
	Для Каждого Накладная Из МассивНакладных Цикл 
			
		НаборЗаписей.Отбор.Накладная.Установить(Накладная);		  
		НаборЗаписей.Прочитать();
		Если НаборЗаписей.Количество() = 0 Тогда 
			Продолжить;
		КонецЕсли;
					
		НаборЗаписей.Записать();
			
	КонецЦикла;
		
КонецПроцедуры
